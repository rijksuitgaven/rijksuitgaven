# Typesense Configuration (Railway)

**Created:** 2026-01-21
**Updated:** 2026-01-23 (Template deployment)
**Environment:** Railway (rijksuitgaven project)

---

## Service Details

| Property | Value |
|----------|-------|
| Service Name | typesense |
| Deployment | Railway Template (by Brody's Projects) |
| URL | `typesense-production-35ae.up.railway.app` |
| Port | 8108 (internal), 443 (external HTTPS) |
| Platform | Railway |
| Project | rijksuitgaven |

---

## Environment Variables

```env
TYPESENSE_API_KEY=0vh4mxafjeuvd676gw92kpjflg6fuv57
```

**Note:** This key is auto-generated by the Railway template. Store securely.

---

## Networking

| Property | Value |
|----------|-------|
| Public URL | `https://typesense-production-35ae.up.railway.app` |
| Health Check | `GET /health` |
| Authentication | Header: `X-TYPESENSE-API-KEY: 0vh4mxafjeuvd676gw92kpjflg6fuv57` |

---

## Collections (Deployed 2026-01-23)

| Collection | Source | Documents | Purpose |
|------------|--------|-----------|---------|
| `recipients` | universal_search | 466,827 | Autocomplete + cross-module search |
| `instrumenten` | instrumenten | - | Module search |
| `inkoop` | inkoop | - | Module search |
| `provincie` | provincie | - | Module search |
| `gemeente` | gemeente | - | Module search |
| `publiek` | publiek | - | Module search |
| `apparaat` | apparaat | - | **PENDING DECISION** - see below |

**Note:** Only `recipients` collection is currently indexed. Other collections have schemas but no data yet.

---

## Pending Decision: Apparaat Search

**Question:** Should apparaat be searchable in Typesense?

**Context:** Apparaat has no `ontvanger` field - it's budget/operational data, not recipient payments.

**Options:**
- A) Leave out of Typesense (filter-only search)
- B) Add with different search fields (begrotingsnaam, kostensoort, artikel)

**Status:** To be discussed in next session.

---

## Search Performance

Tested 2026-01-23:

| Query | Hits | Time |
|-------|------|------|
| 'prorail' | 2 | 13ms |
| 'amsterdam' | 2,916 | 18ms |
| 'subsidie' | 502 | 15ms |
| 'ns' | 60 | 21ms |

**Target:** <100ms | **Achieved:** <25ms ✅

---

## API Endpoints

| Endpoint | Purpose |
|----------|---------|
| `GET /health` | Health check |
| `GET /collections` | List collections |
| `POST /collections` | Create collection |
| `POST /collections/{name}/documents/import` | Bulk index |
| `GET /collections/{name}/documents/search` | Search |

---

## Sync Scripts

| Script | Purpose |
|--------|---------|
| `scripts/typesense/collections.json` | Collection schemas |
| `scripts/typesense/sync_to_typesense.py` | Supabase → Typesense sync |

**Usage:**
```bash
cd scripts/typesense
SUPABASE_DB_URL="postgresql://..." python3 sync_to_typesense.py --collection recipients
```

---

## Related Files

- Database schema: `scripts/sql/001-initial-schema.sql`
- Database docs: `scripts/sql/DATABASE-DOCUMENTATION.md`
- Session context: `logs/SESSION-CONTEXT.md`
