/**
 * Embed markdown files into a generated TypeScript module.
 * The roadmap API imports this module — no filesystem reads at runtime.
 */
import { readFileSync, writeFileSync, mkdirSync, existsSync } from 'fs'
import { resolve, join } from 'path'

const appDir = process.cwd()
const repoRoot = resolve(appDir, '..')
const outDir = join(appDir, 'src', 'generated')
const outFile = join(outDir, 'roadmap-data.ts')

mkdirSync(outDir, { recursive: true })

function readOrEmpty(filePath) {
  if (existsSync(filePath)) {
    console.log(`[roadmap] Reading ${filePath}`)
    return readFileSync(filePath, 'utf-8')
  }
  console.warn(`[roadmap] Not found: ${filePath}`)
  return ''
}

const versioningContent = readOrEmpty(join(repoRoot, 'docs', 'VERSIONING.md'))
const backlogContent = readOrEmpty(join(repoRoot, '02-requirements', 'backlog.md'))

const output = `// AUTO-GENERATED by scripts/copy-roadmap-data.mjs — do not edit
export const VERSIONING_MD = ${JSON.stringify(versioningContent)}
export const BACKLOG_MD = ${JSON.stringify(backlogContent)}
`

writeFileSync(outFile, output, 'utf-8')
console.log(`[roadmap] Generated ${outFile} (${versioningContent.length + backlogContent.length} chars)`)
