// AUTO-GENERATED by scripts/copy-roadmap-data.mjs ‚Äî do not edit
export const VERSIONING_MD = "# Versioning Structure\n\n**Project:** Rijksuitgaven.nl\n**Created:** 2026-01-30\n**Updated:** 2026-02-22\n**Status:** Active\n\n---\n\n## Versioning Scheme\n\n| Format | Meaning | Example |\n|--------|---------|---------|\n| **X.0** | Major release - new capability, new use cases | V2.0, V3.0, V4.0 |\n| **X.Y** | Minor release - improvements and smaller additions within major | V2.1, V2.2, V3.1 |\n| **X.Y.Z** | Patch release - bug fixes | V2.0.1, V2.1.2 |\n| **AX.Y** | Admin/internal release - /team pages, admin tooling | A1.0, A1.1, A2.0 |\n| **MX.Y** | Marketing & launch release - homepage, SEO, infrastructure | M1.0, M1.1 |\n| **DX.Y** | Data release - new datasets, year updates, corrections | D1.0, D1.1 |\n\n**Rules:**\n- If it enables a NEW use case or serves a NEW audience, it's a major release.\n- If it only affects `/team/*` pages or admin tooling, it goes in the **A-track** (not V-track).\n- If it's homepage, SEO, launch infrastructure, or marketing optimization, it goes in the **M-track**.\n- If it's adding or updating datasets (new entities, new years, corrections), it goes in the **D-track**.\n- The V-track is end-user facing. The A-track is internal/admin. The M-track is marketing/launch. The D-track is data.\n\n---\n\n## Major Versions Overview\n\n| Version | Name | New Capability | New Use Case |\n|---------|------|----------------|--------------|\n| **V1** | WordPress Platform | Original site | rijksuitgaven.nl (legacy) |\n| **V2** | Search Platform | Find data fast | \"Who received money?\" |\n| **V3** | Rijksuitgaven Reporter | News + spending intelligence | \"What's in the news about government spending?\" |\n| **V4** | Theme Discovery | Understand by domain | \"What's happening in defensie?\" |\n| **V5** | Inzichten | Self-service BI | \"Show me trends and anomalies\" |\n| **V6** | AI Research Mode | Conversational analysis | \"Help me investigate this\" |\n| **V7** | Research Workspace | Save and share findings | \"Build a case, share with team\" |\n| **V8** | External Integrations | Connect to legislation | \"What law governs this spending?\" |\n| **V9** | Network Analysis | Map people & connections | \"Who runs these organizations?\" |\n| **V10** | European Platform | Multi-country | \"Compare NL with Germany\" |\n\n---\n\n## V1 - WordPress Platform (Legacy)\n\nThe original rijksuitgaven.nl built on WordPress. Superseded by V2.\n\n---\n\n## V2 - Search Platform\n\n**Core promise:** ‚Ç¨1.75 trillion searchable in <100ms.\n\n**New use case:** \"Who received money?\"\n\n### V2.0 - Search MVP (Current)\n\n**Status:** In development (~95% complete, V2.0 Beta private beta Week 9, V2.0 public launch Week 11)\n\n**Features:**\n- Fast keyword search (<100ms via Typesense)\n- 7 modules (Instrumenten, Apparaat, Inkoop, Provincie, Gemeente, Publiek, Integraal)\n- Advanced filters per module (searchable multi-select)\n- Cross-module search\n- Year columns with trend indicators\n- Expandable rows with grouping\n- CSV/XLS export (500 rows limit)\n- Magic Link authentication\n- URL sharing\n- BFF proxy (security)\n- Typesense data enrichment (recipients collection with year amounts for hybrid search)\n- Feedback button with screenshot area selection (UX-025)\n- Exact phrase search with quotes (`\"rode kruis\"`)\n- Wildcard syntax support (`prorail*`)\n- Email campaigns via Resend Broadcasts (replaces WordPress/Mailster)\n\n**Target users:** Journalists, researchers, opposition parties\n\n### V2.1 - Vergelijk\n\n**Status:** On staging, release ~1 week post-launch\n\n- UX-039: Row pinning (pin up to 4 rows for side-by-side comparison, export selection)\n\n### V2.2 - Zoeken & URL State\n\n- UX-024: Type-ahead with recent searches (localStorage, reduced debounce, response caching)\n- Fuzzy/typo tolerance (Typesense `num_typos`)\n- Accurate multi-field match reporting (\"Ook in\" for multi-word searches)\n- Semantic search (Cohere embeddings, ~‚Ç¨1/month)\n- Field-specific search syntax (`leverancier:prorail`) ‚Äî power users\n- Full URL state restoration (expanded rows, pagination, all filters)\n\n### V2.3 - Performance\n\n- Cascading filter performance optimization (materialized cache or Typesense facets)\n- Filter performance optimization (indexes, progressive loading)\n- Railway private networking (Typesense egress savings)\n\n### V2.4 - Data & Integraal\n\n- Integraal cross-module data completeness (regelingen in integraal view)\n- Integraal view redesign (brainstorm ‚Äî module-specific columns)\n- Data provenance / freshness indicator (\"Data bijgewerkt: [date]\")\n\n### V2.5 - Polish & Toegankelijkheid\n\n- Accessibility: colorblind anomaly indicator (pattern/dot overlay)\n- xlsx package replacement (ExcelJS ‚Äî CVE cleanup)\n- UX refinements from beta feedback\n- GitHub Projects visual dashboard (stakeholder visibility)\n- AI Integration: MCP Server + OpenAI GPT (teaser API, lead generation)\n\n---\n\n## Admin Track (A-series)\n\nInternal admin tooling at `/team/*`. Separate release cadence from the end-user V-track.\n\n**Audience:** Platform admin (founder)\n\n### A1.0 - Beheer MVP (Current)\n\n**Status:** ‚úÖ Live\n\n| Feature | Status |\n|---------|--------|\n| Member management (`/team/leden`) ‚Äî add, invite, deactivate, role assignment | ‚úÖ Live |\n| Feedback inbox (`/team/feedback`) ‚Äî status workflow, admin notes | ‚úÖ Live |\n| Usage statistics (`/team/statistieken`) ‚Äî pulse, insights, user activity, error tracking | ‚úÖ Live |\n| Contact management (`/team/contacten`) ‚Äî prospect tracking, Resend audience sync | ‚úÖ Live |\n| Email campaigns via Resend Broadcasts (compose, drafts, segments, batch send) | ‚úÖ Live |\n| Email Media Library ‚Äî Sharp image processing, DB tracking, media picker, browsable media tab | ‚úÖ Live |\n| Campaign analytics ‚Äî link tracking, device stats, campaign comparison | ‚úÖ Live |\n| Pre-send quality ‚Äî test email, 5-area precheck, device preview | ‚úÖ Live |\n| Bounce/complaint auto-suppress ‚Äî webhook-driven, hard bounce + complaint handling | ‚úÖ Live |\n| Subscriber engagement scoring ‚Äî per-person timeline, engagement badges | ‚úÖ Live |\n| Email sequences ‚Äî multi-step drip campaigns, cron-based hourly processor, auto-enroll on invite | ‚úÖ Live |\n| Preference center ‚Äî topic-based opt-out, public page at /voorkeuren | ‚úÖ Live |\n| UTM builder ‚Äî compose UI for UTM parameters, auto-append to CTA + body links | üìã Planned |\n\n### A1.1 - Bulk & CRM\n\n| Feature | Status |\n|---------|--------|\n| Row selector for bulk actions (`/team/leden`) | üìã Planned |\n| Contact-to-subscriber conversion flow (`/team/contacten`) | üìã Planned |\n| Campaign event retention cleanup (1-year rolling) | üìã Planned |\n\n### A1.2 - Inzichten\n\n| Feature | Status |\n|---------|--------|\n| Enhanced statistieken dashboard (deeper search funnel, retention metrics) | üìã Planned |\n| Search success/failure analysis improvements | üìã Planned |\n\n### A2.0 - Subscription Management\n\n| Feature | Status |\n|---------|--------|\n| Self-service plan management (upgrade/downgrade) | üìã Planned |\n| Stripe integration for automated billing | üìã Planned |\n| Automated renewal notifications | üìã Planned |\n\n---\n\n## Marketing Track (M-series)\n\nMarketing, launch infrastructure, and conversion optimization. Not end-user features, not admin tooling ‚Äî the work needed to bring the product to market and grow it.\n\n**Audience:** Market (prospects, search engines, referrals)\n\n### M1.0 - Lancering (Launch Gate)\n\n**Status:** üìã Planned ‚Äî all items are prerequisites for DNS switch\n\n| Feature | Status | Blocks DNS switch? |\n|---------|--------|--------------------|\n| SEO: OG image, twitter cards, per-page metadata, structured data | üìã Planned | Yes |\n| DNS switch plan: rijksuitgaven.nl ‚Üí Railway, metadataBase update, rollback plan | üìã Planned | Yes (is the switch) |\n| Rate limiting: Cloudflare free tier in front of Railway | üìã Planned | Yes |\n| User migration: ~50 WordPress users to Supabase | üìã Planned | Yes |\n| Homepage copy optimization (remaining value props) | ‚è≥ In progress | Yes |\n| Logo asset optimization (compact variant, SVG) | üìã Planned | No |\n\n### M1.1 - Conversie & Groei\n\n| Feature | Status |\n|---------|--------|\n| Tab-based feature explorer (replace 6-card grid with tabbed browser frame) | üìã Planned |\n| Audience-personalized landing variants (`?ref=journalist`, `?ref=gemeente`) | üìã Planned |\n\n---\n\n## Data Track (D-series)\n\nDataset additions, year updates, and data corrections. New data sources expand coverage; year updates keep existing modules current.\n\n**Audience:** End users (indirectly ‚Äî more data = more value)\n\n**Process:** See `scripts/data/DATA-UPDATE-RUNBOOK.md` for the data pipeline.\n\n### D1.0 - Gemeente Uitbreiding\n\n| Dataset | Years | Status |\n|---------|-------|--------|\n| Gemeente Haarlemmermeer | 2019‚Äì2023 | üìã Planned |\n\n### D1.1 - Jaarupdate 2025\n\n| Dataset | Update | Status |\n|---------|--------|--------|\n| Rijksbegroting (instrumenten) | Add 2025 | üìã Planned |\n| Apparaatsuitgaven | Add 2025 | üìã Planned |\n| Inkoop | Add 2025 | üìã Planned |\n| Provincie | Add 2025 | üìã Planned |\n| Gemeente | Add 2025 | üìã Planned |\n| Publiek | Add 2025 | üìã Planned |\n\n---\n\n## V3 - Rijksuitgaven Reporter\n\n**Core promise:** News intelligence meets spending data - daily briefings that connect current events to government spending.\n\n**New use case:** \"What's in the news about government spending?\"\n\n**Dependency:** Requires V2.0 complete\n\n**Design document:** `docs/plans/2026-02-03-rijksuitgaven-reporter-design.md`\n\n### V3.0 - Daily Email Briefing\n\n**Features:**\n- **AI news scanner** - Scans RSS feeds from Rijksoverheid.nl, Kamerstukken, NOS, RTL\n- **Keyword extraction** - Claude extracts topics, entities, relevance from articles\n- **Dynamic matching** - Search existing data with extracted keywords (no pre-classification needed)\n- **Daily midday email** - 3-5 items, profession-specific insights\n- **Two profession templates:**\n  - Journalist: Story angles, key recipients, trends\n  - Beleidsmedewerker: Relevant regelingen, historical context, Kamerstukken\n- **Light AI analysis** - Data + insights, not full generated articles\n- **Platform opt-in** - Settings page to enable/configure\n\n**Why this is a major release:**\n- Enables NEW use case (push intelligence, not just pull search)\n- Different interaction paradigm (passive consumption vs. active search)\n- Foundation for personalized experience\n- Increases engagement and retention\n\n**Target users:** Journalists, policy staff (same as V2, but passive engagement)\n\n**Cost:** ~‚Ç¨10-15/month (Claude Haiku + Resend)\n\n### V3.1 - Reporter Improvements\n\n- \"Anders\" profession with generic template\n- Topic preferences (defensie, zorg, onderwijs)\n- Breaking alerts for high-relevance news\n- Personalized homepage (in-app feed)\n\n---\n\n## V4 - Theme Discovery\n\n**Core promise:** Don't just search - explore by policy domain.\n\n**New use case:** \"What's happening in defensie/klimaat/zorg?\"\n\n**Dependency:** Requires V2.0 complete\n\n### V4.0 - Theme Landing Pages\n\n**Features:**\n- **IBOS domain classification** (30 policy domains mapped to 450K recipients)\n- **Theme landing pages** (/thema/defensie, /thema/klimaat, /thema/zorg, etc.)\n  - Hero: total spending + trend\n  - Top 10 recipients (clickable)\n  - Trend chart (2016-2024)\n  - Key anomalies highlighted\n  - Related themes\n  - \"Dig deeper\" ‚Üí Search\n- Theme navigation in header\n- Basic visualizations (bar, line, pie charts)\n\n**Documentation:**\n| Topic | Location |\n|-------|----------|\n| Reference data (IBOS codes) | `docs/reference/ibos-domains.md` |\n| Field mappings | `docs/reference/mapping-*.md` |\n| Progress tracking | `docs/v4-themes/PROGRESS.md` |\n| Quality metrics | `docs/v4-themes/QUALITY.md` |\n| Decisions (ADRs) | `docs/v4-themes/DECISIONS.md` |\n| SQL migrations | `scripts/sql/v4-themes/` |\n\n**Why this is a major release:**\n- Serves NEW audience (mainstream media, mainstream parties)\n- Enables NEW use case (theme-first discovery)\n- Foundation for AI (IBOS classification)\n\n**Target users:** Mainstream media, political parties, universities\n\n**V3 + V4 Synergy:** When Theme Discovery launches, Reporter automatically gets smarter matching via IBOS domains.\n\n### V4.1 - Theme Improvements\n\n- More themes/domains\n- Custom theme pages for specific audiences\n- Theme comparison tools\n- Email alerts for theme changes\n\n---\n\n## V5 - Inzichten\n\n**Core promise:** Create your own analyses and dashboards.\n\n**New use case:** \"Show me trends and anomalies in my area of interest\"\n\n**Dependency:** Requires V2.0 (data), benefits from V4.0 (themes)\n\n### V5.0 - Self-Service BI\n\n**Features:**\n- Custom dashboard builder\n- Trend analysis tools\n- Anomaly detection and alerts\n- Comparison views (year-over-year, recipient-to-recipient)\n- Saved analyses\n- Scheduled reports\n- Export to PowerPoint/PDF\n\n**Why this is a major release:**\n- Enables NEW use case (create analyses, not just search)\n- Different interaction paradigm (build dashboards vs. browse)\n- Unlocks recurring usage (check my dashboard weekly)\n\n**Target users:** Policy analysts, controllers, financial journalists\n\n### V5.1 - Inzichten Improvements\n\n- More chart types\n- Embeddable widgets\n- Public dashboard sharing\n- API for custom integrations\n\n---\n\n## V6 - AI Research Mode\n\n**Core promise:** Conversational analysis - ask questions, get answers.\n\n**New use case:** \"Help me investigate infrastructure spending\"\n\n**Dependency:** Requires V4.0 (IBOS classification for domain understanding)\n\n### V6.0 - Conversational AI\n\n**Features:**\n- **/research page** with chat interface\n- Natural language queries\n- Multi-step analysis (context retention)\n- AI-generated visualizations\n- Comparison tools (recipients, years, modules)\n- Follow-up suggestions\n- Research tier subscription\n\n**Why this is a major release:**\n- Completely new interaction paradigm (chat vs. search)\n- Enables complex analysis without expertise\n- Premium tier unlocks new revenue\n\n**Target users:** Deep researchers, investigative journalists, policy analysts\n\n### V6.1 - AI Improvements\n\n- Smarter follow-ups\n- Better visualization generation\n- Faster response times\n- More query types supported\n\n---\n\n## V7 - Research Workspace\n\n**Core promise:** Build cases, save findings, collaborate.\n\n**New use case:** \"Build a dossier and share with my editor\"\n\n**Dependency:** Requires V6.0 (Research Mode to generate findings worth saving)\n\n### V7.0 - Save & Share\n\n**Features:**\n- Save research sessions\n- Share read-only links\n- Annotations and notes\n- Dossiers (collections of findings)\n- Export to Excel, PDF\n- Session history\n\n**Why this is a major release:**\n- Enables collaborative workflows\n- Creates sticky usage (saved work = retention)\n- B2B value (teams can share)\n\n### V7.1 - Workspace Improvements\n\n- Folders and organization\n- Team workspaces\n- Comments and collaboration\n- Version history\n\n---\n\n## V8 - External Integrations\n\n**Core promise:** Connect spending to its legal and business context.\n\n**New use case:** \"What regulation governs this subsidy?\"\n\n**Dependency:** Requires V6.0+ (meaningful when doing research)\n\n### V8.0 - Legislation Integration\n\n**Features:**\n- **wetten.overheid.nl integration**\n- Link Regelingen to legislation\n- Legislation summaries in AI responses\n- \"View the law\" links\n\n### V8.1 - Business Integration\n\n- KvK integration (company profiles)\n- Beneficial ownership data\n- Company financials context\n\n### V8.2 - Procurement Integration (TenderNed)\n\n- **TenderNed API integration** (tenderned.nl ‚Äî official Dutch government procurement platform)\n- Enrich inkoop module with tender details (contract descriptions, award criteria, procedure type)\n- Link leveranciers to awarded tenders\n- Contract value vs. actual spending comparison\n- Tender timeline (publication ‚Üí award ‚Üí spending)\n\n---\n\n## V9 - Network Analysis (Rijksnetwerken)\n\n**Core promise:** See who runs the organizations that receive tax money, and how they're connected.\n\n**New use case:** \"Who are the people behind these organizations? Are there conflicts of interest?\"\n\n**Dependency:** Requires V2 (recipient data), benefits from V6 (AI can analyze networks)\n\n**Tagline:** \"Verbonden door geld\"\n\n### V9.0 - Network Foundation\n\n**Features:**\n- **KvK integration** - Link recipients to Chamber of Commerce data\n- **Board member mapping** - Directors, supervisory boards, founders\n- **Address clustering** - Organizations at same address\n- **Role history** - Track CVs and career paths of key people\n- **Overlap detection** - Same person on multiple recipient boards\n- **Network visualization** - Graph view of connections\n- **PEP flagging** - Politically Exposed Persons identification\n\n**Data requirements:**\n- KvK API access (paid)\n- Historical director data\n- Address normalization\n- Person entity resolution\n\n**Why this is a major release:**\n- Serves NEW audience (compliance officers, banks, regulators)\n- Enables NEW use case (fraud detection, due diligence, KYC)\n- Requires significant new data layer (people, not just organizations)\n- Different UX paradigm (network graphs vs. tables)\n\n**Target users:**\n- Banks & insurers (KYC/AML compliance)\n- Accountants & auditors\n- Government regulators & toezichthouders\n- Investigative journalists (premium)\n\n**Revenue model:**\n| Tier | Price | Features |\n|------|-------|----------|\n| Monitoring | ‚Ç¨25,000/year | Dataset access, alerts |\n| API Access | ‚Ç¨50,000/year | Custom queries, integration |\n| Enterprise | ‚Ç¨100,000+/year | Full access, support, SLA |\n\n**Market size:** 40-60 organizations (banks, insurers, accountants)\n**Conservative ARR potential:** ‚Ç¨1.1M\n\n### V9.1 - Network Improvements\n\n- Beneficial ownership (UBO) data\n- International director connections\n- Automated risk scoring\n- Custom alert rules\n- Compliance reporting templates\n\n---\n\n## V10 - European Platform\n\n**Core promise:** Every EU tax euro findable.\n\n**New use case:** \"Compare Dutch defense spending with German\"\n\n**Dependency:** V2-V6 proven in NL market\n\n### V10.0 - Multi-Country Foundation\n\n**Features:**\n- Multi-tenant architecture\n- Localization framework (i18n)\n- Country-specific data schemas\n- Franchise onboarding tools\n- White-label theming\n\n### V10.1+ - Country Rollouts\n\n- Pilot countries\n- Data pipeline templates\n- Local partner portal\n- Revenue sharing system\n\n---\n\n## Product Tiers vs. Versions\n\nTiers control ACCESS to versions:\n\n| Tier | Price | Version Access |\n|------|-------|----------------|\n| **Pro** | ‚Ç¨1,500/year | V2 + V3 + V4 |\n| **Research** | TBD | V2-V7 |\n| **Voor Overheden** | ‚Ç¨9,000+ | V2-V8 + municipality features |\n| **Voor Universiteiten** | ‚Ç¨3,000+ | V2-V8 + academic features |\n| **Rijksnetwerken** | ‚Ç¨25,000+/year | V9 (compliance/KYC module) |\n| **Franchise** | License | V10 (white-label European) |\n\n---\n\n## Version Dependencies\n\n```\nV1 WordPress (legacy) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ SUPERSEDED\n\nV2.0 Search ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ CURRENT\n  ‚îÇ\n  ‚îú‚îÄ‚ñ∫ V2.1 Vergelijk ‚Üí V2.2 Zoeken & URL State ‚Üí V2.3-V2.5 (improvements)\n  ‚îÇ\n  ‚îú‚îÄ‚ñ∫ A1.0 Beheer MVP ‚îÄ‚ñ∫ A1.1 Bulk & CRM ‚îÄ‚ñ∫ A1.2 Inzichten ‚îÄ‚ñ∫ A2.0 Subscriptions\n  ‚îÇ\n  ‚îú‚îÄ‚ñ∫ M1.0 Lancering (launch gate) ‚îÄ‚ñ∫ DNS switch ‚îÄ‚ñ∫ M1.1 Conversie & Groei\n  ‚îÇ\n  ‚îú‚îÄ‚ñ∫ D1.0 Gemeente Uitbreiding ‚îÄ‚ñ∫ D1.1 Jaarupdate 2025 ‚îÄ‚ñ∫ (ongoing)\n  ‚îÇ\n  ‚îú‚îÄ‚ñ∫ V3.0 Rijksuitgaven Reporter ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ NEXT\n  ‚îÇ     ‚îÇ\n  ‚îÇ     ‚îî‚îÄ‚ñ∫ V3.1 (improvements)\n  ‚îÇ\n  ‚îú‚îÄ‚ñ∫ V4.0 Theme Discovery\n  ‚îÇ     ‚îÇ   (enhances V3 with semantic matching)\n  ‚îÇ     ‚îÇ\n  ‚îÇ     ‚îî‚îÄ‚ñ∫ V5.0 Inzichten (Self-Service BI)\n  ‚îÇ           ‚îÇ\n  ‚îÇ           ‚îî‚îÄ‚ñ∫ V6.0 AI Research Mode\n  ‚îÇ                 ‚îÇ\n  ‚îÇ                 ‚îú‚îÄ‚ñ∫ V6.1 (improvements)\n  ‚îÇ                 ‚îÇ\n  ‚îÇ                 ‚îú‚îÄ‚ñ∫ V7.0 Research Workspace\n  ‚îÇ                 ‚îÇ     ‚îÇ\n  ‚îÇ                 ‚îÇ     ‚îî‚îÄ‚ñ∫ V8.0 External Integrations\n  ‚îÇ                 ‚îÇ\n  ‚îÇ                 ‚îî‚îÄ‚ñ∫ V9.0 Network Analysis ‚óÑ‚îÄ‚îÄ‚îê\n  ‚îÇ                       (benefits from AI)     ‚îÇ\n  ‚îÇ                                              ‚îÇ\n  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n        (requires recipient data)\n\nV10.0 European Platform\n  ‚îî‚îÄ‚ñ∫ Requires V2-V6 proven in NL market\n```\n\n---\n\n## Current Roadmap\n\n**End-User (V-track):**\n\n| Version | Status | Timeline |\n|---------|--------|----------|\n| V1 | ‚úÖ Legacy (WordPress) | Superseded by V2 |\n| V2.0 | üî® 95% Complete (beta live, public launch remaining) | Week 9-11 |\n| V2.1 | üìã Vergelijk (on staging) | ~1 week post-launch |\n| V2.2 | üìã Zoeken & URL State | Post-launch |\n| V2.3 | üìã Performance | Post-launch |\n| V2.4 | üìã Data & Integraal | Post-launch |\n| V2.5 | üìã Polish & Toegankelijkheid + AI | Post-launch |\n| V3.0 | üìã Planned | Post V2.0 launch |\n| V4.0 | üìã Planned | Q1-Q2 2026 |\n| V5.0 | üìã Planned | Q2 2026 |\n| V6.0 | üìã Planned | Q2-Q3 2026 |\n| V7.0 | üìã Planned | Q3 2026 |\n| V8.0 | üìã Planned | Q3 2026 |\n| V9.0 | üìã Planned | Q3+ 2026 (can start after V2, benefits from V6) |\n| V10.0 | üìã Planned | 2027+ (after NL market proven) |\n\n**Admin (A-track):**\n\n| Version | Status | Timeline |\n|---------|--------|----------|\n| A1.0 | ‚úÖ Live | Shipped with V2.0 |\n| A1.1 | üìã Bulk & CRM | Post-launch |\n| A1.2 | üìã Inzichten | Post-launch |\n| A2.0 | üìã Subscription Management | TBD |\n\n**Marketing & Launch (M-track):**\n\n| Version | Status | Timeline |\n|---------|--------|----------|\n| M1.0 | üìã Lancering (launch gate) | Before DNS switch |\n| M1.1 | üìã Conversie & Groei | Post-launch |\n\n**Data (D-track):**\n\n| Version | Status | Timeline |\n|---------|--------|----------|\n| D1.0 | üìã Gemeente Uitbreiding (Haarlemmermeer) | Pre-launch |\n| D1.1 | üìã Jaarupdate 2025 | When available |\n\n**V2.0 Deployed Infrastructure (as of 2026-02-21):**\n- ‚úÖ Supabase PostgreSQL (Frankfurt EU, Pro plan)\n- ‚úÖ Next.js Frontend (Railway Amsterdam)\n- ‚úÖ FastAPI Backend (Railway Amsterdam)\n- ‚úÖ Typesense Search (Railway Amsterdam, 463K recipients)\n- ‚úÖ Supabase Auth (Magic Link + PKCE)\n- ‚úÖ Subscriptions table (membership management)\n\n---\n\n## Quick Reference\n\n**\"Is this a major or minor release?\"**\n\n| Change | Version Type | Example |\n|--------|--------------|---------|\n| New capability / new use case | **Major (X.0)** | Reporter, Theme pages, AI chat |\n| Improvement to existing capability | **Minor (X.Y)** | Better search, faster AI |\n| Bug fix | **Patch (X.Y.Z)** | Fix search ranking |\n| Admin/internal tooling | **A-track (AX.Y)** | Member management, CRM |\n| Marketing, SEO, launch infra | **M-track (MX.Y)** | DNS switch, homepage, SEO |\n\n---\n\n**Document maintained by:** Product Owner\n**Last updated:** 2026-02-22\n"
export const BACKLOG_MD = "# Product Backlog\n\n**Last Updated:** 2026-02-18\n\nItems logged for future versions, not in V2.0 scope.\n\n---\n\n## V2.0 Backlog\n\n### Staffelbedrag Explanation (User Education) (COMPLETED)\n\n**Priority:** Medium (V2.0)\n**Added:** 2026-02-06\n**Completed:** 2026-02-07\n**Status:** ‚úÖ COMPLETED\n**Type:** UX / Documentation\n\n**Problem:**\nUsers unfamiliar with government data may not understand what \"staffelbedrag\" means. The Inkoop and Publiek (COA) modules show averaged staffel amounts, not precise figures.\n\n**Solution Implemented (UX-013):**\n- Info icon (‚ìò) next to footer text on Inkoop and Publiek modules\n- Click opens navy popover with staffel range table and explanation (Dutch)\n- Word \"staffelbedrag(en)\" in footer text is also clickable (dotted underline)\n- Popover matches search tips pattern (navy dark bg + pink accent bar)\n- Content: explanation of midpoint calculation, staffel 1-13 ranges, source reference\n\n**Decision:** Option 1 chosen - info icon with popover explanation, plus clickable word in footer text.\n\n---\n\n### Data Quality: Encoding Corruption Cleanup (COMPLETED)\n\n**Priority:** High (V2.0)\n**Added:** 2026-02-07\n**Completed:** 2026-02-07\n**Status:** ‚úÖ COMPLETED\n**Type:** Data Quality / Bug\n\n**Problem:**\nLegacy WordPress/MySQL data had encoding corruption from CSV export. Three types: double-encoded UTF-8 (~4,400 rows, e.g., `Caf√É¬©`), triple-encoded (~400 rows in inkoop), and lost characters replaced with `?` (~500 rows).\n\n**Resolution:** 6 Python scripts (asyncpg parameterized queries) + 1 SQL file (431 explicit UPDATE statements). Additional targeted fixes for division signs (√∑‚Üí√∂), Mac Roman encoding (‚àö√ß‚Üí√§), euro signs (‚Äö√á√®‚Üí‚Ç¨), and section sign restoration (√ß‚Üí¬ß). All 7 materialized views refreshed, Typesense re-synced with audit passed. Scripts preserved at `scripts/data/fix-encoding-phase1*.py` and `scripts/sql/025-fix-encoding-question-marks.sql`.\n\n---\n\n### Data Quality: \"Amsersfoort\" Typo in Gemeente Data (COMPLETED)\n\n**Priority:** Medium (V2.0)\n**Added:** 2026-02-07\n**Completed:** 2026-02-07\n**Status:** ‚úÖ COMPLETED\n**Type:** Data Quality / Bug\n\n**Problem:**\nThe gemeente table contained \"Amsersfoort\" (typo) alongside \"Amersfoort\". 1,168 duplicate rows.\n\n**Resolution:** SQL UPDATE, refreshed materialized views, re-synced Typesense gemeente collection. Migration: `023-fix-amsersfoort-typo.sql`.\n\n---\n\n### Data Availability Indicators (COMPLETED)\n\n**Priority:** High (V2.0)\n**Added:** 2026-02-06\n**Completed:** 2026-02-07\n**Status:** ‚úÖ COMPLETED\n**Effort:** 3-5 hours (actual ~2 hours)\n**Type:** Feature / UX\n\n**Problem:**\nUsers cannot distinguish between:\n- **Real zero** - Entity received ‚Ç¨0 (confirmed data)\n- **No data** - Data doesn't exist for this entity/year combination\n\nExample: Gemeente Amersfoort has data for 2020-2024, but not 2016-2019. Currently all show `-` which is ambiguous.\n\n**Solution (Approved Design):**\n- `‚Äî` (em-dash) for \"no data exists\"\n- `0` for \"real zero\"\n- Tooltip: \"Geen data beschikbaar voor deze periode\"\n- Database table `data_availability` tracks year ranges per entity\n- API returns `data_available_from` and `data_available_to` per row\n\n**Design Document:** `docs/plans/2026-02-06-data-availability-indicators-design.md`\n\n**Implementation Steps:**\n1. Database: Create `data_availability` table + RLS\n2. Backend: Add availability fields to API response\n3. Frontend: Update cell rendering logic\n4. Expanded rows: Apply same rendering\n\n**Implementation:** Complete (2026-02-07). Migration 022 executed, API verified, deployed to production.\n\n---\n\n### Cascading Filter Performance Optimization\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-08\n**Status:** BACKLOGGED\n**Type:** Performance\n\n**Problem:**\nCascading filter option requests (POST `/filter-options`) take 300-500ms per request. Each filter change triggers a new request. With the Begroting filter in instrumenten module (674K rows), loading times can feel slow.\n\n**Current State:**\n- 5 parallel queries via `asyncio.gather()` per request\n- Each query runs `SELECT DISTINCT field, COUNT(DISTINCT primary) ... GROUP BY ... ORDER BY ...`\n- ~300-500ms for instrumenten (largest table), ~100-200ms for smaller modules\n- Debounced 200ms to reduce request frequency\n\n**Observed (2026-02-08, local dev):**\n- Cold call (first POST, no active filters, instrumenten): **21s** (includes Turbopack compile 701ms + backend 20.3s)\n- Warm call (second POST, same params): **6.9s** (compile 4ms + backend 6.9s)\n- Production will be faster (no Turbopack compile), but unfiltered instrumenten (674K rows) remains the worst case\n\n**Potential Solutions:**\n\n| Option | Effort | Impact |\n|--------|--------|--------|\n| **Materialized filter option cache** | 4-8 hours | High ‚Äî pre-compute options for unfiltered state |\n| **Redis cache for filter combos** | 4-8 hours | High ‚Äî cache frequent filter combinations |\n| **Typesense facets** | 1-2 days | High ‚Äî built-in faceting, ~10ms |\n| **Partial indexes on filter columns** | 2 hours | Medium ‚Äî faster GROUP BY |\n| **Frontend option caching** | 2 hours | Medium ‚Äî cache unfiltered options, only refetch on filter change |\n\n**Decision:** Parked for V2.1. Current performance is acceptable for launch.\n\n---\n\n### Custom 404 Page Design\n\n**Priority:** Medium (V2.0)\n**Added:** 2026-02-08\n**Completed:** 2026-02-13\n**Status:** ‚úÖ COMPLETED\n**Type:** UX / Design\n\n**Problem:**\nThe current 404 page is the default Next.js error page ‚Äî generic and off-brand. Users who hit a broken link or mistype a URL see no helpful guidance.\n\n**Solution:**\nDesign a branded 404 page that:\n- Matches the site's visual identity (navy theme, typography)\n- Clearly communicates \"page not found\" in Dutch\n- Provides a link back to the homepage (Overzicht)\n- Optionally includes the search bar so users can find what they were looking for\n- Keeps it simple and on-brand ‚Äî no gimmicks\n\n---\n\n### Rate Limiting via Cloudflare (Pre-Launch)\n\n**Priority:** High (Pre-Launch)\n**Added:** 2026-02-08\n**Updated:** 2026-02-12\n**Status:** ‚è≥ TODO (V2.0 ‚Äî before launch)\n**Type:** Security / Infrastructure\n\n**Problem:**\nNo rate limiting exists anywhere in the stack. An attacker can send thousands of requests/second to any BFF endpoint, saturating the backend's 10-connection asyncpg pool and degrading service for all users. The autocomplete endpoint (called on every keystroke) and cascading filters endpoint (7 parallel DB queries per request) are the most amplifiable vectors.\n\n**Decision (2026-02-12):** Cloudflare free tier in front of Railway.\n\n**Implementation:**\n1. Create Cloudflare account (free tier)\n2. Change DNS for `beta.rijksuitgaven.nl` (and later `rijksuitgaven.nl`) to proxy through Cloudflare\n3. Configure rate limiting rules in Cloudflare dashboard\n4. Verify Railway still receives traffic correctly\n5. Benefits: rate limiting + DDoS protection + WAF for free\n\n**Estimated effort:** 30 minutes\n\n---\n\n### Backend Network Isolation (Pre-Launch)\n\n**Priority:** High (Pre-Launch)\n**Added:** 2026-02-08\n**Status:** ‚úÖ COMPLETE (BFF secret implemented 2026-02-10, private networking deferred to V2.1)\n**Type:** Security\n\n**Problem:**\nThe backend FastAPI service is directly accessible on the internet at its Railway URL. The BFF proxy pattern is cosmetic ‚Äî all BFF protections (sanitization, body limits, future auth) can be bypassed by hitting the backend URL directly. The URL follows a predictable pattern (`{service}-production-{4hex}.up.railway.app`, 65K combinations).\n\n**Potential Solutions:**\n\n| Option | Effort | Impact | Status |\n|--------|--------|--------|--------|\n| **Railway private networking** | 1 hour | High ‚Äî backend only reachable from BFF container | V2.1 |\n| **API key between BFF and backend** | 2-4 hours | High ‚Äî backend rejects requests without secret header | ‚úÖ Done 2026-02-10 |\n| **IP allowlisting** | 1 hour | Medium ‚Äî fragile if Railway IPs change | Not needed |\n\n**Implemented:** `X-BFF-Secret` shared secret. `proxyToBackend()` sends header; `BFFSecretMiddleware` in FastAPI validates it. Railway private networking deferred to V2.1 for full network isolation.\n\n---\n\n### Module Navigation Bar Overflow (Pre-Launch)\n\n**Priority:** High (Pre-Launch)\n**Added:** 2026-02-14\n**Completed:** 2026-02-15\n**Status:** ‚úÖ COMPLETED\n**Type:** UI / Typography\n\n**Problem:**\nAfter switching from IBM Plex Sans Condensed to IBM Plex Sans (wider) for the module navigation bar, the menu items no longer fit on a single line. \"Apparaatskosten\" is truncated/cut off on the right edge.\n\n**Solution Implemented:**\nExpert panel review (Creative Strategist, Brand Designer, Frontend UI, UX Researcher, QA Lead) chose Option 1: apply `var(--font-condensed)` (IBM Plex Sans Condensed) to the `<nav>` element only. Same typeface family, ~15% narrower, purpose-built for space-constrained UI. Also tightened padding `px-3` ‚Üí `px-2.5`. Full module labels preserved. Scroll fallback (`overflow-x-auto`) kept as safety net. Category badges inherit condensed from nav parent.\n\n**Commit:** `1d220f4`\n\n---\n\n### xlsx Package Replacement (V2.1)\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-08\n**Status:** BACKLOGGED\n**Type:** Security / Dependency\n\n**Problem:**\nThe `xlsx` (SheetJS) npm package has known CVEs: prototype pollution (GHSA-4r6h-8v6p-xvw6, CVSS 7.8) and ReDoS (GHSA-5pgg-2g8v-p4x9, CVSS 7.5). The open-source version is abandoned (no fix available). Current usage is write-only (`aoa_to_sheet`, `writeFile` for XLS export), so CVEs targeting parse paths are not directly exploitable. However, compliance scanners will flag this.\n\n**Potential Solutions:**\n\n| Option | Effort | Impact |\n|--------|--------|--------|\n| **Replace with ExcelJS** | 4-8 hours | High ‚Äî actively maintained, MIT license |\n| **Replace with commercial SheetJS** | 2 hours | Medium ‚Äî requires license, different npm package |\n| **Remove XLS export** | 30 min | Low ‚Äî only offer CSV (functional regression) |\n\n**Decision:** Replace with ExcelJS in V2.1. Low urgency since write-only usage.\n\n---\n\n## Post-V2.0 Backlog\n\n### Overzichtspagina / Recipient Profile Panel\n\n**Priority:** Deferred to V6 (AI Research Mode)\n**Added:** 2026-01-20 (original)\n**Updated:** 2026-02-06 (deferred decision)\n**Type:** Feature / UX\n\n**Original Request:**\nHigh-level overview page showing module totals per year, as entry point to platform.\n\n**Analysis (2026-02-06):**\nCompared WordPress \"detail page\" with current V2 expanded row:\n\n| Feature | WordPress Detail Page | V2 Expanded Row |\n|---------|----------------------|-----------------|\n| Scope | All metadata at once | One grouping at a time |\n| Year breakdown | ‚úÖ | ‚úÖ |\n| Groupable fields | Links to filter | Clickable filters |\n| Google search link | ‚úÖ | ‚úÖ (added 2026-02-06) |\n\n**Conclusion:** V2 expanded row covers the functional need. A comprehensive \"Recipient Profile Panel\" is not needed until V6.\n\n**Where This Functionality Fits:**\n\n| Version | Need Level | Reason |\n|---------|------------|--------|\n| V2 | Low | Expanded row suffices for \"who received money\" |\n| V3 | Low | Email briefings, not interactive exploration |\n| V4 | Medium | Theme pages link to recipients, but search handles it |\n| V6 | **HIGH** | AI Research needs full recipient context to analyze |\n| V7 | **HIGH** | Workspace needs full profile to save/annotate |\n| V9 | **CRITICAL** | Network analysis: click node ‚Üí see full profile + connections |\n\n**V6 Implementation (Recommended):**\nBuild **Recipient Profile Panel** as slide-out panel:\n- All years across all modules\n- All metadata fields\n- Cross-module summary (\"‚Ç¨450M total: Instrumenten ‚Ç¨300M, Publiek ‚Ç¨150M\")\n- External links (Google, KvK in V8)\n- AI context reference\n- \"Add to Dossier\" action (V7)\n\n**Decision:** Skip for V2.0. Build as part of V6 AI Research Mode where it becomes essential.\n\n---\n\n### Logo Asset Optimization\n\n**Priority:** Low (V2.1)\n**Added:** 2026-02-06\n**Type:** Design / Brand\n\n**Problem:**\nCurrent `logo.png` (1900√ó540px) includes tagline \"Snel inzicht voor krachtige analyses\" which becomes unreadable when scaled down for compact headers. The full logo requires h-14 (56px) minimum height to be legible.\n\n**Current state:**\n- Using full designed logo asset (Option C hybrid approach)\n- Desktop: h-14 (56px) logo in h-24 (96px) masthead\n- Mobile: icon only (h-12, 48px)\n- Tagline barely readable at current size\n\n**Options to explore:**\n1. Create compact logo variant without tagline (just icon + \"Rijksuitgaven\")\n2. Create SVG version for crisp scaling at any size\n3. Redesign tagline with larger font in source file\n4. Accept current size as brand presence vs. space trade-off\n\n**Decision:** Keep current implementation for V2.0 launch. Revisit in V2.1 UX polish phase.\n\n---\n\n### Integraal View Redesign (Brainstorm Required)\n\n**Priority:** Medium\n**Added:** 2026-01-30\n**Type:** Architecture / Brainstorm\n\n**Problem:**\nThe current Integraal view (`universal_search` materialized view) is not a \"true\" integraal view. It aggregates recipients across modules but cannot show extra columns because different modules have different fields in their source tables:\n\n| Module | Fields Available |\n|--------|------------------|\n| Instrumenten | regeling, artikel, instrument, begrotingsnaam |\n| Apparaat | kostensoort (no recipient), artikel, detail |\n| Inkoop | categorie, staffel, ministerie |\n| Provincie | provincie, omschrijving |\n| Gemeente | gemeente, omschrijving, beleidsterrein |\n| Publiek | source, regeling, trefwoorden, sectoren |\n\n**Current Limitation:**\n- Integraal can only show: Ontvanger, year columns, totaal, modules list\n- Cannot show \"extra columns\" like individual module pages can\n- No common denominator across all modules\n\n**Questions to Explore:**\n1. Should Integraal show module-specific columns when drilling down?\n2. Should we create a unified taxonomy mapping different fields to common concepts?\n3. Is the current \"discovery layer\" approach sufficient (find recipient ‚Üí navigate to module)?\n4. What do users actually need from cross-module view?\n\n**Decision:** Requires brainstorm session to determine approach. Park for post-V2.0.\n\n---\n\n### API Performance: Inkoop & Integraal Endpoints\n\n**Priority:** Low (Mostly Resolved)\n**Added:** 2026-01-26\n**Updated:** 2026-01-26 (after pg_trgm + source table indexes)\n\n**Current State (After Optimization):**\n\n| Module | Basic Query | Search (3+ chars) | Status |\n|--------|-------------|-------------------|--------|\n| instrumenten | 114-204ms | 237ms | ‚úÖ |\n| apparaat | 172ms | 215ms | ‚úÖ |\n| provincie | 196ms | 228ms | ‚úÖ |\n| gemeente | 191ms | 598ms | ‚úÖ |\n| publiek | 222ms | 247ms | ‚úÖ |\n| inkoop | 180-480ms | 175-312ms | ‚úÖ Improved |\n| integraal | 190-380ms | 181-226ms | ‚úÖ Improved |\n\n**Optimizations Applied:**\n1. ‚úÖ Materialized views (100x faster aggregation)\n2. ‚úÖ pg_trgm + GIN indexes (4x faster ILIKE search)\n3. ‚úÖ Source table indexes (faster details queries)\n4. ‚úÖ Connection pool tuning (handles more concurrent users)\n\n**Remaining options (if traffic grows):**\n- Redis/memory caching layer\n- Read replica for heavy queries\n\n**Decision:** Performance is now acceptable. Monitor in production.\n\n---\n\n### Entity Resolution / Recipient Normalization\n\n**Priority:** ‚úÖ COMPLETED (V2.0)\n**Added:** 2026-01-20\n**Completed:** 2026-01-26\n\n**Problem:**\nRecipients were spelled differently across data sources:\n- \"N.V. Nederlandse Spoorwegen\" vs \"Nederlandse Spoorwegen\" (N.V. format)\n- \"NS Vastgoed B.V.\" vs \"NS Vastgoed BV\" (B.V. format)\n- Casing variations\n\n**Solution Implemented:**\nCreated `normalize_recipient()` PostgreSQL function that handles:\n- Casing (UPPER)\n- B.V./BV/N.V./NV format variations (stripped)\n- Extra spaces (normalized)\n\nRebuilt `universal_search` materialized view with normalization.\n\n**Result:**\n- 466,827 ‚Üí 451,445 entities\n- **15,382 duplicates merged (3.3%)**\n- ProRail: multiple rows ‚Üí 1 row (‚Ç¨12.7B)\n- NS Spoorwegen: 3 rows ‚Üí 1 row (‚Ç¨90M)\n\n**Script:** `scripts/sql/009-entity-resolution-normalization.sql`\n\n**Remaining (V3.0+):**\n- KvK-based matching for remaining name variations (e.g., \"Politie\" vs \"Korps Nationale Politie\")\n- Entity mapping table for complex cases\n\n---\n\n### Download Screenshot Feature\n\n**Priority:** Low\n**Added:** 2026-01-20\n\nAllow users to download a screenshot/image of current view for reports and presentations.\n\n---\n\n### Search on Other Fields (Regeling, Omschrijving)\n\n**Priority:** ‚úÖ COMPLETED\n**Added:** 2026-01-29\n**Completed:** 2026-01-31\n\n**Problem:**\nWhen search matches on fields OTHER than Ontvanger (e.g., Regeling, Omschrijving), the current UI can't show why that result appeared.\n\n**Solution Implemented:**\n- \"Gevonden in\" column shows matched field and value when search hits non-primary fields\n- Uses Typesense highlight data (zero additional latency)\n- Documented in search-requirements.md as UX-002d\n\n---\n\n### Full URL State Restoration\n\n**Priority:** Medium\n**Added:** 2026-01-20\n\nV2.0 has basic URL sharing (search term, module, key filters).\nV3.0: Full state in URL including expanded rows, pagination position, all filter states.\n\n---\n\n### Analytics Integration\n\n**Priority:** Medium (V2.1 or V2.2)\n**Added:** 2026-01-21\n**Updated:** 2026-02-14\n**Status:** ‚úÖ COMPLETED 2026-02-14 (Phase 2 implemented as UX-032)\n**Type:** Product Analytics / GDPR\n\n**Goal:** Track user behavior and usage patterns at scale (building for 500+ users, not just current 50).\n\n**What was implemented (UX-032):**\n- Server-side event logging via BFF (Phase 2 from original plan)\n- 6 event types: module_view, search, row_expand, filter_apply, export, column_change\n- Pseudonymized user tracking (SHA256 actor_hash, no PII)\n- Client-side batching hook (`use-analytics.ts`) ‚Äî flush every 30s or 10 events\n- BFF endpoint (`POST /api/v1/analytics`) ‚Äî fire-and-forget write to Supabase\n- Admin dashboard at `/team/statistieken` ‚Äî 6 sections with date range picker\n- SQL: `038-usage-events.sql` (table) + `038b-usage-events-functions.sql` (7 RPC functions)\n- Design doc: `docs/plans/2026-02-14-usage-statistics-design.md`\n\n**GDPR Analysis (2026-02-09 expert team review):**\n\n| Tracking type | Consent needed? | Notes |\n|--------------|----------------|-------|\n| Server-side logs (Railway) | No | Legitimate interest, already available |\n| Supabase Auth queries (last_sign_in_at) | No | Already available |\n| Plausible/Umami (cookie-free, EU-hosted) | No (basic pageviews) | French DPA approved; Dutch DPA hasn't ruled specifically |\n| Custom events (server-side BFF logging) | No | Log API calls in BFF, no client-side tracking needed |\n| PostHog / GA4 (cookies, user profiling) | Yes | Requires consent mechanism, overkill for now |\n\n**Remaining phases (future):**\n\n| Phase | Trigger | Action | Cost |\n|-------|---------|--------|------|\n| 1 | Post-launch | Plausible or Umami Cloud (pageviews, traffic, top pages) | ‚Ç¨9/month |\n| ~~2~~ | ~~200+ users~~ | ~~Server-side event logging~~ | ‚úÖ Done (UX-032) |\n| 3 | 500+ users | PostHog with proper consent mechanism | Free tier |\n\n**Key rules:**\n- Never use Google Analytics (US data transfer, consent required, anti-privacy)\n- Prefer server-side event tracking over client-side scripts (no consent needed)\n- Current cookie banner (\"alleen noodzakelijke cookies\") stays intact through Phase 1-2\n- Phase 3 requires updating cookie banner to consent mechanism\n\n---\n\n### Committed Search Tracking ‚Äî UX-034 (COMPLETED)\n\n**Priority:** High (V2.0)\n**Added:** 2026-02-16\n**Completed:** 2026-02-16\n**Status:** ‚úÖ COMPLETED\n**Type:** Analytics / UX\n**Related:** Refines UX-032 (Usage Statistics)\n\n**Problem:**\nSearch analytics tracked typing noise via 2-second debounce timer. Dashboard showed typos and partial words as real searches (e.g., \"Gemeente Deventtr\" and \"Gmeente\" instead of \"Gemeente Deventer\"). This made the \"Wat zoeken gebruikers?\" section unreliable.\n\n**Solution Implemented ‚Äî Three-layer search analytics model:**\n1. **Committed search tracking** ‚Äî Only Enter press and autocomplete clicks generate search events. Debounce timer killed entirely.\n2. **search_id linking** ‚Äî Every committed search gets a unique ID. All engagement events (row_expand, export, cross_module_nav, etc.) carry this search_id.\n3. **search_end event** ‚Äî New 14th event type. Tracks duration (with visibility pause handling) and exit action (new_search, module_switch, page_leave, search_clear).\n4. **Retry chains** ‚Äî `prev_search_id` links a new search to a previous zero-result search within 60 seconds.\n5. **Deferred result counting** ‚Äî Search commit signaled from filter-panel, but tracking fires only after data loads (when result_count is known).\n\n**Dashboard redesign:**\n- New `SearchSection` component with 4 KPI cards (searches, success rate, avg duration, engagement rate)\n- Enriched search table: Zoekterm, Resultaten, Via (Enter/Auto pills), Duur, Engagement %, Aantal, Module\n- Zero results section with retry count badges\n- Engagement breakdown bar chart\n\n**Migration:** `052-search-tracking-v2.sql` (truncates old events, replaces 3 RPC functions, adds 1 new)\n\n---\n\n### Homepage Analytics Tracking (V2.1)\n\n**Priority:** Low (V2.1)\n**Added:** 2026-02-14\n**Status:** BACKLOGGED\n**Type:** Analytics / UX-032\n\n**Problem:**\nHomepage user interactions (CTA clicks, contact form submissions, section scroll engagement, subscription plan clicks) are not tracked. This data would help understand conversion funnel performance.\n\n**Scope (deferred from UX-032 implementation):**\n- Hero CTA button clicks\n- Subscription plan clicks (Maandelijks/Jaarlijks)\n- B2G \"Plan een demo\" button click\n- Contact form submission success\n- ScrollReveal section visibility (which sections users scroll to)\n- Login flow interactions (magic link request, callback)\n\n**Decision:** Excluded from initial UX-032 implementation to keep scope focused on in-app usage. Implement in V2.1 when conversion analytics become a priority.\n\n---\n\n### Error Tracking / Monitoring\n\n**Priority:** Low\n**Added:** 2026-01-21\n**Completed:** 2026-02-14\n**Status:** ‚úÖ COMPLETED (integrated into UX-032)\n\n**Problem:** Need to catch and debug production client-side errors.\n\n**Solution Implemented (as part of UX-032):**\n- `error` event type tracked in `use-analytics.ts` (12th event type)\n- Captures: error message, search query, sort column, active filters, module\n- Immediate flush (bypasses 30s batch timer)\n- Admin dashboard errors section: stacked cards with context pills\n- `DELETE /api/v1/team/statistieken` ‚Äî clear all error events\n- SQL: `get_usage_errors()` function (migration 040)\n\n**Note:** This is client-side error tracking only. Server-side monitoring (Sentry, Railway logs) remains a separate consideration for post-launch if needed.\n\n---\n\n### User-Configurable Anomaly Threshold\n\n**Priority:** Low\n**Added:** 2026-01-21\n**Source:** UX Brainstorm Session\n\nV2.0 has fixed 50% threshold for trend anomaly highlighting (red cells). Originally 10% but raised to 50% on 2026-02-07 as normal government budget adjustments (5-20% YoY) created too much noise.\n\n**Future enhancement:** Allow users to configure their own threshold:\n- 25% (sensitive - more highlights)\n- 50% (current default)\n- 75% (less sensitive)\n- 100% (only major changes)\n\n**Location:** User settings/preferences.\n\n---\n\n### Data Provenance / Freshness Indicator\n\n**Priority:** Medium\n**Added:** 2026-01-21\n**Source:** UX Brainstorm Session\n\nShow users when data was last updated and where it came from.\n\n**Level 1 (simpler):** Module-level \"Data bijgewerkt: [date]\" indicator.\n\n**Level 2 (detailed):** Per-row/cell provenance:\n- Source dataset name\n- Publication date\n- Data provider\n\n**Decision:** Deferred to post-V2.0. Review implementation approach later.\n\n---\n\n### Accessibility: Colorblind Indicator\n\n**Priority:** Medium\n**Added:** 2026-01-21\n**Source:** UX Brainstorm Session\n\nV2.0 trend anomaly indicator uses red color only. Users with color blindness may not see it.\n\n**Options:**\n- Add small dot (‚óè) in corner of highlighted cells\n- Bold text for anomaly cells\n- Pattern overlay instead of color only\n\n**Decision:** Deferred. Evaluate based on user feedback post-launch.\n\n---\n\n### Newsletter: Media Topics + Spending Data\n\n**Priority:** Low (Marketing/Content)\n**Added:** 2026-01-21\n**Source:** UX Brainstorm Session\n\nContent marketing idea: Monitor Dutch media for trending topics, connect to spending data, create newsletter.\n\n**Concept:**\n- Track news topics (e.g., \"wolf protection\", \"climate adaptation\")\n- Link to relevant spending data in platform\n- Send newsletter: \"This week in the news + the EUR behind it\"\n\n**Value:**\n- Builds audience\n- Demonstrates platform value\n- Timely, relevant content\n\n**Decision:** Evaluate post-V2.0 as marketing initiative.\n\n---\n\n### AI Integration: MCP Server + OpenAI GPT\n\n**Priority:** Medium (Marketing/Lead Generation)\n**Added:** 2026-01-21\n**Source:** Brainstorm Session\n\nEnable AI assistants (Claude, ChatGPT) to query recipient spending data as a lead generation tool.\n\n**Strategy:** Citation without extraction\n- AI queries live data from Rijksuitgaven servers (not trained into models)\n- Returns teaser data with CTA to platform\n- Full details remain behind paywall\n\n**Example interaction:**\n```\nUser: \"How much did ProRail receive from the Dutch government?\"\n\nAI: \"ProRail B.V. received ‚Ç¨461M in 2024.\n     Sources: Financi√´le Instrumenten (‚Ç¨412M), Publiek (‚Ç¨49M)\n\n     üìä For trends, breakdowns, and exports: rijksuitgaven.nl\"\n```\n\n**What to expose (teaser):**\n- Recipient name + total amount (latest year)\n- Which modules they appear in\n- Record count\n\n**What stays behind paywall:**\n- Year-over-year breakdown\n- Drill-down by Regeling, Artikel, etc.\n- Export functionality\n\n**Technical components:**\n1. Public API endpoint: `/api/public/recipient?name=X`\n2. MCP server wrapper (for Claude)\n3. OpenAI GPT Action (for ChatGPT)\n4. robots.txt: Block training crawlers, allow search crawlers\n\n**Effort:** 8-12 hours total\n\n**Decision:** Post-V2.0. Implement after platform stable.\n\n---\n\n### Entity Resolution: Module Views (Case Normalization)\n\n**Priority:** High - V2.0 Release\n**Added:** 2026-01-29\n**Related:** Extends previous entity resolution work (scripts/sql/009-entity-resolution-normalization.sql)\n\n**Problem:**\nRecipient case variations still appear as separate rows in individual module views:\n- \"politie\", \"Politie\", \"POLITIE\" shown separately in Financi√´le Instrumenten\n- \"Politieke beweging DENK\", \"Politieke Beweging DENK\", \"Politieke Beweging Denk\" as 4 rows\n- Same recipient, different casing = different aggregated totals\n\n**Root Cause:**\nThe `normalize_recipient()` function was applied to `universal_search` (integraal) but NOT to individual module aggregated views.\n\n**Solution:**\nRebuild all module aggregated views using `normalize_recipient()` in the GROUP BY, with first-letter capitalization for display.\n\n**Status:** ‚úÖ COMPLETED (2026-01-29)\n- ‚úÖ `instrumenten_aggregated` - Done\n- ‚úÖ `inkoop_aggregated` - Done\n- ‚úÖ `provincie_aggregated` - Done\n- ‚úÖ `gemeente_aggregated` - Done\n- ‚úÖ `publiek_aggregated` - Done\n- ‚ûñ `apparaat_aggregated` - Not needed (uses kostensoort, not recipients)\n\n**Script:** `scripts/sql/010-normalize-module-aggregated-views.sql`\n\n---\n\n### Semantic Search: Dutch Language Awareness\n\n**Priority:** ‚úÖ V2.1 COMPLETE\n**Added:** 2026-01-29\n**V2.1 Completed:** 2026-01-29\n**Target:** V3.0 (embeddings)\n\n**Problem:**\nCurrent keyword search (`ILIKE '%term%'`) matches substrings without understanding meaning.\n\nExample: \"politie\" (police) matches \"Politieke\" (political) - completely different domains.\n\n| Search | Current Result | Desired |\n|--------|----------------|---------|\n| politie ‚Üí Politie | ‚úÖ | ‚úÖ |\n| politie ‚Üí Politieacademie | ‚úÖ | ‚úÖ |\n| politie ‚Üí Politieke beweging | ‚úÖ | ‚ùå |\n\n**V2.1 Implementation (COMPLETE):**\n1. **Dutch word rules:** For searches ending in \"-ie\", exclude \"-iek\" false cognates\n2. **Option C ranking:** Exact match first, then everything else by totaal (biggest money flows)\n\n**Roadmap:**\n\n| Version | Approach | Effort | Accuracy | Status |\n|---------|----------|--------|----------|--------|\n| V2.1a | Dutch word rules + Option C ranking | 4-8 hours | ~90% | ‚úÖ Complete |\n| V2.1b | Embeddings (Cohere, vector similarity) | 2-3 days | ~95% | Planned |\n\n**V3.0 Embeddings:**\n- **Vendor:** Cohere embed-multilingual-v3 (native Dutch support)\n- **Scope:** Full database (~9M tokens: recipients, regelingen, omschrijvingen)\n- **Cost:** ‚Ç¨0.90 one-time, ~‚Ç¨1/month\n- **Storage:** pgvector in Supabase (already enabled)\n\n**Benefits:**\n- Filter false positives semantically\n- Entity clustering (group related organizations)\n- Theme search (\"infrastructure\" finds rail, road, water entities)\n- Multilingual queries\n\n**Design document:** `docs/plans/2026-01-29-semantic-search-design.md`\n\n---\n\n### Filters UX Review\n\n**Priority:** Medium (UX)\n**Added:** 2026-01-31\n**Type:** UX / Review\n\n**Task:**\nTake a close look at the filter panel UX and identify improvements needed.\n\n**Areas to review:**\n- Filter layout and organization\n- Filter interaction patterns\n- Mobile filter experience\n- Filter state clarity (what's active)\n- Clear/reset behavior\n- Performance of filter dropdowns\n\n**Decision:** Schedule UX review session.\n\n---\n\n### Extra Columns Behavior During Search\n\n**Priority:** Medium (UX Discussion)\n**Added:** 2026-01-31\n**Type:** UX / Brainstorm\n\n**Current Behavior:**\nWhen user searches, the \"Gevonden in\" column replaces user-selected extra columns. User's column preferences disappear during search.\n\n**Questions to Discuss:**\n1. Should extra columns remain visible alongside \"Gevonden in\"?\n2. Should \"Gevonden in\" be a separate, always-available column?\n3. Should users be able to toggle between views?\n4. What happens on mobile where space is limited?\n\n**Decision:** Requires UX discussion with founder.\n\n---\n\n### Railway Private Networking for Typesense\n\n**Priority:** Low (Cost Optimization)\n**Added:** 2026-01-29\n\n**Problem:**\nBackend API connects to Typesense via public URL, incurring egress fees. Railway supports private networking between services in the same project.\n\n**Current State:**\n- Both services have private networking enabled\n- `typesense.railway.internal` shows \"Ready to talk privately\"\n- Connection fails with \"All connection attempts failed\"\n- Public URL works fine\n\n**Attempted:**\n- Port 8080 (Railway PORT variable)\n- Port 8108 (Typesense default)\n- Hostname `typesense.railway.internal`\n- Hostname `typesense` (short form)\n\n**Possible Causes:**\n- Caddy reverse proxy configuration (Typesense uses Caddy)\n- IPv6/IPv4 resolution issues\n- Service binding to localhost instead of 0.0.0.0\n\n**Decision:** Use public URL for now. Egress costs are minimal for search traffic. Investigate later if costs become significant.\n\n---\n\n### Filter Performance Optimization\n\n**Priority:** Medium (UX Impact)\n**Added:** 2026-02-05\n**Type:** Performance\n\n**Problem 1: Large filter result sets are slow**\nWhen filtering by a Regeling or Begroting with many recipients, the query takes 500ms+.\n- Current path: Typesense ‚Üí PostgreSQL aggregated view with WHERE clause\n- Large result sets need re-aggregation\n\n**Problem 2: Filter dropdown options are slow to load**\nWhen switching between filter dropdowns (e.g., Regeling ‚Üí Artikel), the new dropdown takes a long time to populate.\n- Each dropdown calls `/api/v1/modules/{module}/filters/{field}`\n- Queries DISTINCT values from database\n- Large fields (Regeling: 2000+ options) are slow\n\n**Solutions Pipeline:**\n\n| Option | Problem Solved | Effort | Impact |\n|--------|----------------|--------|--------|\n| **Filter-specific indexes** | #1 | 2 hours | Medium |\n| **Pre-cache filter options** | #2 | 4 hours | High |\n| **Typesense data enrichment (V2.1)** | #1 | 1-2 days | High |\n| **Progressive dropdown loading** | #2 | 4 hours | Medium |\n| **Redis cache for filter combos** | #1, #2 | 4-8 hours | High |\n\n**Quick Wins (V2.0):**\n1. Add B-tree indexes on filter columns in source tables (reduces 900ms ‚Üí 300ms)\n\n**V2.1 Solution (Recommended):**\n- **Typesense facets** - Use built-in faceting feature for filter dropdowns\n- Single request returns search results + all filter option counts\n- ~10ms response time (vs 300-900ms PostgreSQL DISTINCT)\n- Aligns with Typesense data enrichment work\n- No additional infrastructure needed\n\n**Decision:** V2.0 quick fix with indexes. V2.1 full solution with Typesense facets.\n\n---\n\n### Mobile Responsiveness Audit (COMPLETED)\n\n**Priority:** High (V2.0)\n**Added:** 2026-02-03\n**Updated:** 2026-02-18\n**Completed:** 2026-02-18\n**Type:** UX / Testing\n**Status:** ‚úÖ COMPLETED\n\n**Audit Results:**\n4 parallel audit agents reviewed all public-facing pages at 375px viewport ‚Äî 25 issues found across CRITICAL/HIGH/MEDIUM/LOW severity.\n\n**18 fixes across 10 files:**\n- Header nav: scroll fade indicators (left/right gradient overlays)\n- Auth button: 4 touch target fixes (min-h/w-[44px])\n- Footer: social icon negative margin technique, link spacing\n- Mobile banner: `relative` class fix\n- Over page: responsive grid (grid-cols-1 sm:grid-cols-3)\n- 404 page: responsive text size (text-[5rem] sm:text-[8rem])\n- Verlopen/Login: touch target compliance (py-3 + min-h-[44px])\n- Cookie banner: mobile padding (px-4 sm:px-6)\n- Homepage: card/discovery mobile padding, share button touch targets\n\n**Commit:** `2606c57`\n\n---\n\n### Search Performance Optimization (COMPLETED)\n\n**Priority:** ‚úÖ COMPLETE (Phase 1 + Phase 2)\n**Added:** 2026-02-03\n**Updated:** 2026-02-09\n**Status:** ‚úÖ COMPLETED\n**Type:** Performance\n\n**Phase 1 - COMPLETE (2026-02-03):**\n- Target: <100ms\n- Achieved: ~130-280ms (via parallel query execution)\n- Implementation: `asyncio.gather()` for main/count/totals queries\n- Commit: `ee055a4`\n\n**Previous Optimizations (already applied):**\n1. ‚úÖ Materialized views\n2. ‚úÖ pg_trgm + GIN indexes\n3. ‚úÖ Hybrid Typesense ‚Üí PostgreSQL search\n4. ‚úÖ Functional indexes on normalize_recipient()\n5. ‚úÖ Parallel query execution (Phase 1)\n\n**Phase 2 - COMPLETE (2026-02-09):**\n- Enriched recipients Typesense collection with year amounts (y2016-y2024), years_with_data, record_count\n- Integraal search now uses Typesense hybrid: `_typesense_search_recipient_keys()` ‚Üí WHERE ontvanger_key = ANY($1)\n- Regex fallback if Typesense returns 0 results\n- Production results: ~97-152ms warm (was ~200ms regex)\n- Commit: `f2a97c1`\n- Recipients collection: 463,731 docs re-synced with enriched data\n\n**Note:** Original Phase 2 goal was \"skip PostgreSQL entirely\" (~25-50ms target). Actual implementation uses Typesense for key lookup + PostgreSQL WHERE IN for data retrieval (~100ms). Full PostgreSQL bypass would require serving year amounts from Typesense directly, which isn't needed now that hybrid search is fast enough.\n\n---\n\n### GitHub Projects Visual Dashboard\n\n**Priority:** Low (V2.2)\n**Added:** 2026-02-09\n**Status:** BACKLOGGED\n**Type:** Tooling / Process\n\n**Problem:**\nBacklog, roadmap, and release tracking live in markdown files. Works well for development (Claude reads them directly) but lacks visual overview for non-technical stakeholders (sales partner).\n\n**Proposed Solution:**\nGitHub Projects board as a **read-only dashboard** on top of existing markdown:\n- Board view: Triage ‚Üí Backlog ‚Üí In Progress ‚Üí Done\n- Roadmap view: timeline grouped by milestone (V2.0, V2.1, V3.0, etc.)\n- Issues are lightweight pointers (title + label + link to markdown spec)\n- Partner can submit ideas via `idea`-labeled issues ‚Üí Triage column\n- Markdown stays source of truth; board is a view, not a second system\n\n**Setup:** ~30 minutes. Requires `gh auth refresh -s project` for CLI access.\n\n**Decision:** Not needed for launch. Revisit in V2.2 polish phase or when partner needs independent visibility.\n\n---\n\n### Invite Email for New Members (COMPLETED)\n\n**Priority:** High (V2.0 ‚Äî just before launch)\n**Added:** 2026-02-11\n**Completed:** 2026-02-11\n**Status:** ‚úÖ COMPLETED\n**Type:** Feature\n\n**Problem:**\nWhen admin adds a new member via `/team/leden`, `admin.createUser()` creates the auth user but does NOT send an email. Users don't know they have an account.\n\n**Solution Implemented:**\n- `invited_at` column on subscriptions table (migration 033)\n- `POST /api/v1/team/leden/[id]/invite` endpoint\n- Per-row \"Uitnodigen\" / \"Opnieuw\" buttons in `/team/leden`\n- Status lifecycle: Aangemaakt ‚Üí Uitgenodigd ‚Üí Actief\n- Handles existing users gracefully (generateLink + Resend fallback)\n\n---\n\n### Contact-to-Subscriber Flow (Admin Module)\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-14\n**Completed:** 2026-02-14\n**Status:** ‚úÖ COMPLETED\n**Type:** Feature / Admin UX\n\n**Implemented as part of CRM Phase 2 (unified `people` table):**\n- \"Maak lid\" button on each contact row in `/team/contacten`\n- `POST /api/v1/team/contacten/[id]/convert` ‚Äî creates auth user + subscription for existing person\n- Modal with plan/role/start date selection\n- Reverse flow automatic: soft-deleting a member preserves subscription history ‚Üí person shows as \"churned\" on contacten\n- Type is computed (not stored): no subscription = prospect, expired = churned, active = member\n- Migration 045 (people table) + 046 (soft-delete)\n\n---\n\n### Row Selector for Bulk Actions (Admin Module)\n\n**Priority:** Low (V2.1+)\n**Added:** 2026-02-11\n**Status:** ‚è≥ Backlog\n**Type:** Feature / UX\n\n**Problem:**\nWhen managing many members (e.g., after WordPress import), admin may want to perform actions on multiple members at once (invite all, deactivate selected, etc.).\n\n**Solution:**\nAdd checkbox column to `/team/leden` table with bulk action bar:\n- Select individual rows or \"select all\"\n- Bulk actions: Invite selected, Deactivate selected\n- Confirmation dialog before destructive actions\n\n**Estimated effort:** 2-3 hours\n\n---\n\n### Integraal View: Cross-Module Data Completeness\n\n**Priority:** Medium (V2.1 ‚Äî Database Structure)\n**Added:** 2026-02-11\n**Status:** ‚è≥ Backlog\n**Type:** Architecture / Data\n\n**Problem:**\nThe `universal_search` materialized view aggregates recipients across modules but lacks cross-module detail fields. Most notably, **regelingen** (regulations) exist in multiple modules (instrumenten, publiek) but are NOT available in the integraal view. This limits the integraal view to: ontvanger, year amounts, totaal, and module list.\n\n**Goal:**\nEnrich the integraal view so it can surface module-specific data like regelingen, making it a true cross-module discovery layer. Users searching in integraal should be able to see which regelingen a recipient is associated with, without needing to drill into each module separately.\n\n**Fields to evaluate for inclusion:**\n\n| Field | Source Modules | Priority |\n|-------|---------------|----------|\n| regelingen | instrumenten, publiek | High |\n| begrotingsnaam | instrumenten | Medium |\n| categorie | inkoop | Medium |\n| trefwoorden | publiek | Low |\n\n**Approach Options:**\n1. **JSONB column** ‚Äî Store module-specific fields as JSON (e.g., `extra_data: { regelingen: [...], categorie√´n: [...] }`)\n2. **Separate junction table** ‚Äî `recipient_regelingen` mapping table linking ontvanger_key to regelingen across modules\n3. **Array columns** ‚Äî Add `regelingen text[]`, `categorie√´n text[]` etc. as array columns on `universal_search`\n\n**Decision:** Requires design brainstorm. Related to existing \"Integraal View Redesign\" backlog item. May be combined.\n\n---\n\n### Branded Magic Link Email Template\n\n**Priority:** High (V2.0 ‚Äî before launch)\n**Added:** 2026-02-11\n**Completed:** 2026-02-11\n**Status:** ‚úÖ COMPLETED\n**Type:** Polish\n\n**Problem:**\nCurrent magic link email uses Supabase default template. Looks unprofessional compared to industry standard (e.g., Claude.ai uses logo, centered card layout, prominent CTA button).\n\n**Solution:**\nCreate branded HTML email template matching Rijksuitgaven brand identity:\n- Logo at top (hosted image URL)\n- Centered white card on light background\n- Heading: \"Inloggen bij Rijksuitgaven.nl\"\n- Subtext: \"Klik op de onderstaande knop om in te loggen\"\n- Pink CTA button (#E62D75): \"Inloggen\"\n- Footer: \"Als u dit niet heeft aangevraagd, kunt u deze e-mail negeren.\"\n- Contact info in footer\n\n**Implementation:**\n1. Upload logo to public URL (e.g., `https://beta.rijksuitgaven.nl/logo.png`)\n2. Create HTML template (use Resend/MJML/React Email for responsive design)\n3. Test template with email preview tool\n4. Paste HTML into Supabase Dashboard > Authentication > Email Templates > \"Magic Link\"\n5. Also update \"Invite User\" template with same branding (for member invites)\n6. Send test emails to verify rendering across clients (Gmail, Outlook, Apple Mail)\n\n**Templates to update:**\n- Magic Link (for login)\n- Invite User (for new member onboarding)\n\n**Reference:** Claude.ai email style ‚Äî logo, centered card, large button, minimal text\n\n**Estimated effort:** 1 hour (HTML template + testing)\n\n**Related:** Invite email for new members (separate backlog item)\n\n---\n\n### Search: Accurate Multi-Field Match Reporting\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-12\n**Status:** BACKLOGGED\n**Type:** Search / UX\n\n**Problem:**\nWith multi-word AND search (e.g., `rode kruis`), the \"Gevonden in\" column uses a heuristic: it checks only the **first word** to determine which field matched. This can be inaccurate when words match across different fields (e.g., \"rode\" in `ontvanger`, \"kruis\" in `regeling`). Since matched_field is a UI hint (not a filter), this is acceptable for V2.0.\n\n**V2.1 Improvement:**\n- Check all words against all fields, report all matched fields\n- Possibly highlight each word in its respective field\n- Requires minor UI change to show multiple matched fields\n\n**Estimated effort:** 2-4 hours\n\n---\n\n### Search: Fuzzy/Typo Tolerance\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-12\n**Status:** BACKLOGGED\n**Type:** Search / UX\n\n**Problem:**\nV2.0 search requires exact spelling. Users who misspell recipient names (e.g., \"proraill\" instead of \"prorail\") get no results. Typesense already supports `num_typos` parameter for typo tolerance, but it's not exposed in the current implementation.\n\n**V2.1 Improvement:**\n- Enable Typesense `num_typos: 1` or `2` for autocomplete and search\n- PostgreSQL regex fallback stays exact (acceptable ‚Äî Typesense handles most searches)\n- May need UI indicator: \"Bedoelde u: ProRail?\" for fuzzy matches\n\n**Estimated effort:** 2-4 hours\n\n---\n\n### Search: Field-Specific Search Syntax\n\n**Priority:** Low (V3+)\n**Added:** 2026-02-12\n**Status:** BACKLOGGED\n**Type:** Search / Power User\n\n**Problem:**\nPower users may want to search within specific fields. Currently all searches go across all searchable fields for a module. There's no way to say \"only search in leverancier\" or \"only search in regeling\".\n\n**Syntax idea:** `leverancier:prorail` or `regeling:subsidie`\n\n**Deferred to V3+** ‚Äî requires parser extension, field validation per module, and UI for field selection. Not needed for V2.0 audience.\n\n**Estimated effort:** 4-8 hours\n\n---\n\n### Email Campaign Management (Resend Broadcasts)\n\n**Priority:** High (V2.0 ‚Äî before launch, replaces WordPress/Mailster)\n**Added:** 2026-02-12\n**Updated:** 2026-02-13\n**Status:** ‚è≥ IN PROGRESS (people table + admin UI done, migration + Resend Audience + campaign template remaining)\n**Type:** Infrastructure / Marketing\n\n**Problem:**\nCurrent email campaigns run on WordPress + Mailster + Mailgun at `nieuws.rijksuitgaven.nl`. This requires maintaining a separate WordPress server, the tooling is dated, and it's disconnected from the new platform. Goal is to cut WordPress entirely at launch.\n\n**Decision:** Resend Broadcasts (already in stack for transactional email).\n\n**Why Resend:**\n- Already handles magic link + invite emails (zero new vendors)\n- Single contact list shared with transactional (subscriptions ‚Üí Resend Audience)\n- React Email templates (same tech as existing `docs/email-templates/`)\n- Broadcast API enables programmatic sends (V3 Reporter ready)\n- Free for 1,000 contacts, $40/mo for 5,000+\n- Kills WordPress dependency entirely\n\n**Implementation Steps:**\n1. ‚úÖ Create `contacts` table in Supabase (migration 036-contacts.sql written, not yet executed)\n2. ‚úÖ Build admin UI at `/team/contacten` (new tab in team nav) ‚Äî UX-028\n3. ‚úÖ Sync contacts ‚Üí Resend Audience (on create/update/delete) ‚Äî fire-and-forget helper\n4. ‚è≥ Execute migration on Supabase production\n5. ‚è≥ Create Resend Audience and configure `RESEND_AUDIENCE_ID` env var\n6. ‚è≥ Build branded campaign template (React Email, reuse existing brand components)\n7. ‚è≥ Send test broadcast, verify open/click tracking\n8. ‚è≥ Migrate Mailster contacts into `contacts` table\n9. ‚è≥ Backfill contacts from subscriptions table (subscriber type)\n10. ‚è≥ Document campaign workflow for founder (dashboard ‚Üí new broadcast ‚Üí send)\n11. After launch: decommission `nieuws.rijksuitgaven.nl` and WordPress server\n\n**Contacts Table Design:**\n```sql\ncontacts (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  email text NOT NULL UNIQUE,\n  first_name text,\n  last_name text,\n  organization text,\n  type text NOT NULL DEFAULT 'prospect',  -- prospect | subscriber | churned\n  source text,                             -- website | event | referral | import\n  notes text,\n  resend_contact_id text,                  -- Resend Audience contact ID\n  subscription_id uuid REFERENCES subscriptions(id),  -- link to subscription if exists\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now()\n)\n```\n\n- Subscribers auto-created from `subscriptions` table (backfill + trigger/sync)\n- Prospects added via `/team/contacten` admin page\n- Type transitions: prospect ‚Üí subscriber (on subscription create), subscriber ‚Üí churned (on expiry)\n- Sync to Resend Audience on create/update via API\n\n**What Resend Broadcasts provides:**\n- Visual block editor (headings, text, images, buttons, dividers)\n- Open rate + click tracking + bounce tracking\n- Audience management with auto-unsubscribe (GDPR)\n- Scheduling (natural language: \"tomorrow at 9am\")\n- Personalization with audience data variables\n\n**What it does NOT provide (acceptable trade-offs):**\n- No drag-and-drop multi-column layouts (use React Email for complex templates)\n- No A/B subject line testing (yet)\n- No automation sequences / drip campaigns (yet ‚Äî single broadcasts only)\n\n**Estimated effort:** 6-10 hours (contacts table + admin UI + Resend sync + campaign template)\n\n---\n\n### Interactive Search Demo on Homepage (No Login Required)\n\n**Priority:** High (V2.0 ‚Äî work on soon)\n**Added:** 2026-02-12\n**Completed:** 2026-02-17\n**Status:** ‚úÖ COMPLETED\n**Type:** Feature / Conversion\n**Source:** Homepage audit ‚Äî creative team Brief 2, item 6\n\n**Problem:**\nThe homepage describes the product with screenshots and copy but never lets visitors *experience* it. Top-performing SaaS companies (Algolia, Airtable, Notion) convert by letting visitors touch the product before signing up.\n\n**Proposed Solution:**\nA sandboxed search experience embedded on the homepage ‚Äî limited to one module (e.g., Instrumenten) and one year (e.g., 2024). Visitor types a query, sees real results with real amounts, experiences the speed. Teaser data only (no drill-down, no export). CTA at bottom: \"Wilt u alle 9 jaren en 6 databronnen? Vraag een demo aan.\"\n\n**Technical Approach:**\n- Public BFF endpoint: `GET /api/v1/public/search?q=...` (rate-limited, no auth)\n- Returns top 5 recipients with name + 2024 amount only\n- Backend: query `universal_search` with LIMIT 5, single year column\n- Frontend: lightweight search input + results list component on homepage\n- No TanStack Table, no filters, no export ‚Äî minimal UI\n\n**Key Decisions Needed:**\n1. Which module/year to expose?\n2. Rate limiting strategy (Cloudflare required first ‚Äî see rate limiting backlog item)\n3. Should results link to login page or contact form?\n\n**Estimated effort:** 8-12 hours (BFF endpoint + frontend component + rate limiting)\n\n---\n\n### Tab-Based Feature Explorer (Homepage Features Section)\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-12\n**Status:** ‚è≥ Backlog\n**Type:** UX / Design\n**Source:** Homepage audit ‚Äî creative team, Features section review\n\n**Problem:**\nThe current features section uses a 3x2 grid of equal-sized screenshot cards. While functional, this is a generic SaaS pattern. World-class data platforms (Linear, Stripe, Notion) use more engaging formats that keep visitors in the section longer and create visual hierarchy.\n\n**Proposed Solution:**\nReplace the 6-card grid with a tab-based feature explorer ‚Äî one large browser frame with 6 tabs above it. Click a tab, the screenshot and description change. Mirrors the Audience section interaction pattern already on the page.\n\n```\n[ Zoeken ] [ Details ] [ Integraal ] [ Begroting ] [ Filteren ] [ Export ]\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                     ‚îÇ\n‚îÇ          LARGE SCREENSHOT           ‚îÇ\n‚îÇ                                     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n  Title and description below\n```\n\n**Benefits:**\n- Larger screenshots = more readable product previews\n- Tab clicks = micro-engagement ‚Üí higher conversion on CTA below\n- Consistent interaction pattern with Audience section\n- Mobile-friendly (tabs as pills, single screenshot)\n- Government buyers are methodical ‚Äî they'll click through each tab\n\n**Also consider (when implementing):**\n- Update card content: replace \"Ontdek bestedingen\", \"Wat is er nieuw?\", \"Wie ontvangt het meest?\" with \"Integraal doorzoeken\", \"Slim filteren\", \"Exporteren naar Excel\"\n- Auto-advance with progress bar (same as Audience section)\n- Keyboard navigation between tabs\n\n**Estimated effort:** 4-5 hours\n\n---\n\n### Audience-Personalized Landing Variants\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-12\n**Status:** ‚è≥ Backlog\n**Type:** Feature / Marketing\n**Source:** Homepage audit ‚Äî creative team Brief 2, item 7\n\n**Problem:**\nOne homepage serves 5 distinct audiences (journalists, municipalities, political parties, businesses, academics). Each has different buying triggers, pain points, and language. A journalist cares about \"onthullingen\" while a municipality cares about \"vergelijkbaarheid.\" Serving everyone the same page means no one gets the most compelling pitch.\n\n**Proposed Solution:**\nAudience-specific landing variants using query params or UTM paths:\n- `rijksuitgaven.nl/?ref=journalist` ‚Üí Media-focused hero, case study, export emphasis\n- `rijksuitgaven.nl/?ref=gemeente` ‚Üí B2G section first, compliance language, onboarding CTA\n- `rijksuitgaven.nl/?ref=politiek` ‚Üí Accountability angle, transparency focus\n- `rijksuitgaven.nl` (default) ‚Üí General page (current)\n\n**Technical Approach:**\n- Same `PublicHomepage` component, conditional content via `useSearchParams()`\n- Content arrays per audience (hero copy, featured case study, CTA text)\n- Section order rearranged per audience (e.g., B2G first for gemeente)\n- Shared components, no code duplication\n\n**Key Decisions Needed:**\n1. Which audiences get their own variant? (Start with journalist + gemeente?)\n2. How are visitors routed? (UTM links from campaigns, LinkedIn ads, etc.)\n3. Do we need analytics per variant first? (See Analytics backlog item)\n\n**Estimated effort:** 6-8 hours per variant (copy + conditional rendering + testing)\n\n---\n\n### Campaign Analytics: Bounce Auto-Suppress (V2.1)\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-19\n**Status:** ‚è≥ Backlog\n**Type:** Feature / Email\n\n**Problem:**\nWhen an email bounces permanently (hard bounce), Resend marks it, but we continue trying to send to that address in future campaigns. This wastes sends and hurts sender reputation.\n\n**Solution:**\nAuto-suppress recipients after N hard bounces (e.g., 2). Mark `bounced_at` on people table. Exclude from future campaign sends. Show \"Geblokkeerd\" status in admin UI.\n\n**Estimated effort:** 2-3 hours\n\n---\n\n### Campaign Analytics: Complaint Auto-Unsubscribe (V2.1)\n\n**Priority:** Medium (V2.1)\n**Added:** 2026-02-19\n**Status:** ‚è≥ Backlog\n**Type:** Feature / Email / GDPR\n\n**Problem:**\nWhen a recipient marks email as spam (complaint), we should immediately unsubscribe them. Currently we track the complaint but don't auto-unsubscribe.\n\n**Solution:**\nOn `email.complained` webhook, automatically set `unsubscribed_at` on the person. Remove from Resend contacts. Same as manual unsubscribe flow.\n\n**Estimated effort:** 1 hour\n\n---\n\n### Campaign Event Retention Cleanup (V2.1)\n\n**Priority:** Low (V2.1)\n**Added:** 2026-02-19\n**Status:** ‚è≥ Backlog\n**Type:** Maintenance / Data\n\n**Problem:**\n`campaign_events` table grows with every open/click. At 100 campaigns √ó 500 recipients √ó ~10 events each = ~500K rows/year. Acceptable now but needs periodic cleanup.\n\n**Solution:**\nDelete individual events older than 1 year, keeping only aggregated counts on the campaigns table. Run as manual SQL or scheduled cron.\n\n**Estimated effort:** 1 hour\n\n---\n\n### SEO Optimization (Pre-Launch)\n\n**Priority:** High (Pre-Launch)\n**Added:** 2026-02-18\n**Status:** ‚è≥ TODO (V2.0 ‚Äî before launch)\n**Type:** SEO / Marketing\n\n**Problem:**\nLighthouse SEO score is 100 after basic fixes, but several SEO best practices are still missing. These matter for search engine visibility and social sharing (LinkedIn, X) when promoting the platform.\n\n**Current state:**\n- Title: \"Rijksuitgaven.nl\"\n- Description: \"Snel inzicht in rijksuitgaven voor krachtige analyses\"\n- OpenGraph: title + description + type + locale\n- `robots.txt`: basic allow/disallow\n- `html lang=\"nl\"`: set\n- `metadataBase`: `https://beta.rijksuitgaven.nl` (needs updating at launch)\n\n**Missing:**\n1. **Twitter/X card metadata** ‚Äî no `twitter:card`, `twitter:title`, `twitter:description`\n2. **OG image** ‚Äî no `og:image` for social sharing previews (LinkedIn, X, Slack)\n3. **Per-page metadata** ‚Äî module pages, login, privacy, team pages all use default title/description\n4. **Structured data (JSON-LD)** ‚Äî no Organization, WebSite, or SoftwareApplication schema\n5. **Sitemap.xml** ‚Äî route exists but may not generate meaningful content\n6. **Canonical URLs** ‚Äî not explicitly set\n7. **metadataBase** ‚Äî update from `beta.rijksuitgaven.nl` to `rijksuitgaven.nl` at DNS switch\n\n**Implementation priority:**\n1. OG image (highest impact for social sharing)\n2. Twitter card metadata\n3. Per-page titles/descriptions\n4. Structured data\n5. Sitemap content\n6. Canonical URLs\n\n**Estimated effort:** 2-3 hours\n\n---\n"
