# Daily Log — 2026-02-21

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V1.0 Development
**Sprint:** Week 8 — Marketing Pages & Final Polish (Day 5)
**Session Duration:** [to be filled]

---

## Summary

[To be completed at /closeday]

---

## Work Completed

### Session 1: Staging Environment Setup (1 commit)
1. **V0.9 beta milestone** — 10 beta testers invited, beta.rijksuitgaven.nl is now "production"
2. **Development workflow discussion** — evaluated feature branches (free, immediate) vs staging environment (~€5-10/month). User chose staging.
3. **Design document** — `docs/plans/2026-02-21-staging-environment.md` — covers current vs proposed setup, branch strategy, shared resources, workflow, cost impact, future production transition
4. **Git branch** — created `staging` branch from `main`, pushed to origin
5. **Railway service** — user duplicated production frontend service → "Frontend Staging", configured source branch `staging`, root directory `/app`, generated public domain
6. **Staging URL** — `frontend-staging-production-ce7d.up.railway.app` — verified working with login
7. **ALLOWED_HOSTS update** — added staging URL to whitelist in both `magic-link/route.ts` and `invite/route.ts` (auth security — prevents x-forwarded-host injection while allowing staging auth callbacks)
8. **Pushed to both branches** — `main` (so production knows staging host) and `staging` (so staging can deploy it)

### Session 2: Staging Processes (1 commit)
1. **Expert team review** — 5-person team (Release Engineer, Platform Engineer, QA Lead, DevOps Security, Adversarial Strategist). 10 verification questions.
2. **Found stale local branch** — `git push origin main:staging` doesn't update local tracking branch. Fixed with `git branch -f staging main`.
3. **Three workflows defined** — A: Quick Fix (direct to main + sync), B: Feature Development (staging first), C: Database Migration (migration first, code second)
4. **7 risks documented** — staging drift, code-before-migration, staging contamination, env var mismatch, shared DB breaks, stale local branch, real email sending
5. **Updated design document** — `docs/plans/2026-02-21-staging-environment.md` rewritten with full process rules, constraints, risks
6. **CLAUDE.md updated** — Staging Environment section added to Constraints (mandatory sync rules, staging-first workflow)

### Session 3: UX-039 Vergelijk — Row Pinning (1 commit, staging only)
1. **Expert team brainstorm** — 5-person team (Data Table UX Lead, Information Architect, Frontend Performance Engineer, Domain Expert, Adversarial Strategist). 15 verification questions.
2. **3 approaches evaluated** — A: Sticky bottom bar, B: Pin to top (recommended), C: Side panel (rejected — no space)
3. **Cross-module pinning discussed** — technically possible (year columns identical) but not worth building (Integraal already serves this use case)
4. **Requirement written** — UX-039 in search-requirements.md with full spec
5. **Implementation** — TanStack Table native `RowPinning` API:
   - Pin icon on hover (left of expand chevron), `opacity-0 group-hover:opacity-100`
   - PinOff icon (pink) replaces both icons when pinned — click to unpin
   - Pinned rows: `bg-blue-50/60` + `border-l-2 border-l-[var(--pink)]`
   - Separator line between pinned and scrollable rows
   - Max 4 pins, disabled with tooltip when full
   - Expand disabled on pinned rows
   - "Wis selectie" link + count below table
   - Pins cleared on module switch
   - Export dropdown: "Exporteer alles (N)" / "Exporteer selectie (N)" when pins exist
   - `ExportDropdown` component with click-outside close
6. **Tooltip fix** — CSS `data-tooltip-center` was clipped by table overflow. Switched to native `title` attribute. Labels: "Vastzetten"→"Vergelijk", "Losmaken"→"Verwijder"
7. **Pushed to staging only** — production untouched per new workflow (2 commits)

### Session 4: UX-039 Styling Polish (1 commit, staging only)
1. **"Wis selectie" button restyled** — was plain pink text, now bordered button matching toolbar group (Info, Kolommen, CSV, XLS). Added `border border-[var(--pink)]/30`, `hover:bg-[var(--pink)]/5`, count in parentheses.
2. **Pushed to staging only** — commit `495a869`

---

## Files Created

| File | Description |
|------|-------------|
| `docs/plans/2026-02-21-staging-environment.md` | Staging environment design document (updated with processes) |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | Added staging URL to ALLOWED_HOSTS |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Added staging URL to ALLOWED_HOSTS |
| `CLAUDE.md` | Staging Environment section, budget updated €180→€190, UX counter UX-039→UX-040 |
| `docs/plans/2026-02-21-staging-environment.md` | Full rewrite: 3 workflows, risks, constraints |
| `app/src/components/data-table/data-table.tsx` | UX-039: Row pinning — Pin/PinOff icons, RowPinningState, getTopRows/getCenterRows, ExportDropdown, pinned row styling |
| `02-requirements/search-requirements.md` | UX-039 requirement entry added |

---

## SQL Migrations

| Migration | Description | Executed |
|-----------|-------------|----------|
| (none) | | |

---

## Architecture Decisions

| Decision | Rationale |
|----------|-----------|
| Staging = frontend only (shared backend/DB/Typesense) | Most changes are frontend/BFF; shared DB means real data for testing; minimal cost (~€5-10/month) |
| Branch strategy: feature → staging → main | Staging validates before beta testers see changes; quick fixes can still go direct to main |
| SQL migrations apply to shared DB | Additive migrations safe; destructive ones tested locally first |
| Row pinning per-module only (no cross-module) | Integraal module already serves cross-module comparison; different extra columns per module |
| TanStack Table native RowPinning API | No custom pinning logic needed; `enableRowPinning`, `getTopRows()`, `getCenterRows()` |
| All new work to staging only | Beta testers on production see stable version; batch promote when ready |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Auth won't work on staging (ALLOWED_HOSTS) | Added staging Railway URL to whitelist in both auth route files |
| Local `staging` branch stale after `git push origin main:staging` | `git branch -f staging main` after every sync |

---

## Next Steps

[To be completed at /closeday]

---

**Session Status:** In Progress
