# Daily Log — 2026-02-18

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V1.0 Development
**Sprint:** Week 8 — Marketing Pages & Final Polish (Day 1)
**Session Duration:** In progress

---

## Summary

Quality assurance, compliance, legal, content, and data quality day. Lighthouse audit (all scores >90), cross-browser CSS fixes, WCAG AA accessibility fixes, welcome email copy rewrite, complete privacy policy rewrite, Algemene Voorwaarden rewrite, footer rework, About page visual redesign, FAQ evaluation (deferred), post-login Support page with 5 accordion sections, data_availability audit (20 corrections executed on production), UX-035 datasets page, entity list sync, data table UX (ghost column removal, sticky Totaal, collapse chevron), and horizontal scroll indicator (4 iterations from failed box-shadow to dark navy gradient overlay). 33 commits across 7 sessions.

---

## Work Completed

### 1. Lighthouse Audit — All Scores >90
- Ran Lighthouse CLI against localhost and production (beta.rijksuitgaven.nl)
- **Pre-fix scores:** Performance 90, Accessibility 95, Best Practices 100, SEO 92
- **Post-fix scores:** Performance 93, Accessibility 100, Best Practices 100, SEO 100
- Saved reports to `logs/lighthouse/`

### 2. WCAG AA Accessibility Fixes
- **Color contrast:** Changed `--pink` from `#E62D75` (4.20:1) to `#D4286B` (4.87:1) — passes 4.5:1 AA minimum
- **Updated `--pink-hover`:** `#cc2968` → `#BD2060`
- **HTML landmark:** Changed homepage wrapper from `<div>` to `<main>` for screen reader navigation
- **Affects:** "Boek een demo" button, "Login" link, cookie banner OK button, "PROBEER HET ZELF" text

### 3. SEO Fix — robots.txt Middleware Redirect
- `robots.txt` was caught by auth middleware and redirected to `/login`
- Added `robots\\.txt|sitemap\\.xml` to middleware matcher exclusion regex
- SEO score: 92 → 100

### 4. Cross-Browser CSS Fixes
- Removed `will-change: opacity, transform` from scroll-reveal animations (memory leak prevention)
- Added cross-browser `.scrollbar-hide` class (Firefox `-ms-overflow-style: none` + `scrollbar-width: none` + Webkit `::-webkit-scrollbar`)
- Added Firefox `scrollbar-width: thin; scrollbar-color` to homepage feature carousel
- Removed redundant inline `style={{ scrollbarWidth: 'none' }}` from header nav
- Verified Tailwind v4 auto-prefixes `-webkit-backdrop-filter` (no fix needed)
- Verified `text-wrap: balance` degrades gracefully in Firefox (no fix needed)

### 5. Welcome Email Rewrite
- **Subject:** "activeer uw account" → "log direct in"
- **Body:** "account te activeren" → "direct in te loggen"
- **Button:** "Account activeren" → "Inloggen"
- **Button color:** `#E62D75` → `#D4286B` (WCAG fix)
- **Added:** "Rijksuitgaven is geoptimaliseerd voor desktop en laptop" note
- **Renamed:** `buildActivationEmail()` → `buildWelcomeEmail()`
- Updated Supabase fallback templates (`docs/email-templates/invite-user.html` + `magic-link.html`)

### 6. Privacy Policy Rewrite (Artikel 1-11)
- 4-expert legal team review (AVG/GDPR, Telecommunicatiewet, SaaS Legal, Adversarial)
- **New:** Legal entity disclosure (Het Maven Collectief, KvK: 96257008)
- **New:** Artikel 5 — Pseudonymized server-side analytics disclosure (was completely missing)
- **New:** Processor categories (EU only) — no vendor names (categories sufficient under AVG 13(1)(e))
- **New:** AP complaint right (Autoriteit Persoonsgegevens)
- **Fixed:** Cookie table with actual `sb-*-auth-token` + localStorage items
- **Fixed:** AVG legal bases cited per processing purpose
- **Fixed:** Specific retention periods per data type (90 days analytics, 7 years fiscal, 30 days sessions)
- 10 → 11 articles

### 7. Backlog Updates
- Added "SEO Optimization (Pre-Launch)" to backlog with 7 missing items
- Marked "Interactive Search Demo" as ✅ COMPLETED (done 2026-02-17 in H6 homepage)
- Confirmed "Homepage → production" already done (commit `4e0553e`)

### 8. Dashboard Error Cleanup
- Checked Fouten dashboard — 2 stale "Failed to fetch" autocomplete errors
- Confirmed guard already in place (lines 827-833 in filter-panel.tsx catch `Failed to fetch` before `track()`)
- User cleared errors manually

### 9. Algemene Voorwaarden (Terms of Service) — `/voorwaarden`
- 4-expert legal team review (Contractenrecht, IT-recht, Consumentenrecht, Adversarial)
- Reviewed current WordPress 16-article terms against new SaaS platform
- 6 questions to founder, all answered
- **Complete rewrite:** 16 articles updated for B2B SaaS
- **Key decisions:**
  - B2B only (no consumer herroepingsrecht)
  - Personal subscriptions via magic link (no passwords)
  - Pro-rata refund on yearly cancellation
  - Full disclaimer on data accuracy
  - Immediate cancellation, no grace period (no user data in V1)
  - Manual invoicing by Het Maven Collectief
- **New:** Artikel 5 — Sui generis databankrecht on processed public data
- **New:** 500-row export limit in usage rules
- **New:** Liability capped at 12-month subscription fees
- **New:** 60-day overmacht escape clause with pro-rata refund
- Added `/voorwaarden` to middleware public paths
- Added footer links (both auth/non-auth views)
- Added links in homepage contact form checkbox (both homepage.tsx and public-homepage.tsx)
- Added V1.1 note in VERSIONING.md: data export/retention for V2+ user-generated content

---

## Files Created

| File | Description |
|------|-------------|
| `logs/lighthouse/localhost-homepage.report.html` | Pre-fix Lighthouse report (localhost) |
| `logs/lighthouse/localhost-homepage.report.json` | Pre-fix Lighthouse JSON (localhost) |
| `logs/lighthouse/production-homepage.report.html` | Pre-fix Lighthouse report (production) |
| `logs/lighthouse/production-homepage.report.json` | Pre-fix Lighthouse JSON (production) |
| `logs/lighthouse/localhost-post-fix.report.html` | Post-fix Lighthouse report (localhost) |
| `logs/lighthouse/localhost-post-fix.report.json` | Post-fix Lighthouse JSON (localhost) |
| `logs/lighthouse/production-post-fix-2.report.html` | Post-fix Lighthouse report (production) |
| `logs/lighthouse/production-post-fix-2.report.json` | Post-fix Lighthouse JSON (production) |
| `app/src/app/voorwaarden/page.tsx` | Algemene Voorwaarden page (16 articles, B2B SaaS terms) |
| `app/src/app/over/page.tsx` | About page: content + visual redesign matching homepage |
| `app/src/app/support/page.tsx` | Post-login support page with 5 accordion sections |
| `scripts/sql/057-data-availability-corrections.sql` | 20 data_availability fixes (executed on production) |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/globals.css` | `--pink` #E62D75→#D4286B, `--pink-hover` #cc2968→#BD2060, removed will-change, added .scrollbar-hide class |
| `app/src/components/homepage/homepage.tsx` | `<div>` → `<main>` landmark, Firefox scrollbar styling, voorwaarden link |
| `app/src/components/homepage/public-homepage.tsx` | Voorwaarden link in contact form checkbox |
| `app/src/middleware.ts` | Added `robots\\.txt\|sitemap\\.xml` to matcher exclusions |
| `app/src/lib/supabase/middleware.ts` | Added `/voorwaarden` to public paths |
| `app/src/components/header/header.tsx` | Removed redundant inline scrollbarWidth style |
| `app/src/components/footer/footer.tsx` | Added "Algemene voorwaarden" link in both auth/non-auth sections |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Welcome email rewrite (copy, button, color, desktop note, function rename) |
| `docs/email-templates/invite-user.html` | Aligned with welcome email changes |
| `docs/email-templates/magic-link.html` | Heading "bij Rijksuitgaven", WCAG color fix |
| `app/src/app/privacybeleid/page.tsx` | Complete rewrite: 11 articles, legal entity, analytics, processors, AP rights |
| `02-requirements/backlog.md` | Added SEO backlog item, marked Interactive Search Demo complete |
| `docs/VERSIONING.md` | V1.1 note: data export/retention for V2+ user-generated content |
| `app/src/components/footer/footer.tsx` | Complete rewrite: 3 visual tiers, removed dead links, activated Over Rijksuitgaven, added Ondersteuning + Datasets links (logged-in) |
| `app/src/components/homepage/index.ts` | Added ScrollReveal to barrel export |
| `app/src/lib/supabase/middleware.ts` | Added `/over` to public paths |
| `02-requirements/search-requirements.md` | Added UX-035 Datasets Page requirement, marked ✅ Implemented |
| `scripts/data/DATA-UPDATE-RUNBOOK.md` | Added per-entity year_to guidance + verification queries + Step 8 entity list update |
| `app/src/app/page.tsx` | Module hub: added Arnhem, Barendrecht, De Ronde Venen to gemeente description |
| `app/src/app/support/page.tsx` | Replaced hardcoded entity names with counts + link to /dataoverzicht |
| `app/src/app/api/v1/dataoverzicht/route.ts` | BFF route for data availability (auth-gated Supabase query) |
| `app/src/app/dataoverzicht/page.tsx` | Dataoverzicht page with dynamic availability matrices |
| `app/src/components/data-table/data-table.tsx` | Removed ghost column, collapse chevron on first year, Totaal sticky right + shadow, scroll indicator overlay, "+N meer" grouping hint via expandGroupingRef |
| `app/src/components/data-table/expanded-row.tsx` | Same ghost column fix, colSpan adjustments, initialGrouping prop, added publiek groupable fields (regio, staffel, onderdeel) |
| `app/src/components/module-page/module-page.tsx` | Thread initialGrouping through renderExpandedRow callback |
| `backend/app/services/modules.py` | group_value ::text cast in SQL + str() in Python for integer columns |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Lighthouse Accessibility 95 (color contrast) | Changed `--pink` to `#D4286B` (4.87:1 ratio, passes WCAG AA 4.5:1) |
| Lighthouse Accessibility (no `<main>` landmark) | Changed homepage wrapper `<div>` → `<main>` |
| Lighthouse SEO 92 (robots.txt 307 redirect) | Added robots.txt/sitemap.xml to middleware exclusions |
| Firefox scrollbar visible in header nav | `.scrollbar-hide` class now covers all browsers |
| `will-change` memory leak in scroll animations | Removed `will-change: opacity, transform` from CSS |
| Welcome email misleading "activate" language | Rewritten as login-focused welcome message |
| Privacy policy missing analytics disclosure | New Artikel 5: pseudonymized analytics with legitimate interest basis |
| Privacy policy no legal entity | Added Het Maven Collectief, KvK: 96257008 |
| Privacy policy no AP complaint right | Added to Artikel 9.3 |
| Privacy policy vague cookie table | Specific `sb-*-auth-token` + localStorage items |

---

## Issues Resolved (continued)

| Issue | Solution |
|-------|----------|
| WordPress AV outdated for SaaS | Complete rewrite: 16 articles, B2B scope, magic link auth, pro-rata refund |
| AV consumer protections not needed | B2B explicit — Afnemer declares business capacity, no herroepingsrecht |
| No database right protection | Artikel 5: sui generis databankrecht on processed public data |
| "voorwaarden" not linked anywhere | Footer links + homepage checkbox links added |
| V2 data retention not planned | VERSIONING.md V1.1 note: 30-day export grace when user content exists |
| No post-login help/support section | `/support` page with 5 accordion sections, text-only, fresh content for new platform |
| Ghost empty column when years expanded | Deleted `collapse-years-header` column, moved collapse chevron to first year header |
| No horizontal scroll indicator on data table | Totaal column sticky right-0 with left-facing shadow provides visual scroll cue |
| WordPress FAQ outdated for new platform | Deferred — 7/12 questions already covered by /over page, content has accuracy problems |
| About page generic design | Visual redesign matching homepage: ScrollReveal, stat strip with pink borders, audience cards |
| `data_availability` table had incorrect year ranges | 20 corrections verified against source tables, executed on production (migration 057) |
| Runbook missing per-entity year_to guidance | Added verification queries and correct/wrong examples to DATA-UPDATE-RUNBOOK.md |
| "+N meer" doesn't select matching grouping | expandGroupingRef passes colKey to ExpandedRow's initialGrouping prop |
| Publiek missing groupable fields (regio, staffel, onderdeel) | Added to GROUPABLE_FIELDS in expanded-row.tsx |
| Inkoop staffel expand returns 500 error | Pydantic v2 rejects int→str; fixed with SQL `::text` cast + Python `str()` |
| box-shadow invisible on sticky elements in overflow | CSS spec limitation; used gradient overlay OUTSIDE overflow container |

## Commits

| Hash | Message |
|------|---------|
| `ed3b9a0` | Lighthouse audit fixes: accessibility 95→100, SEO 92→100 |
| `35aaeb6` | Cross-browser CSS fixes: scrollbar compat, will-change cleanup |
| `192f878` | Welcome email: remove misleading "activate" language, add desktop note |
| `5fceb64` | Update Supabase email templates: align with welcome email changes |
| `41429c2` | Privacy policy rewrite: AVG compliance, legal entity, analytics disclosure |
| `ae98ec0` | Docs: session documentation — 5 commits, Lighthouse+CSS+privacy+email |
| `de15a23` | Algemene Voorwaarden: B2B terms of service, 16 articles |
| `9b541e6` | Docs: session documentation — 7 commits, QA + legal day complete |
| `4fd3011` | Sprint plan: V0.9 private beta (10 users, 2 weeks) before V1.0 public launch |
| `71d5b51` | Footer rework: remove dead links, visual affordance for active vs inactive |
| `6765380` | Footer: remove Inloggen (header-only per industry standard) |
| `1d5ecf9` | Over Rijksuitgaven page: mission, audiences, independence, sources |
| `25babda` | About page visual redesign: homepage design language, stat strip, audience cards |
| `8b7d612` | Footer: remove Veelgestelde vragen (deferred until beta feedback) |
| `e5d711a` | Support page: post-login help with 5 accordion sections |
| `d9cfbf6` | Docs: session documentation — 16 commits, support page + about page + footer + legal |
| `ead631f` | UX-035 requirement + data_availability corrections (20 fixes) + runbook update |
| `13a2e63` | Docs: session 3 — data availability audit, 20 corrections, UX-035 requirement |
| `748d741` | UX-035: Datasets page — dynamic data availability matrix |
| `78ef622` | Remove source links from datasets page |
| `a54a760` | Docs: session 4 — UX-035 datasets page complete |
| `b77807b` | Rename /datasets to /dataoverzicht |
| `eff7a4d` | Docs: session 4 update — dataoverzicht rename documented |
| `8ffbf20` | Fix entity list drift: module hub + support page + runbook |
| `73c250f` | Data table UX: remove ghost column, sticky Totaal, collapse chevron on first year |
| `7b67322` | Docs: session 5 — data table UX improvements documented |
| `47bea08` | Data table: scroll-aware Totaal boundary indicator (shadow approach — FAILED) |
| `bf2ed09` | Data table: gradient fade overlay for scroll indicator (white gradient) |
| `d711da2` | Data table scroll indicator: body-only gradient, fix right edge |
| `8e6b0b9` | Data table scroll indicator: dark gradient instead of white |
| `be34e0e` | Data table scroll indicator: increase gradient visibility (0.18, 40px) |
| `2e2f83c` | Data table scroll indicator: slightly increase gradient opacity (0.22) |
| `39dff9f` | Docs: session 6 — scroll indicator (4 iterations, dark gradient final) |
| `f9a6d0f` | Data table: "+N meer" click pre-selects matching grouping in expanded row |
| `f09affb` | Add missing groupable fields for publiek (regio, staffel, onderdeel) |
| `99d58bd` | Fix: cast group_value to str for integer columns (inkoop staffel) |
| `77d5250` | Fix: cast group_value to text in SQL for integer columns (inkoop staffel) |

### 10. Footer Rework — Remove Dead Links, Visual Affordance
- Audited footer: 7 links in non-auth state, only 3 worked (rest returned 404)
- Invoked `/frontend-design` with industry-standard footer rules
- Three visual tiers: active links (`white/70` + hover underline), inactive items (`white/35`, cursor-default, `<span>`), section headers (`white/40`, uppercase)
- Removed dead links: Over ons, Veelgestelde vragen, Abonnementen, Contact opnemen, Feedback geven
- Kept as inactive spans: Vacatures, Word partner (signal "more to come")
- Removed Inloggen from footer (industry standard: login in header only)
- Activated "Over Rijksuitgaven" as link after /over page created

### 11. About Page (`/over`) — Content & Visual Redesign
- Reviewed WordPress /over/ content with 5-expert team (Content Strategist, Information Architect, Brand Copywriter, UX Designer, Adversarial Strategist)
- 7 verification questions to founder, all answered
- 6 sections: Hero, Onze missie, Voor wie (5 audiences), Onafhankelijk en objectief, Onze bronnen, Neem contact op
- Key facts: €1.700 mld, 463.000+ ontvangers, 9 begrotingsjaren
- Sources: Rijksoverheid, provincies, gemeenten, publieke uitvoeringsorganisaties en kennisinstellingen
- Visual redesign with `/frontend-design`: homepage-matching section layout, ScrollReveal animations, stat strip with pink left borders, audience cards in 3-col grid with pink top borders and icons, pink CTA band, alternating section backgrounds
- Removed inline footer (root layout provides Footer globally)
- Added ScrollReveal to homepage barrel export
- Added `/over` to middleware public paths

### 12. FAQ Page Evaluation — Deferred
- Assembled 4-expert team (Content Strategist, Information Architect, SaaS UX Specialist, Adversarial Strategist)
- Audited WordPress `/veelgestelde-vragen/` page: 12 questions across 4 categories
- Found 7 of 12 questions already covered by `/over` page and platform UI
- Found serious content accuracy problems: wrong sources, wrong privacy claims, outdated features
- 3 options presented: A (don't build), B (accordion on /over), C (standalone page)
- **Decision: Option A — skip for now, build later from real beta feedback**
- Removed "Veelgestelde vragen" from footer after briefly adding as inactive item

### 13. Support Page (`/support`) — Post-Login Help
- Assembled 4-expert team (SaaS Onboarding Specialist, Content Strategist, Information Architect, Adversarial Strategist)
- Evaluated WordPress support section: 13 articles across 4 categories (Zoeken, Modules, Ontwikkeling, Ondersteuning)
- **Key finding:** Zero articles can be migrated as-is — all reference old WordPress UI
- Built single-page support with 5 accordion sections (shadcn Accordion component):
  1. **Aan de slag** — search, consolidated view, row expansion, integraal
  2. **Modules** — all 7 modules with descriptions, year ranges, filter options
  3. **Exporteren** — CSV/XLS, 500-row limit explanation
  4. **Filteren** — cascading filters, combining, clearing
  5. **Uw account** — magic link login, subscription management, contact info
- Post-login only (not in middleware public paths)
- Text-only, no screenshots (prevents maintenance burden during fast iteration)
- Added "Ondersteuning" as active link in footer (logged-in state only)

### 14. Data Availability Audit — 20 Corrections on Production
- Assembled 4-expert team (Data Quality Engineer, Database Architect, Product Analyst, Adversarial Strategist)
- Ran verification queries against all 6 source tables to determine actual year ranges per entity
- **Key findings:**
  - Inkoop starts 2017 (not 2016)
  - Utrecht (gemeente) only 2023-2024 (was 2016-2024 — all zeros before 2023)
  - Friesland (provincie) only 2020-2023 (2024 pending)
  - Groningen (gemeente) and Haarlem end at 2023 (no 2024 yet)
  - Gelderland actually starts 2016 (was incorrectly 2019)
  - Many entities had overly broad defaults from migration 022
- **20 UPDATE statements** executed in single transaction on production
- Migration script saved: `scripts/sql/057-data-availability-corrections.sql`
- UX-035 requirement documented in search-requirements.md

### 15. Data Update Runbook — Per-Entity year_to Guidance
- Updated `scripts/data/DATA-UPDATE-RUNBOOK.md` Step 4
- Added warning: only update `year_to` for entities that actually received new data
- Added verification queries: run BEFORE updating to confirm which entities have data for new year
- Added correct vs wrong SQL examples (Friesland scenario)

### 16. UX-035 Dataoverzicht Page — Dynamic Data Availability Matrix
- Built `/dataoverzicht` page (post-login) with dynamic availability from `data_availability` table
- BFF route `GET /api/v1/dataoverzicht` — auth-gated, queries Supabase
- 6 sections: Instrumenten, Apparaat, Inkoop (simple year range text), Provincie, Gemeente, Publiek (checkmark matrices)
- Entity × year matrices: green ✓ for years within year_from–year_to range
- Auto-reflects when data_availability table is updated (new entities, new years)
- Matches visual style of /support and /voorwaarden pages
- Added "Dataoverzicht" link to footer (logged-in state only)
- UX-035 status updated to ✅ Implemented 2026-02-18

### 17. Dataoverzicht Page — Remove Source Links
- Removed all external source links per user request
- Removed PROVINCE_SOURCES dict, sourceLabel/sourceUrl config, Bron column from matrix tables
- Removed "afkomstig van data.overheid.nl" text from simple sections

### 18. Rename `/datasets` → `/dataoverzicht`
- Renamed route, page, BFF endpoint, footer link, and function name
- "Datasets" sounded generic — "Dataoverzicht" is cleaner Dutch

### 19. Entity List Sync — Fix Content Drift
- **Problem:** Support page and module hub listed 9 gemeenten, but `data_availability` has 12 (missing Arnhem, Barendrecht, De Ronde Venen)
- 4-expert team analysis (Content Architecture Lead, Frontend Systems Engineer, Information Architect, Adversarial Strategist)
- **Hybrid solution:**
  - Support page: replaced hardcoded entity names with counts + link to `/dataoverzicht` (zero maintenance)
  - Module hub: fixed hardcoded list (added 3 missing gemeenten)
  - Runbook: added Step 8 "Update Module Hub Entity Lists" for when new entities are added

### 20. Data Table UX — Ghost Column + Sticky Totaal
- **Problem 1:** When years expanded, ghost column "< 2016-20" with empty cells appeared (from `collapse-years-header` column with `cell: () => null`)
- **Problem 2:** No visual indication that table is horizontally scrollable when years expanded
- 4-expert team (Data Table UX Lead, Interaction Designer, Frontend Performance Engineer, Adversarial Strategist)
- **5 changes implemented:**
  1. Deleted ghost `collapse-years-header` column definition in data-table.tsx
  2. Added collapse chevron `<` on first year (2016) header when expanded (separate button + SortableHeader to avoid nested buttons)
  3. Totaal column sticky right-0 with left-facing shadow (header: `rgba(0,0,0,0.3)`, body: `rgba(0,0,0,0.1)`)
  4. Same treatment for tfoot Totaal cell (removed ghost cell, added sticky right-0)
  5. Same ghost column fix in expanded-row.tsx: removed collapse button `<td>`, moved chevron to first year header, removed empty ghost `<td>` in data rows, fixed colSpan calculations for loading/error/empty states

### 21. Scroll Indicator — Horizontal Scroll Visibility (4 iterations)
- **Problem:** Users couldn't tell years 2022-2024 were hidden between 2021 and sticky Totaal column
- Invoked `/frontend-design` with CSS scroll architecture expert team
- **Iteration 1:** `box-shadow` on sticky Totaal cells → **FAILED** (CSS spec: box-shadow on sticky elements inside `overflow-x: auto` is CLIPPED by overflow boundary — invisible to user)
- **Iteration 2:** White gradient overlay `rgba(255,255,255,0.85)` outside overflow container → ugly blue-white wash on navy header
- **Iteration 3:** Body-only white gradient (measuring thead/tfoot heights) → created visible "blank gap" on white body (lighter strip looks like missing content)
- **Iteration 4:** Dark navy-tinted gradient `rgba(14, 50, 97, 0.22)` → creates shadow boundary that works on all backgrounds
- **Final implementation:**
  - Wrapped scroll container in `div.relative`
  - Absolutely-positioned overlay div outside overflow container (`right: 110px`, `width: 40px`)
  - `linear-gradient(to left, rgba(14, 50, 97, 0.22), transparent)`
  - Scroll state tracking: `ResizeObserver` + scroll event listener → `canScrollRight` boolean
  - Opacity transition: `opacity-100` when scrollable, `opacity-0` when not
  - `border-l` on Totaal cells (white/20 on header, var(--border) on body)
- **Key CSS learning:** `box-shadow` on sticky elements inside `overflow: auto` containers is always clipped — must use overlays OUTSIDE the container

### 22. "+N meer" Context-Aware Grouping
- **Feature:** Clicking "+N meer" under an extra column (e.g., Artikel, Regeling) now pre-selects that column as the grouping in the expanded row
- Regular chevron/name expand still defaults to first grouping option
- Implementation: `expandGroupingRef` in data-table.tsx stores colKey per primary_value, passed through `renderExpandedRow` to ExpandedRow's `initialGrouping` prop
- Validated against GROUPABLE_FIELDS per module — invalid colKeys fall through to default
- Added missing groupable fields for publiek: `regio`, `staffel`, `onderdeel`

### 23. Inkoop Staffel Integer Bug Fix
- **Problem:** Expanding rows with `group_by=staffel` in inkoop returned 500 error
- **Root cause:** `staffel` is INTEGER in PostgreSQL. Pydantic v2 `DetailRow(group_value: Optional[str])` rejects `int→str` coercion (confirmed with local test)
- **Fix:** Belt-and-suspenders approach:
  1. SQL level: `{group_field}::text AS group_value` — PostgreSQL returns text regardless of column type
  2. Python level: `str(raw_gv) if raw_gv is not None else None` — extra safety
- Verified `text::text` is a no-op (string columns unaffected)
- Full end-to-end test: inkoop/staffel, inkoop/categorie, instrumenten/regeling — all pass
- **Deploy learning:** Railway "Redeploy" restarts same build. New code requires a NEW deployment (push new commit or click "Deploy" on specific commit)

---

## Next Steps

- [ ] WordPress user migration (~50 users)
- [ ] Rate limiting (Cloudflare free tier)
- [ ] SEO optimization (OG image, twitter cards, per-page metadata)
- [ ] Homepage mobile responsiveness
- [ ] DNS switch + rollback plan
- [ ] Email campaign setup (Resend Audience)
- [ ] CRM Phase 3 (drop redundant subscription columns)
- [ ] Final QA pass

---

**Session Status:** In Progress
