# Daily Log — 2026-02-14

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V1.0 Development
**Sprint:** Week 7 — Pre-Launch Tasks
**Session Duration:** [to be filled]

---

## Summary

Session 1: De Geldstroom design sprint — 6-person expert team brainstorm (11 rounds) to design dynamic Sankey hero visualization for homepage. Validated all 6 module stories against real production data. Key finding: COA spending 6.6× increase (€0.56→€3.72 mld, 2018-2024). Decision: 6 selectable stories with year slider, build-time static data (no public API). Full design document written.

Session 2: De Geldstroom implementation — build-time data script + component refactor. Generated real data for all 6 stories (2018-2024), replaced static prototype at `/h1` with fully interactive dynamic visualization. Year selector, story tabs, proportional flow thickness, weighted particle animation, accessibility support.

Session 3: Ontdekking van de Week brainstorm + implementation — 6-person expert team (Data Journalist, Creative Strategist, Data Analyst, Adversarial Editor, UX Writer, Info Architect). Fact-checked 3 prototype claims (ALL wrong/fabricated). Mined production Supabase for verified patterns across all 6 modules. 23 verified discoveries implemented with social sharing (LinkedIn, X, Bluesky). UX-031.

---

## Work Completed

### De Geldstroom Design Sprint (Session 1)
- 11-round team brainstorm: Lead UI/UX + Creative Strategist + Data Specialist + Info Architect + Motion Designer + Adversarial Strategist
- Validated data for all 6 stories by querying production Supabase
- Key decisions: 6 selectable stories, Integraal as default, year pills (not slider), build-time JSON, per-story visual scale, node order fixed by 2024 ranking
- Identified and documented 9 risks with mitigations
- Full design document: `docs/plans/2026-02-14-de-geldstroom-design.md`

### Real Data Findings
- **Instrumenten:** SVB receives €36.4 mld from Sociale Zaken (single largest flow)
- **Publiek/COA:** 6.6× spending increase 2018→2024, top recipients are security/healthcare/hotel firms
- **Integraal:** Politie in 4 modules (€34.3 mld), Amsterdam in 5 modules (€11.3 mld)
- **Inkoop:** Ministry name inconsistencies identified (I&W vs "I & W") — normalization implemented
- **Gemeente:** Amsterdam dominates (€5.9 mld, 2.4× Den Haag)
- **Provincie:** Noord-Brabant leads (€4.4 mld), 10 of 12 provinces queried

### Ontdekking van de Week (Session 3)
- **UX-031** requirement entry written in `02-requirements/search-requirements.md`
- **Fact-checked 3 prototype claims** — all wrong:
  - Politieacademie: claimed €342M, actual €131M
  - Wolvenbeheer: completely fabricated, no wolf management in data
  - Rotterdam > 47 gemeenten: Rotterdam not in gemeente top 10, only 12 gemeenten in module
- **Mined production Supabase** — 20+ SQL queries across all 6 modules
- **23 verified discoveries** organized in 6 categories:
  - Energy & Infrastructure (4): TenneT €13.1B/2024, €17B total, ProRail €8.7B, NS Reizigers €2.2B
  - Asylum & Migration (5): COA 6.7× growth, €10.6B total, €3.7B/2024, RMA Healthcare €1.1B, Trigion €730M
  - Government IT & Procurement (4): ICT €6.5B, Heijmans €2.1B #1 supplier, Pels Rijcken €637M, €91.5B total
  - Regional (2): Noord-Brabant > 4 provinces combined, Amsterdam 2× Den Haag
  - Culture & Education (3): Koninklijke Bibliotheek €813M (2.4× Rijksmuseum), €50B universities, Rijksmuseum €336M
  - System-wide (5): SVB €114B, Politie 4 modules €34B, 179 billion-euro recipients, top 10 = 26%, 463K total
- **Social sharing**: LinkedIn (existing) + X + Bluesky added
- **Shuffled rotation**: Fisher-Yates shuffle on mount, progress bar replaces dots
- **Architecture**: Option A (hardcoded JSON) — editorially curated, no build-time script needed
- **Thomas's comparison rules enforced**: same module, same years, no cross-module comparisons

### De Geldstroom Implementation (Session 2)
- **UX-030** requirement entry written in `02-requirements/search-requirements.md`
- **Build-time data script** (`app/scripts/generate-geldstroom-data.mjs`):
  - Connects to Supabase via `DATABASE_URL`
  - 6 story generators with single-query-per-story pattern
  - Ministry name normalization for inkoop (I&W, J&V variants)
  - Year filtering (2018-2024) to exclude dirty data (years 0, 1900, 2025)
  - Checksum validation, fallback to existing JSON if DB unreachable
  - Generates `app/src/data/geldstroom.json` (60.3 KB)
- **Component refactor** (`app/src/app/h1/page.tsx`):
  - Replaced hardcoded data with JSON import
  - 6 story tabs (Alle bronnen, Publieke organisaties, Rijksbegroting, Inkoopdata, Gemeenten, Provincies)
  - Year selector pills (2018-2024) with keyboard arrow navigation
  - Dynamic headline: "Waar ging €X miljard naartoe in [year]?"
  - Flow thickness proportional to actual amounts (per-story scale normalization)
  - Particle density weighted by flow amount
  - `prefers-reduced-motion` accessibility: disables particles
  - ARIA labels on nodes and flows, keyboard-navigable
  - Tooltip on flow hover: "Source → Target: €X mld"
  - Node click CTA: "Bekijk bestedingen →" / "Bekijk ontvangers →"
- **Package.json** updated: `pg` dependency + `prebuild` script (runs before `next build`)
- **Data notes:** COA/inkoop amounts are average staffelbedragen (midpoint estimates) — noted for future attribution text

---

## Files Created

| File | Description |
|------|-------------|
| `docs/plans/2026-02-14-de-geldstroom-design.md` | Full design document — 6 stories, real data, decisions, architecture, risks (~500 lines) |
| `app/scripts/generate-geldstroom-data.mjs` | Build-time data script — queries Supabase, generates JSON |
| `app/src/data/geldstroom.json` | Generated data (60.3 KB) — 6 stories × 7 years, real government flows |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/h1/page.tsx` | Complete refactor: static → dynamic data, added year selector + story tabs |
| `app/src/app/h3/page.tsx` | Rewritten: 3 fabricated discoveries → 23 verified, added X + Bluesky share, shuffled rotation |
| `app/package.json` | Added `pg` dependency, `prebuild` script, updated `build` command |
| `02-requirements/search-requirements.md` | Added UX-030 (De Geldstroom) + UX-031 (Ontdekking van de Week) |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Integer overflow on instrumenten SUM | Cast bedrag to bigint: `SUM(bedrag::bigint * 1000)` |
| Publiek uses `jaar` not `begrotingsjaar` | Different column name per module — build script handles per-module config |
| Inkoop amount column is `totaal_avg` not `bedrag` | Staffelbedragen use midpoint averages |
| Dirty years (0, 1900, 2025, 2026) in data | Added WHERE year BETWEEN 2018 AND 2024 to all queries |
| Ministry name variants in inkoop | Normalization CTE: I & W/I & M → I&W, J & V → J&V |
| 3 fabricated prototype discoveries | Replaced with 23 fact-checked discoveries from production SQL |
| 23 dot indicators too many | Replaced with progress bar + "X / 23" counter |

---

## Next Steps

- Homepage integration: embed De Geldstroom in `public-homepage.tsx` hero section
- Data attribution text for staffelbedragen (COA/inkoop disclaimer)
- Search enhancements (exact phrase, wildcard, multi-word AND)
- User migration (~50 WordPress users)
- V1 Feature Close Review

---

**Session Status:** In Progress
