# Daily Log — 2026-02-20

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V1.0 Development
**Sprint:** Week 8 — Marketing Pages & Final Polish (Day 4)
**Session Duration:** 1 session

---

## Summary

UX-037 Concept E-mails — added draft functionality to `/team/mail`. Admins can now save email compositions as concepts, edit them later, and convert them to sent campaigns on send. Campaigns tab split into Concepten/Verzonden sections with segment badges on all items.

---

## Work Completed

### Session 1: UX-037 Concept E-mails (1 commit)
1. **SQL migration 063** — `status TEXT NOT NULL DEFAULT 'sent'` on campaigns table, `sent_at` made nullable (NULL for drafts), `updated_at TIMESTAMPTZ` for edit tracking, index on `(status, updated_at DESC)`
2. **Drafts API** — `POST /api/v1/team/mail/drafts` (save new draft), `PUT /api/v1/team/mail/drafts/[id]` (update existing, only drafts), `DELETE /api/v1/team/mail/drafts/[id]` (delete draft only). All admin-only with CSRF checks.
3. **Send route updated** — accepts optional `draftId` param. If provided, converts draft to sent campaign (update status+sent_at) instead of creating new row.
4. **Campaigns list updated** — returns `status` and `updated_at` fields, orders drafts before sent.
5. **Frontend rewrite** — "Opslaan als concept" button (changes to "Concept bijwerken" when editing). Draft indicator bar with "Nieuw bericht starten" link. Compose tab label changes to "Concept bewerken". Campaigns tab split into Concepten (amber badge, "Bewerken" button, "Laatst bewerkt" timestamp) and Verzonden (existing behavior with "Sjabloon" button). Segment badges on all items. Save success flash (green checkmark, 3s). Sending a draft clears editingDraftId. Deleting a draft in campaigns tab clears editor if that draft was loaded.
6. **Requirement entry** — UX-037 added to search-requirements.md

---

## Files Created

| File | Description |
|------|-------------|
| `app/src/app/api/v1/team/mail/drafts/route.ts` | Save new email draft |
| `app/src/app/api/v1/team/mail/drafts/[id]/route.ts` | Update/delete existing draft |
| `scripts/sql/063-campaign-drafts.sql` | Draft support: status, nullable sent_at, updated_at |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/team/mail/page.tsx` | Full rewrite: draft save/edit/delete, Concepten/Verzonden split, segment badges, draft indicator bar |
| `app/src/app/api/v1/team/mail/send/route.ts` | Optional `draftId` param, draft-to-sent conversion |
| `app/src/app/api/v1/team/mail/campaigns/route.ts` | Returns status + updated_at, orders drafts first |
| `02-requirements/search-requirements.md` | UX-037 requirement entry added |

---

## SQL Migrations

| Migration | Description | Executed |
|-----------|-------------|----------|
| `063-campaign-drafts.sql` | status column, nullable sent_at, updated_at on campaigns | Yes |

---

## Next Steps

- Continue V1.0 pre-launch prep
- Test draft save/edit/delete flow on production

---

**Commits:** 1 (`0dd5e5f`)
**Session Status:** Complete
