# Daily Log - 2026-01-31

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V1.0 Development
**Sprint:** Mini Sprint - Supabase Fixes + UI/UX Polish (before Week 6)
**Session Duration:** [to be filled]

---

## Summary

[To be completed at /closeday]

---

## Work Completed

### 1. Supabase RLS Fixes (Linter Errors)

Fixed 2 RLS issues flagged by Supabase linter:

| Table | Issue | Solution |
|-------|-------|----------|
| `spatial_ref_sys` | PostGIS system table without RLS | Revoked API access + **accepted as known limitation** (extension-owned, cannot enable RLS) |
| `data_freshness` | Missing RLS | Enabled RLS + public read policy |

**Script:** `scripts/sql/012-enable-rls-missing-tables.sql`

### 2. Security Hardening (Linter Warnings)

| Category | Count | Action |
|----------|-------|--------|
| Function search_path | 7 | Fixed - added `SET search_path = public` |
| Materialized views in API | 7 | Fixed - revoked anon/authenticated access |
| Extensions in public | 3 | Accepted - migration risk too high |

**Script:** `scripts/sql/013-security-hardening.sql`

### 3. UI: Table Toolbar Redesign

Restructured table controls per founder request:

| Change | Before | After |
|--------|--------|-------|
| Results dropdown | Footer, [25,50,100] | **Top left**, [25,100,150,250,500] + "resultaten weergeven" |
| Kolommen button | Footer | **Top right** |
| CSV Export | Footer + "max 500" text | **Top right**, no limit text |
| Footer | Cluttered | Clean: amounts note + pagination only |

**File:** `app/src/components/data-table/data-table.tsx`

### 4. Feature: XLS Export

Added Excel export alongside CSV:
- Same logic as CSV (visible data, max 500 rows)
- Uses `xlsx` (SheetJS) library
- Separate buttons: [CSV] [XLS]
- Column widths auto-set for readability

**Package added:** `xlsx`
**File:** `app/src/components/data-table/data-table.tsx`

---

## Files Created

| File | Description |
|------|-------------|
| `scripts/sql/012-enable-rls-missing-tables.sql` | RLS fixes for spatial_ref_sys and data_freshness |
| `scripts/sql/013-security-hardening.sql` | Function search_path + materialized view access revoke |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/components/data-table/data-table.tsx` | Toolbar above table, moved controls, XLS export |
| `docs/LOCAL-SETUP.md` | Added xlsx package |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| RLS disabled on data_freshness | Enabled RLS + public read policy |
| RLS disabled on spatial_ref_sys | Revoked API access (extension-owned, accepted) |
| Function search_path mutable (7 functions) | Added SET search_path = public |
| Materialized views exposed via API | Revoked anon/authenticated access |
| Extensions in public schema | Accepted - migration risk too high |

---

## Next Steps

[To be completed at /closeday]

---

**Session Status:** In Progress
