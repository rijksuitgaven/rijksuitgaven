# Daily Log — 2026-02-24

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V2.0 Development
**Sprint:** Week 8+ — Pre-Launch Polish & Beta Feedback
**Session Duration:** [to be filled at /closeday]

---

## Summary

Email deliverability diagnosis + invite email UX overhaul. Analyzed spam headers (Soverin 9-star spam score despite perfect DKIM/SPF/DMARC — likely shared SES IP reputation). Extended magic link expiry from 1h to 24h (Supabase OTP + code copy). Fixed expired link error message (removed "activatielink" and "via uw beheerder"). Then iterative rewrite of the invite email: stripped from 9 text elements to 5, corrected session explanation (not "altijd via e-maillink" but "ingelogd zolang u minstens 1x per 7 dagen bezoekt"), unified font sizes to 3-level hierarchy (22px heading, 16px body, 13px footer), moved expiry+renewal above button, new subject line.

---

## Work Completed

### 1. Email Spam Header Analysis
- Analyzed full email headers from Soverin mailbox
- Diagnosis: DKIM/SPF/DMARC all pass, but `X-Soverin-Spam-Level: *********` (9 stars)
- Root cause: shared Amazon SES IP reputation + bulk mail fingerprint + new sending domain
- Recommendation: dedicated Resend IP (~$20/month)

### 2. Magic Link Expiry: 1h → 24h
- Supabase Dashboard: OTP Expiry changed from 3600 to 86400 seconds
- Updated copy "een uur geldig" → "24 uur geldig" in 4 files (6 instances)
- Commit `d5c7908`, deployed to both environments

### 3. Expired Link Error Message Fix
- Changed "De activatielink is verlopen of al gebruikt. Vraag een nieuwe aan via uw beheerder."
- To: "Uw inloglink is verlopen of al gebruikt. Vul uw e-mailadres in voor een nieuwe link."
- Removes wrong mental model ("activatielink") and wrong instruction ("via beheerder")
- Commit `415b1ea`, deployed to both environments

### 4. Invite Email: "Geen wachtwoord nodig" Section (added then removed)
- Initially added explanation section — made email too long
- Removed in subsequent iteration in favor of inline explanation

### 5. Invite Email: Full Rewrite (5 iterations)
- Stripped from 9 text elements to 5 clean lines
- New subject: "Uw inloglink voor Rijksuitgaven 2.0" (was "Rijksuitgaven 2.0 Beta — uw toegang")
- Corrected session explanation: "Na inloggen blijft u ingelogd zolang u het platform minstens één keer per 7 dagen bezoekt"
- Unified font hierarchy: 22px heading, 16px all body text (incl. expiry), 13px footer only
- Expiry + renewal combined into one line above button
- Commits: `12ba050`, `4ba85ed`, `ff07826`, `2a4e795` — all deployed to both environments

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" → "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" → "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" → "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" → "24 uur" |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP → 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |

### 6. Lab Section: /team/lab (admin-only prototypes)
- Moved h1-h5 prototype pages from public `/h1`-`/h5` routes to `/team/lab/h1`-`/h5`
- Created lab index page with card grid, `LAB_PAGES` registry, description
- Created dynamic `[slug]` page with sticky back-bar and admin role check
- Added "Lab" tab to TeamNav (8th tab)
- Added Lab section card to `/team` dashboard with description + page count
- Removed `h[1-9]` from middleware matcher (no longer public)
- Removed h3 (Discoveries Homepage) per user request
- Commits: `b2015c6`, `d1ea5bb` — deployed to both environments

### 7. Cron-Sequences Failure Diagnosis
- Cron service showing "Last run failed 3 hours ago"
- Investigated: code is correct, RESEND_API_KEY and SUPABASE_SERVICE_ROLE_KEY are on frontend service
- Root cause: CRON_SECRET was rotated (Feb 22) but hardcoded Bearer token in Railway cron start command was not updated
- User fixed the start command — cron active again

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |
| `app/src/app/team/lab/page.tsx` | Lab index page with card grid + LAB_PAGES registry |
| `app/src/app/team/lab/[slug]/page.tsx` | Dynamic lab page with sticky back-bar |
| `app/src/components/lab/h1.tsx` | Moved from app/h1/page.tsx |
| `app/src/components/lab/h2.tsx` | Moved from app/h2/page.tsx |
| `app/src/components/lab/h4.tsx` | Moved from app/h4/page.tsx |
| `app/src/components/lab/h5.tsx` | Moved from app/h5/page.tsx |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" → "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" → "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" → "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" → "24 uur" |
| `app/src/components/team-nav/team-nav.tsx` | Added "Lab" tab (8th) |
| `app/src/app/team/page.tsx` | Added Lab section card with description + page count |
| `app/src/middleware.ts` | Removed h[1-9] from matcher exclusion |

## Files Deleted

| File | Reason |
|------|--------|
| `app/src/app/h1/page.tsx` | Moved to components/lab/h1.tsx |
| `app/src/app/h2/page.tsx` | Moved to components/lab/h2.tsx |
| `app/src/app/h3/page.tsx` | Moved to components/lab/h3.tsx (then deleted from lab) |
| `app/src/app/h4/page.tsx` | Moved to components/lab/h4.tsx |
| `app/src/app/h5/page.tsx` | Moved to components/lab/h5.tsx |
| `app/src/components/lab/h3.tsx` | Removed per user request |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP → 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |
| Prototype pages publicly accessible | Moved to /team/lab, admin-only |
| Cron-sequences failing | Bearer token not updated after CRON_SECRET rotation |

### 8. Roadmap Feature: /team/roadmap (admin-only)
- Brainstormed design: markdown-as-source-of-truth, 4 release tracks, timeline + filterable list
- Created API route that parses VERSIONING.md + backlog.md into structured JSON
- Created roadmap page with track tabs (V/A/M/D), version progress cards, filterable feature table
- Added "Roadmap" tab to TeamNav (9th tab)
- Added Roadmap section card to /team dashboard
- Commits: `7c8a589` — deployed to both environments

### 9. Railway File Access Fix (3 iterations)
- Roadmap API returned empty: Railway Root Directory = app/, repo root files not accessible
- Attempt 1: Copy files at build time to app/data/roadmap/ — files didn't persist to runtime
- Attempt 2: Embed markdown into generated TypeScript module at build time — prebuild couldn't find source files on Railway either
- Attempt 3 (final): Commit the generated `src/generated/roadmap-data.ts` to git. Prebuild regenerates locally, Railway uses committed version
- Commits: `76f7bf6`, `57185c4`, `5a4bbbc` — deployed to both environments

### 10. Roadmap Parser Audit + 6 Fixes
- Assembled senior analysis team to audit VERSIONING.md parsing accuracy
- Found 6 bugs, 3 duplicate entries, 12 missing backlog items
- **Fix 1:** Bullet features inherit version status (V2.0 features now show Done, not Planned)
- **Fix 2:** Status column detection via emoji scan (fixes M1.0 3-column table reading wrong column)
- **Fix 3:** Remove `startsWith('Light ')`/`startsWith('Platform ')` exclusions (recovers V3.0 features)
- **Fix 4:** Bullet features parsed in ALL tracks, not just V-track
- **Fix 5:** Keyword-based backlog dedup (fixes Email/Rate Limiting/SEO duplicate entries)
- **Fix 6:** Default backlog items without Status line to "Backlogged" (recovers 12 invisible items)
- Also: timeline regex now matches text after comma (not just parentheses)
- Commit: `538380f` — deployed to both environments

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |
| `app/src/app/team/lab/page.tsx` | Lab index page with card grid + LAB_PAGES registry |
| `app/src/app/team/lab/[slug]/page.tsx` | Dynamic lab page with sticky back-bar |
| `app/src/components/lab/h1.tsx` | Moved from app/h1/page.tsx |
| `app/src/components/lab/h2.tsx` | Moved from app/h2/page.tsx |
| `app/src/components/lab/h4.tsx` | Moved from app/h4/page.tsx |
| `app/src/components/lab/h5.tsx` | Moved from app/h5/page.tsx |
| `app/src/app/api/v1/team/roadmap/route.ts` | Roadmap API — parses VERSIONING.md + backlog.md |
| `app/src/app/team/roadmap/page.tsx` | Roadmap page — track tabs, version cards, feature table |
| `app/scripts/copy-roadmap-data.mjs` | Prebuild: embeds markdown into generated TypeScript |
| `app/src/generated/roadmap-data.ts` | Auto-generated: VERSIONING.md + backlog.md as string constants |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" → "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" → "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" → "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" → "24 uur" |
| `app/src/components/team-nav/team-nav.tsx` | Added "Lab" tab (8th) + "Roadmap" tab (9th) |
| `app/src/app/team/page.tsx` | Added Lab section card + Roadmap section card |
| `app/src/middleware.ts` | Removed h[1-9] from matcher exclusion |
| `app/package.json` | Added `copy-roadmap-data.mjs` to prebuild step |
| `app/.gitignore` | Note about committed generated file |

## Files Deleted

| File | Reason |
|------|--------|
| `app/src/app/h1/page.tsx` | Moved to components/lab/h1.tsx |
| `app/src/app/h2/page.tsx` | Moved to components/lab/h2.tsx |
| `app/src/app/h3/page.tsx` | Moved to components/lab/h3.tsx (then deleted from lab) |
| `app/src/app/h4/page.tsx` | Moved to components/lab/h4.tsx |
| `app/src/app/h5/page.tsx` | Moved to components/lab/h5.tsx |
| `app/src/components/lab/h3.tsx` | Removed per user request |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP → 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |
| Prototype pages publicly accessible | Moved to /team/lab, admin-only |
| Cron-sequences failing | Bearer token not updated after CRON_SECRET rotation |
| Railway can't access repo root files | Commit generated roadmap-data.ts (build-time embed) |
| V2.0 features showing "Planned" | Bullet features now inherit version status |
| M1.0 status column misread | Emoji scan instead of always last cell |
| V3.0 features accidentally filtered | Removed startsWith exclusions |
| Backlog dedup failing (3 duplicates) | Keyword-based matching (first 3 significant words) |
| 12 backlog items invisible | Default to "Backlogged" when no Status line |

---

## Next Steps

- Send test invite to verify final email layout
- Verify email deliverability after DNS propagation (test Hotmail/Outlook/Gmail)
- Consider dedicated Resend IP for spam score improvement
- Onboarding email sequence implementation (5 emails)
- Homepage copy optimization (remaining value props)
- Roadmap: update VERSIONING.md feature statuses for accuracy (some items marked Planned are actually done)
- Roadmap: regenerate `roadmap-data.ts` after any VERSIONING.md or backlog.md edits

---

**Session Status:** In Progress
