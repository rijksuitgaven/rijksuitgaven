# Daily Log ‚Äî 2026-02-24

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V2.0 Development
**Sprint:** Week 8+ ‚Äî Pre-Launch Polish & Beta Feedback
**Session Duration:** ~10h (9 sessions)

---

## Summary

Email deliverability diagnosis + invite email UX overhaul. Analyzed spam headers (Soverin 9-star spam score despite perfect DKIM/SPF/DMARC ‚Äî likely shared SES IP reputation). Extended magic link expiry from 1h to 24h (Supabase OTP + code copy). Fixed expired link error message (removed "activatielink" and "via uw beheerder"). Then iterative rewrite of the invite email: stripped from 9 text elements to 5, corrected session explanation (not "altijd via e-maillink" but "ingelogd zolang u minstens 1x per 7 dagen bezoekt"), unified font sizes to 3-level hierarchy (22px heading, 16px body, 13px footer), moved expiry+renewal above button, new subject line.

---

## Work Completed

### 1. Email Spam Header Analysis
- Analyzed full email headers from Soverin mailbox
- Diagnosis: DKIM/SPF/DMARC all pass, but `X-Soverin-Spam-Level: *********` (9 stars)
- Root cause: shared Amazon SES IP reputation + bulk mail fingerprint + new sending domain
- Recommendation: dedicated Resend IP (~$20/month)

### 2. Magic Link Expiry: 1h ‚Üí 24h
- Supabase Dashboard: OTP Expiry changed from 3600 to 86400 seconds
- Updated copy "een uur geldig" ‚Üí "24 uur geldig" in 4 files (6 instances)
- Commit `d5c7908`, deployed to both environments

### 3. Expired Link Error Message Fix
- Changed "De activatielink is verlopen of al gebruikt. Vraag een nieuwe aan via uw beheerder."
- To: "Uw inloglink is verlopen of al gebruikt. Vul uw e-mailadres in voor een nieuwe link."
- Removes wrong mental model ("activatielink") and wrong instruction ("via beheerder")
- Commit `415b1ea`, deployed to both environments

### 4. Invite Email: "Geen wachtwoord nodig" Section (added then removed)
- Initially added explanation section ‚Äî made email too long
- Removed in subsequent iteration in favor of inline explanation

### 5. Invite Email: Full Rewrite (5 iterations)
- Stripped from 9 text elements to 5 clean lines
- New subject: "Uw inloglink voor Rijksuitgaven 2.0" (was "Rijksuitgaven 2.0 Beta ‚Äî uw toegang")
- Corrected session explanation: "Na inloggen blijft u ingelogd zolang u het platform minstens √©√©n keer per 7 dagen bezoekt"
- Unified font hierarchy: 22px heading, 16px all body text (incl. expiry), 13px footer only
- Expiry + renewal combined into one line above button
- Commits: `12ba050`, `4ba85ed`, `ff07826`, `2a4e795` ‚Äî all deployed to both environments

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" ‚Üí "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" ‚Üí "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" ‚Üí "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" ‚Üí "24 uur" |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP ‚Üí 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |

### 6. Lab Section: /team/lab (admin-only prototypes)
- Moved h1-h5 prototype pages from public `/h1`-`/h5` routes to `/team/lab/h1`-`/h5`
- Created lab index page with card grid, `LAB_PAGES` registry, description
- Created dynamic `[slug]` page with sticky back-bar and admin role check
- Added "Lab" tab to TeamNav (8th tab)
- Added Lab section card to `/team` dashboard with description + page count
- Removed `h[1-9]` from middleware matcher (no longer public)
- Removed h3 (Discoveries Homepage) per user request
- Commits: `b2015c6`, `d1ea5bb` ‚Äî deployed to both environments

### 7. Cron-Sequences Failure Diagnosis
- Cron service showing "Last run failed 3 hours ago"
- Investigated: code is correct, RESEND_API_KEY and SUPABASE_SERVICE_ROLE_KEY are on frontend service
- Root cause: CRON_SECRET was rotated (Feb 22) but hardcoded Bearer token in Railway cron start command was not updated
- User fixed the start command ‚Äî cron active again

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |
| `app/src/app/team/lab/page.tsx` | Lab index page with card grid + LAB_PAGES registry |
| `app/src/app/team/lab/[slug]/page.tsx` | Dynamic lab page with sticky back-bar |
| `app/src/components/lab/h1.tsx` | Moved from app/h1/page.tsx |
| `app/src/components/lab/h2.tsx` | Moved from app/h2/page.tsx |
| `app/src/components/lab/h4.tsx` | Moved from app/h4/page.tsx |
| `app/src/components/lab/h5.tsx` | Moved from app/h5/page.tsx |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" ‚Üí "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" ‚Üí "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" ‚Üí "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" ‚Üí "24 uur" |
| `app/src/components/team-nav/team-nav.tsx` | Added "Lab" tab (8th) |
| `app/src/app/team/page.tsx` | Added Lab section card with description + page count |
| `app/src/middleware.ts` | Removed h[1-9] from matcher exclusion |

## Files Deleted

| File | Reason |
|------|--------|
| `app/src/app/h1/page.tsx` | Moved to components/lab/h1.tsx |
| `app/src/app/h2/page.tsx` | Moved to components/lab/h2.tsx |
| `app/src/app/h3/page.tsx` | Moved to components/lab/h3.tsx (then deleted from lab) |
| `app/src/app/h4/page.tsx` | Moved to components/lab/h4.tsx |
| `app/src/app/h5/page.tsx` | Moved to components/lab/h5.tsx |
| `app/src/components/lab/h3.tsx` | Removed per user request |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP ‚Üí 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |
| Prototype pages publicly accessible | Moved to /team/lab, admin-only |
| Cron-sequences failing | Bearer token not updated after CRON_SECRET rotation |

### 8. Roadmap Feature: /team/roadmap (admin-only)
- Brainstormed design: markdown-as-source-of-truth, 4 release tracks, timeline + filterable list
- Created API route that parses VERSIONING.md + backlog.md into structured JSON
- Created roadmap page with track tabs (V/A/M/D), version progress cards, filterable feature table
- Added "Roadmap" tab to TeamNav (9th tab)
- Added Roadmap section card to /team dashboard
- Commits: `7c8a589` ‚Äî deployed to both environments

### 9. Railway File Access Fix (3 iterations)
- Roadmap API returned empty: Railway Root Directory = app/, repo root files not accessible
- Attempt 1: Copy files at build time to app/data/roadmap/ ‚Äî files didn't persist to runtime
- Attempt 2: Embed markdown into generated TypeScript module at build time ‚Äî prebuild couldn't find source files on Railway either
- Attempt 3 (final): Commit the generated `src/generated/roadmap-data.ts` to git. Prebuild regenerates locally, Railway uses committed version
- Commits: `76f7bf6`, `57185c4`, `5a4bbbc` ‚Äî deployed to both environments

### 10. Roadmap Parser Audit + 6 Fixes
- Assembled senior analysis team to audit VERSIONING.md parsing accuracy
- Found 6 bugs, 3 duplicate entries, 12 missing backlog items
- **Fix 1:** Bullet features inherit version status (V2.0 features now show Done, not Planned)
- **Fix 2:** Status column detection via emoji scan (fixes M1.0 3-column table reading wrong column)
- **Fix 3:** Remove `startsWith('Light ')`/`startsWith('Platform ')` exclusions (recovers V3.0 features)
- **Fix 4:** Bullet features parsed in ALL tracks, not just V-track
- **Fix 5:** Keyword-based backlog dedup (fixes Email/Rate Limiting/SEO duplicate entries)
- **Fix 6:** Default backlog items without Status line to "Backlogged" (recovers 12 invisible items)
- Also: timeline regex now matches text after comma (not just parentheses)
- Commit: `538380f` ‚Äî deployed to both environments

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |
| `app/src/app/team/lab/page.tsx` | Lab index page with card grid + LAB_PAGES registry |
| `app/src/app/team/lab/[slug]/page.tsx` | Dynamic lab page with sticky back-bar |
| `app/src/components/lab/h1.tsx` | Moved from app/h1/page.tsx |
| `app/src/components/lab/h2.tsx` | Moved from app/h2/page.tsx |
| `app/src/components/lab/h4.tsx` | Moved from app/h4/page.tsx |
| `app/src/components/lab/h5.tsx` | Moved from app/h5/page.tsx |
| `app/src/app/api/v1/team/roadmap/route.ts` | Roadmap API ‚Äî parses VERSIONING.md + backlog.md |
| `app/src/app/team/roadmap/page.tsx` | Roadmap page ‚Äî track tabs, version cards, feature table |
| `app/scripts/copy-roadmap-data.mjs` | Prebuild: embeds markdown into generated TypeScript |
| `app/src/generated/roadmap-data.ts` | Auto-generated: VERSIONING.md + backlog.md as string constants |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" ‚Üí "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" ‚Üí "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" ‚Üí "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" ‚Üí "24 uur" |
| `app/src/components/team-nav/team-nav.tsx` | Added "Lab" tab (8th) + "Roadmap" tab (9th) |
| `app/src/app/team/page.tsx` | Added Lab section card + Roadmap section card |
| `app/src/middleware.ts` | Removed h[1-9] from matcher exclusion |
| `app/package.json` | Added `copy-roadmap-data.mjs` to prebuild step |
| `app/.gitignore` | Note about committed generated file |

## Files Deleted

| File | Reason |
|------|--------|
| `app/src/app/h1/page.tsx` | Moved to components/lab/h1.tsx |
| `app/src/app/h2/page.tsx` | Moved to components/lab/h2.tsx |
| `app/src/app/h3/page.tsx` | Moved to components/lab/h3.tsx (then deleted from lab) |
| `app/src/app/h4/page.tsx` | Moved to components/lab/h4.tsx |
| `app/src/app/h5/page.tsx` | Moved to components/lab/h5.tsx |
| `app/src/components/lab/h3.tsx` | Removed per user request |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP ‚Üí 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |
| Prototype pages publicly accessible | Moved to /team/lab, admin-only |
| Cron-sequences failing | Bearer token not updated after CRON_SECRET rotation |
| Railway can't access repo root files | Commit generated roadmap-data.ts (build-time embed) |
| V2.0 features showing "Planned" | Bullet features now inherit version status |
| M1.0 status column misread | Emoji scan instead of always last cell |
| V3.0 features accidentally filtered | Removed startsWith exclusions |
| Backlog dedup failing (3 duplicates) | Keyword-based matching (first 3 significant words) |
| 12 backlog items invisible | Default to "Backlogged" when no Status line |

| Sort starts ascending (low to high) | `sortDescFirst: true` ‚Äî descending first, natural for financial data |

### 11. UX-040: Default Sort Direction ‚Äî High to Low (V2.0.2)
- Sort now starts descending on first click (highest values first)
- TanStack Table `sortDescFirst: true` on table options
- Added V2.0.2 entry to versiegeschiedenis page
- Written UX-040 requirement in search-requirements.md
- Commit: `6e14c0f` ‚Äî deployed to both environments

## Files Modified (additional ‚Äî Session 4)

| File | Changes |
|------|---------|
| `app/src/components/data-table/data-table.tsx` | Added `sortDescFirst: true` to table options |
| `app/src/app/versiegeschiedenis/page.tsx` | Added V2.0.2 changelog entry |
| `02-requirements/search-requirements.md` | Added UX-040 requirement entry |

---

### 12. UX-041: Full URL State Restoration (staging only, V2.1)
- Full view state encoded in URL: sort, page, columns, expanded rows, multiselect filters, grouping
- Shared/bookmarked links restore the exact same view
- Deployed to staging only ‚Äî will ship with V2.1 alongside UX-039 Vergelijk
- Added to staging-only feature registry in CLAUDE.md
- 4 bugs found by senior review team and fixed:
  - R-1 CRITICAL: Module-switch effect wiped URL state on mount (isFirstMount guard)
  - R-2 MEDIUM: Expand not synced to URL immediately (direct router.replace in callback)
  - R-3 LOW: searchParams dependency caused extra renders (removed from hydration effect)
  - U-1 LOW: betalingen missing from standardKeys exclusion
- Additional fixes:
  - Expand from URL on default view: search for target to guarantee row in results
  - Grouping dropdown (`?group=regeling`) synced to URL
  - Filter panel auto-opens when URL has dynamic filters
- VERSIONING.md: URL state moved from V2.2 to V2.1
- Requirement: UX-041 in search-requirements.md
- Commits (staging): `cff5dea`, `ab6b8ea`, `019d12c`, `c037c27`, `214b156`, `255bfe2`, `baff942`

### 13. UX-040 Sort Direction Fix (both environments)
- `sortDescFirst: true` was set but had no effect ‚Äî custom `SortableHeader` bypassed TanStack's cycling
- Bug: `isSorted === 'asc' ? 'desc' : 'asc'` ‚Äî when `isSorted` is `false`, falls to `'asc'`
- Fix: `isSorted === 'desc' ? 'asc' : 'desc'` ‚Äî unsorted‚Üídesc, desc‚Üíasc
- Deployed to both main and staging
- Commits: `05aebdf` (main), `1e67ccd` (staging)

## Files Modified (additional ‚Äî Session 5)

| File | Changes |
|------|---------|
| `app/src/components/module-page/module-page.tsx` | UX-041: URL state read/write for sort, page, cols, expand, group. isFirstMount guard, expandedPrimaryRef, auto-open filters. (staging only) |
| `app/src/components/data-table/data-table.tsx` | UX-041: initialExpandedPrimary/initialExpandGrouping props, auto-expand from URL, onExpandedChange with grouping. Sort fix: desc-first direction logic. (sort fix on both, rest staging only) |
| `app/src/components/data-table/expanded-row.tsx` | UX-041: onGroupingChange callback for URL sync. (staging only) |
| `02-requirements/search-requirements.md` | Added UX-041 requirement entry |
| `docs/VERSIONING.md` | URL state moved V2.2‚ÜíV2.1, renamed "Vergelijk & URL State" |
| `CLAUDE.md` | UX counter‚ÜíUX-042, staging-only registry updated with UX-041 markers, grep patterns updated |
| `logs/SESSION-CONTEXT.md` | UX-041 task logged, UX counter updated |

## Issues Resolved (additional ‚Äî Session 5)

| Issue | Solution |
|-------|----------|
| Sort first click goes ascending despite sortDescFirst | Custom SortableHeader bypassed TanStack cycling ‚Äî fixed direction logic |
| Module-switch effect resets URL state on direct navigation | isFirstMount ref guard skips reset on mount |
| Expand triggers page reload | Changed from state to ref for URL tracking |
| Expand from URL fails on default view (random sort) | Search for expand target + skip min_years filter |
| Grouping dropdown not in URL | Added `?group=` param with onGroupingChange callback |
| Filters not visible when URL has filter params | Auto-open filter panel when URL has dynamic filters |
| Multiselect filters only store first value in URL | Use repeated params via URLSearchParams.append() |

### 14. UX-042: In-App Release Banner (staging only)
- Brainstormed design: dismissible banner below header showing new enhancements since last visit
- Data source: hardcoded `RELEASE_NOTES` array in `lib/release-notes.ts` (separate from versiegeschiedenis)
- Seen tracking: localStorage `rn-last-seen` key (date of newest seen release)
- Display: 1 item = "Nieuw: [title]", 2-3 = titles joined with `¬∑`, 4+ = 2 titles + "en X meer"
- Styling: blue-50 background (distinct from amber subscription banner)
- Design doc: `docs/plans/2026-02-24-release-banner-design.md`
- CLAUDE.md rule: "When updating versiegeschiedenis, also add banner entry to release-notes.ts"
- Deployed to staging only (zero production builds ‚Äî new process)

### 15. Deployment Protocol Rewrite (CLAUDE.md)
- Root cause analysis: 3 contradictory instructions in CLAUDE.md caused repeated double-push to main
- Assembled senior review team (DevOps, Process Analyst, Risk Assessor, Adversarial Strategist)
- Findings: "Commit on main" vs "staging-only code on main is a contradiction", `main:staging` both recommended and forbidden
- Replaced with 3-scenario decision tree: A) Both environments, B) Staging only, C) Batch release
- Added 5 mandatory self-verification questions before any push
- **Key rule: for staging-only features, `git push origin main` must NEVER appear**
- Deployed to both environments

### 16. UX-039 Vergelijk/Pin Restoration (staging)
- Discovered UX-039 was missing from staging ‚Äî lost during revert-merge cascade (same pattern as UX-042)
- Original revert on main (`8739ed1`) propagated to staging via `git merge main`
- Manually re-applied all 19 code blocks from extraction analysis:
  - Imports: `useCallback`, `RowPinningState`, `Pin`, `PinOff`, Radix Tooltip
  - State: `rowPinning`, `pinnedCount`, `MAX_PINNED_ROWS`, clear-on-module-change
  - Functions: `getPinnedData`, selection-aware CSV/XLS export
  - UI: Pin/unpin buttons with Tooltip, "Wis selectie" toolbar button, ExportDropdown
  - Table body: pinned rows (blue highlight) + separator + `getCenterRows()`
  - Config: `enableRowPinning`, `keepPinnedRows`, `getRowId`
- Preserved UX-040 (sort) and UX-041 (URL state) during restore
- TypeScript clean build verified
- Deployed to staging only (committed directly on staging, zero production builds)

## Files Created (additional ‚Äî Session 6)

| File | Description |
|------|-------------|
| `app/src/lib/release-notes.ts` | Release notes data array (3 entries: V2.0, V2.0.1, V2.0.2) |
| `app/src/components/release-banner/release-banner.tsx` | Dismissible banner component |
| `app/src/components/release-banner/index.ts` | Barrel export |
| `docs/plans/2026-02-24-release-banner-design.md` | Release banner design document |

## Files Modified (additional ‚Äî Session 6)

| File | Changes |
|------|---------|
| `app/src/components/app-shell/app-shell.tsx` | Added `<ReleaseBanner />` after Header (staging only) |
| `app/src/components/data-table/data-table.tsx` | Restored full UX-039 Vergelijk/Pin: 325 insertions (staging only) |
| `CLAUDE.md` | Deployment protocol rewrite (decision tree, 5 verification Qs), release banner sync rule, staging-only registry updated |

## Issues Resolved (additional ‚Äî Session 6)

| Issue | Solution |
|-------|----------|
| Double push to main for staging-only features | Rewrote deployment protocol: decision tree, never push main for staging-only |
| UX-039 lost from staging (revert-merge cascade) | Manually re-applied 19 code blocks, verified all markers present |
| UX-042 banner lost from staging (same cascade) | Reverted the revert on staging to restore |
| Contradictory CLAUDE.md deployment instructions | 3-scenario decision tree + 5 self-verification questions |

### 17. UX-042 Release Banner: Design Refinement (5 iterations)
- v2: Brand colors (#E1EAF2 bg, #0E3261 text, #D4286B accents), inline dismiss, ‚ú¶ sparkle ‚Äî still messy
- v3: Expert research team (GitHub Primer + Stripe + Vercel patterns):
  - Removed sparkle entirely ‚Äî "Nieuw" semibold label IS the accent
  - Uniform 13px text, weight-only hierarchy (semibold/normal)
  - Pipe `|` separator between label and description
  - Lucide X icon in ghost button
- Fix 1: `justify-between` ‚Üí `gap-3` so dismiss follows text, not at container edge
- Fix 2: Dot `¬∑` separator before "Bekijk alles ‚Üí"
- Fix 3: Dismiss button ‚Üí visible bordered pill (`border`, `p-1`, `hover:bg-white/60`)
- Fix 4: "Bekijk alles ‚Üí" changed from pink to navy (same color+weight as "Nieuw")
- Copy: "Sorteer direct op de hoogste bedragen" (benefit-first, doel door doen)
- Commits (staging): `fcb11a0`, `eb8c00a`, `be924fb`, `cb42aa2`, `3d147de`, `b288ae4`

### 18. UX-042 Released to Production
- Cherry-picked 4 banner files from staging to main (no UX-039/UX-041 contamination)
- Pre-push grep verification: zero staging-only markers
- Commit (main): `c47ecee`
- Merged main back into staging to keep in sync
- Removed UX-042 from staging-only registry in CLAUDE.md
- Commit (main): `ee3945e`

### 19. Release Banner Flicker Fix (both environments)
- Banner briefly flashed on module navigation even when already dismissed
- Root cause: `useEffect` reads localStorage one frame after render ‚Äî component mounts with `unseen = []`, effect runs, brief flash
- Fix: `useState(getUnseenNotes)` ‚Äî synchronous localStorage read during initialization, no useEffect needed
- SSR-safe: `typeof window === 'undefined'` guard returns `[]` on server
- Commit (main): `f07467e` ‚Äî deployed to both environments

## Files Modified (additional ‚Äî Session 7)

| File | Changes |
|------|---------|
| `app/src/components/release-banner/release-banner.tsx` | 5 design iterations: brand colors, no icon, uniform text, bordered dismiss, navy link |
| `app/src/lib/release-notes.ts` | Copy: "Slimmer zoeken met meerdere woorden", "Sorteer direct op de hoogste bedragen" |
| `app/src/components/app-shell/app-shell.tsx` | ReleaseBanner now on production (cherry-picked from staging) |
| `CLAUDE.md` | Removed UX-042 from staging-only registry + grep patterns |

## Issues Resolved (additional ‚Äî Session 7)

| Issue | Solution |
|-------|----------|
| Banner fonts inconsistent | Uniform 13px, weight-only hierarchy (semibold/normal) |
| ‚ú¶ sparkle looks amateurish | Removed ‚Äî "Nieuw" semibold label is the accent |
| Dismiss √ó invisible and far away | Bordered pill button (`p-1 rounded border`) + `gap-3` follows text |
| "Bekijk alles" pink clashed with navy text | Changed to navy-dark, same weight as "Nieuw" |
| Missing separator before link | Added `¬∑` dot before "Bekijk alles ‚Üí" |
| Banner flickers on module navigation | Synchronous localStorage read in useState initializer (no useEffect) |

### 20. Project Tracking System Design (Expert Team)
- User identified roadmap page showing stale data (Email Campaign "In progress" despite being live)
- Root cause: VERSIONING.md last updated Feb 22, features shipped Feb 23-24 not reflected
- Deeper root cause: 7 files tracking overlapping status ‚Üí Consistency Tax guarantees divergence
- Assembled 4-person expert team: PM Lead, Information Architect, DevOps Engineer, Adversarial Strategist
- Researched Linear, GitHub Projects, Vercel, Notion tracking patterns
- Key findings: derive don't duplicate, one fact one home, design for entropy, nudge don't nag
- 4 recommendations produced (all implemented this session)

### 21. VERSIONING.md Staleness Fix
- V2.0 status: üî® ~95% ‚Üí ‚úÖ Live (all 17 features confirmed with user)
- V2.0 features: bullet list ‚Üí table format with per-feature ‚úÖ Live (matches A1.0 pattern)
- Added V2.0.1 (Feb 21) + V2.0.2 (Feb 24) patch history
- V2.1 renamed: "Vergelijk" ‚Üí "Vergelijk & URL State" (UX-041 moved from V2.2)
- V2.2 renamed: "Zoeken & URL State" ‚Üí "Zoeken"
- Applied standardized status vocabulary: üìã/üî®/üß™/‚úÖ/‚è≥
- Regenerated roadmap-data.ts
- Commit: `e082d10` ‚Äî deployed to both environments

### 22. /document + /closeday Skills Enhanced
- `/document` new Step 3: mandatory VERSIONING.md reconciliation
  - Programmatic diff of SESSION-CONTEXT vs VERSIONING.md
  - Present delta table to user, update with approval
  - Status vocabulary reference table (5 states)
- `/closeday`: added VERSIONING.md to audit checklist + roadmap reconciliation to sprint boundary checks
- Commit: `7f987cc` ‚Äî deployed to both environments

### 23. Backlog Cleanup + Source-of-Truth Pointers
- `backlog.md`: 1406 ‚Üí 350 lines (75% reduction)
  - Removed 16 completed items (history lives in VERSIONING.md)
  - Removed 3 stale items (Email campaigns, Full URL State, Backend Isolation)
  - Reorganized by version track (V/A/M) matching VERSIONING.md
  - Added header: "When implemented, REMOVE from here and update VERSIONING.md"
- `search-requirements.md`: added source-of-truth pointer
  - "This file = requirement spec. VERSIONING.md = release record."
- Regenerated roadmap-data.ts
- Commit: `32602aa` ‚Äî deployed to both environments

## Files Modified (additional ‚Äî Session 8)

| File | Changes |
|------|---------|
| `docs/VERSIONING.md` | V2.0 ‚úÖ Live, table format, patches, V2.1 renamed, status vocabulary |
| `02-requirements/backlog.md` | Complete rewrite: 1406‚Üí350 lines, future-only, organized by track |
| `02-requirements/search-requirements.md` | Added source-of-truth pointer to VERSIONING.md |
| `.claude/commands/document.md` | New Step 3: VERSIONING.md reconciliation, renumbered steps |
| `.claude/commands/closeday.md` | Added VERSIONING.md to audit + roadmap reconciliation |
| `app/src/generated/roadmap-data.ts` | Regenerated (2x: after VERSIONING.md fix + after backlog cleanup) |

## Issues Resolved (additional ‚Äî Session 8)

| Issue | Solution |
|-------|----------|
| VERSIONING.md stale (last updated Feb 22) | Full reconciliation: V2.0 Live, patches, V2.1 updated |
| Email Campaign shows "In progress" on roadmap | V2.0 features converted from bullets to table with per-feature status |
| 7 files tracking overlapping status | Defined clear roles: VERSIONING=release, backlog=future, requirements=spec |
| /document skill doesn't check VERSIONING.md | Added mandatory reconciliation step with delta table |
| backlog.md bloated with 16 completed items | Cleaned to future-only, organized by version track |
| UX-041 shown in V2.2 (actually V2.1 staging) | Moved to V2.1, status updated to üß™ On staging |

### 24. Roadmap: Multi-Select Filters + Semantic Version Sort
- Both filter dropdowns on `/team/roadmap` changed from single-select to multi-select
- Custom `MultiSelect<T>` component with checkbox dropdown, click-outside detection, "X geselecteerd" label
- Versions now sorted semantically: V2.0 before V10.0 (custom `semverSort()` parser, "Backlog" always last)
- Commit: `c363c90` ‚Äî deployed to both environments

### 25. Roadmap: Removed Superseded Items
- Removed "GitHub Projects visual dashboard" from VERSIONING.md V2.5 + backlog.md A1.2 (replaced by /team/roadmap)
- Removed "UX refinements from beta feedback" from VERSIONING.md V2.5 (already shipped as V2.0.1/V2.0.2)
- Regenerated `roadmap-data.ts`
- Commit: `bd0d54c` ‚Äî deployed to both environments

### 26. V5.0 Inzichten Dashboard ‚Äî 6 Visualization Prototypes (Lab h6)
- Assembled expert team (Viz Architect, Gov Finance Analyst, UX Designer, Adversarial Strategist)
- Read full database documentation (1313 lines) and materialized view SQL for data understanding
- Designed 6 interactive visualization concepts with verification questions
- Design doc: `docs/plans/2026-02-24-v5-inzichten-design.md`
- Installed dependencies: recharts, d3, @types/d3
- Registered h6 in lab index + dynamic loader
- Built 6 BFF routes under `/api/v1/inzichten/`:
  1. **Spending Pulse** (`/pulse`) ‚Äî KPI cards + stacked area chart by module
  2. **New Money** (`/new-entrants`) ‚Äî First-time recipient detector with year selector + threshold
  3. **The Movers** (`/movers`) ‚Äî Top-N ranked line chart with pin/compare (3 pinned)
  4. **Ministry DNA** (`/ministry-dna`) ‚Äî Sparkline matrix (5 metrics √ó 9 years per ministry)
  5. **Spending Landscape** (`/spending-tree`) ‚Äî D3 zoomable treemap (Ministry ‚Üí Regeling ‚Üí Instrument)
  6. **Dependency Radar** (`/cross-module`) ‚Äî D3 radial layout showing cross-module presence
- Fixed 5 TypeScript strict mode errors (Supabase dynamic column access + Recharts formatter signatures)
- Commit: `d3da6dd` ‚Äî deployed to both environments

## Files Created (additional ‚Äî Session 9)

| File | Description |
|------|-------------|
| `app/src/app/api/v1/inzichten/pulse/route.ts` | BFF: KPIs + module breakdown (RPC with fallback) |
| `app/src/app/api/v1/inzichten/new-entrants/route.ts` | BFF: first-time recipient detection |
| `app/src/app/api/v1/inzichten/movers/route.ts` | BFF: top-N ranked recipients over time |
| `app/src/app/api/v1/inzichten/ministry-dna/route.ts` | BFF: sparkline matrix (5 metrics per ministry) |
| `app/src/app/api/v1/inzichten/spending-tree/route.ts` | BFF: hierarchical treemap data |
| `app/src/app/api/v1/inzichten/cross-module/route.ts` | BFF: multi-source presence detection |
| `app/src/components/lab/h6/index.tsx` | Main dashboard: tab nav + Spending Pulse concept |
| `app/src/components/lab/h6/new-money.tsx` | Concept 2: new entrant bar chart + accordion |
| `app/src/components/lab/h6/movers.tsx` | Concept 3: ranked line chart with pin |
| `app/src/components/lab/h6/ministry-dna.tsx` | Concept 4: sparkline grid table |
| `app/src/components/lab/h6/spending-landscape.tsx` | Concept 5: D3 zoomable treemap |
| `app/src/components/lab/h6/dependency-radar.tsx` | Concept 6: D3 radial cross-module view |
| `docs/plans/2026-02-24-v5-inzichten-design.md` | Expert team design document |

## Files Modified (additional ‚Äî Session 9)

| File | Changes |
|------|---------|
| `app/package.json` | Added recharts, d3, @types/d3 |
| `app/package-lock.json` | Lock file updated (+909 lines) |
| `app/src/app/team/lab/page.tsx` | Registered h6 in LAB_PAGES array |
| `app/src/app/team/lab/[slug]/page.tsx` | Added h6 dynamic import |
| `app/src/app/team/roadmap/page.tsx` | Multi-select filters, semverSort(), MultiSelect component |
| `docs/VERSIONING.md` | Removed superseded items from V2.5 |
| `02-requirements/backlog.md` | Removed GitHub Projects section from A1.2 |
| `app/src/generated/roadmap-data.ts` | Regenerated |

## Issues Resolved (additional ‚Äî Session 9)

| Issue | Solution |
|-------|----------|
| Roadmap dropdowns single-select only | Custom MultiSelect component with checkbox dropdown |
| Versions sorted alphabetically (V10 before V2) | semverSort() parsing prefix + major.minor numbers |
| Supabase strict type parser fails on dynamic column access | Cast via `as unknown as Record<string, unknown>` |
| Recharts Tooltip formatter type mismatch | Removed explicit type annotations, use inferred types |

---

## Next Steps

- Onboarding email sequence implementation (5 emails designed, copy final)
- Homepage copy optimization (remaining value props)
- V2.1 batch release: UX-039 Vergelijk + UX-041 URL State (staging ‚Üí main)
- Email deliverability: dedicated Resend IP for spam improvement
- SEO optimization (M1.0 launch gate)
- Rate limiting via Cloudflare (M1.0 launch gate)
- V5.0 Inzichten: test lab prototypes with real data, iterate on designs

---

**Session Status:** Completed
