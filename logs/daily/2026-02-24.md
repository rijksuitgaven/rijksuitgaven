# Daily Log — 2026-02-24

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V2.0 Development
**Sprint:** Week 8+ — Pre-Launch Polish & Beta Feedback
**Session Duration:** [to be filled at /closeday]

---

## Summary

Email deliverability diagnosis + invite email UX overhaul. Analyzed spam headers (Soverin 9-star spam score despite perfect DKIM/SPF/DMARC — likely shared SES IP reputation). Extended magic link expiry from 1h to 24h (Supabase OTP + code copy). Fixed expired link error message (removed "activatielink" and "via uw beheerder"). Then iterative rewrite of the invite email: stripped from 9 text elements to 5, corrected session explanation (not "altijd via e-maillink" but "ingelogd zolang u minstens 1x per 7 dagen bezoekt"), unified font sizes to 3-level hierarchy (22px heading, 16px body, 13px footer), moved expiry+renewal above button, new subject line.

---

## Work Completed

### 1. Email Spam Header Analysis
- Analyzed full email headers from Soverin mailbox
- Diagnosis: DKIM/SPF/DMARC all pass, but `X-Soverin-Spam-Level: *********` (9 stars)
- Root cause: shared Amazon SES IP reputation + bulk mail fingerprint + new sending domain
- Recommendation: dedicated Resend IP (~$20/month)

### 2. Magic Link Expiry: 1h → 24h
- Supabase Dashboard: OTP Expiry changed from 3600 to 86400 seconds
- Updated copy "een uur geldig" → "24 uur geldig" in 4 files (6 instances)
- Commit `d5c7908`, deployed to both environments

### 3. Expired Link Error Message Fix
- Changed "De activatielink is verlopen of al gebruikt. Vraag een nieuwe aan via uw beheerder."
- To: "Uw inloglink is verlopen of al gebruikt. Vul uw e-mailadres in voor een nieuwe link."
- Removes wrong mental model ("activatielink") and wrong instruction ("via beheerder")
- Commit `415b1ea`, deployed to both environments

### 4. Invite Email: "Geen wachtwoord nodig" Section (added then removed)
- Initially added explanation section — made email too long
- Removed in subsequent iteration in favor of inline explanation

### 5. Invite Email: Full Rewrite (5 iterations)
- Stripped from 9 text elements to 5 clean lines
- New subject: "Uw inloglink voor Rijksuitgaven 2.0" (was "Rijksuitgaven 2.0 Beta — uw toegang")
- Corrected session explanation: "Na inloggen blijft u ingelogd zolang u het platform minstens één keer per 7 dagen bezoekt"
- Unified font hierarchy: 22px heading, 16px all body text (incl. expiry), 13px footer only
- Expiry + renewal combined into one line above button
- Commits: `12ba050`, `4ba85ed`, `ff07826`, `2a4e795` — all deployed to both environments

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" → "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" → "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" → "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" → "24 uur" |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP → 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |

### 6. Lab Section: /team/lab (admin-only prototypes)
- Moved h1-h5 prototype pages from public `/h1`-`/h5` routes to `/team/lab/h1`-`/h5`
- Created lab index page with card grid, `LAB_PAGES` registry, description
- Created dynamic `[slug]` page with sticky back-bar and admin role check
- Added "Lab" tab to TeamNav (8th tab)
- Added Lab section card to `/team` dashboard with description + page count
- Removed `h[1-9]` from middleware matcher (no longer public)
- Removed h3 (Discoveries Homepage) per user request
- Commits: `b2015c6`, `d1ea5bb` — deployed to both environments

### 7. Cron-Sequences Failure Diagnosis
- Cron service showing "Last run failed 3 hours ago"
- Investigated: code is correct, RESEND_API_KEY and SUPABASE_SERVICE_ROLE_KEY are on frontend service
- Root cause: CRON_SECRET was rotated (Feb 22) but hardcoded Bearer token in Railway cron start command was not updated
- User fixed the start command — cron active again

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |
| `app/src/app/team/lab/page.tsx` | Lab index page with card grid + LAB_PAGES registry |
| `app/src/app/team/lab/[slug]/page.tsx` | Dynamic lab page with sticky back-bar |
| `app/src/components/lab/h1.tsx` | Moved from app/h1/page.tsx |
| `app/src/components/lab/h2.tsx` | Moved from app/h2/page.tsx |
| `app/src/components/lab/h4.tsx` | Moved from app/h4/page.tsx |
| `app/src/components/lab/h5.tsx` | Moved from app/h5/page.tsx |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" → "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" → "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" → "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" → "24 uur" |
| `app/src/components/team-nav/team-nav.tsx` | Added "Lab" tab (8th) |
| `app/src/app/team/page.tsx` | Added Lab section card with description + page count |
| `app/src/middleware.ts` | Removed h[1-9] from matcher exclusion |

## Files Deleted

| File | Reason |
|------|--------|
| `app/src/app/h1/page.tsx` | Moved to components/lab/h1.tsx |
| `app/src/app/h2/page.tsx` | Moved to components/lab/h2.tsx |
| `app/src/app/h3/page.tsx` | Moved to components/lab/h3.tsx (then deleted from lab) |
| `app/src/app/h4/page.tsx` | Moved to components/lab/h4.tsx |
| `app/src/app/h5/page.tsx` | Moved to components/lab/h5.tsx |
| `app/src/components/lab/h3.tsx` | Removed per user request |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP → 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |
| Prototype pages publicly accessible | Moved to /team/lab, admin-only |
| Cron-sequences failing | Bearer token not updated after CRON_SECRET rotation |

### 8. Roadmap Feature: /team/roadmap (admin-only)
- Brainstormed design: markdown-as-source-of-truth, 4 release tracks, timeline + filterable list
- Created API route that parses VERSIONING.md + backlog.md into structured JSON
- Created roadmap page with track tabs (V/A/M/D), version progress cards, filterable feature table
- Added "Roadmap" tab to TeamNav (9th tab)
- Added Roadmap section card to /team dashboard
- Commits: `7c8a589` — deployed to both environments

### 9. Railway File Access Fix (3 iterations)
- Roadmap API returned empty: Railway Root Directory = app/, repo root files not accessible
- Attempt 1: Copy files at build time to app/data/roadmap/ — files didn't persist to runtime
- Attempt 2: Embed markdown into generated TypeScript module at build time — prebuild couldn't find source files on Railway either
- Attempt 3 (final): Commit the generated `src/generated/roadmap-data.ts` to git. Prebuild regenerates locally, Railway uses committed version
- Commits: `76f7bf6`, `57185c4`, `5a4bbbc` — deployed to both environments

### 10. Roadmap Parser Audit + 6 Fixes
- Assembled senior analysis team to audit VERSIONING.md parsing accuracy
- Found 6 bugs, 3 duplicate entries, 12 missing backlog items
- **Fix 1:** Bullet features inherit version status (V2.0 features now show Done, not Planned)
- **Fix 2:** Status column detection via emoji scan (fixes M1.0 3-column table reading wrong column)
- **Fix 3:** Remove `startsWith('Light ')`/`startsWith('Platform ')` exclusions (recovers V3.0 features)
- **Fix 4:** Bullet features parsed in ALL tracks, not just V-track
- **Fix 5:** Keyword-based backlog dedup (fixes Email/Rate Limiting/SEO duplicate entries)
- **Fix 6:** Default backlog items without Status line to "Backlogged" (recovers 12 invisible items)
- Also: timeline regex now matches text after comma (not just parentheses)
- Commit: `538380f` — deployed to both environments

---

## Files Created

| File | Description |
|------|-------------|
| `logs/daily/2026-02-24.md` | Today's daily log |
| `app/src/app/team/lab/page.tsx` | Lab index page with card grid + LAB_PAGES registry |
| `app/src/app/team/lab/[slug]/page.tsx` | Dynamic lab page with sticky back-bar |
| `app/src/components/lab/h1.tsx` | Moved from app/h1/page.tsx |
| `app/src/components/lab/h2.tsx` | Moved from app/h2/page.tsx |
| `app/src/components/lab/h4.tsx` | Moved from app/h4/page.tsx |
| `app/src/components/lab/h5.tsx` | Moved from app/h5/page.tsx |
| `app/src/app/api/v1/team/roadmap/route.ts` | Roadmap API — parses VERSIONING.md + backlog.md |
| `app/src/app/team/roadmap/page.tsx` | Roadmap page — track tabs, version cards, feature table |
| `app/scripts/copy-roadmap-data.mjs` | Prebuild: embeds markdown into generated TypeScript |
| `app/src/generated/roadmap-data.ts` | Auto-generated: VERSIONING.md + backlog.md as string constants |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/api/v1/auth/magic-link/route.ts` | "een uur" → "24 uur" in HTML + plain text |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | Full rewrite: new subject, simplified body, correct session info, unified fonts, restructured layout |
| `app/src/components/auth/login-form.tsx` | Expired link error: "activatielink via beheerder" → "inloglink, vul e-mailadres in" |
| `docs/email-templates/magic-link.html` | "een uur" → "24 uur" |
| `docs/email-templates/invite-user.html` | "een uur" → "24 uur" |
| `app/src/components/team-nav/team-nav.tsx` | Added "Lab" tab (8th) + "Roadmap" tab (9th) |
| `app/src/app/team/page.tsx` | Added Lab section card + Roadmap section card |
| `app/src/middleware.ts` | Removed h[1-9] from matcher exclusion |
| `app/package.json` | Added `copy-roadmap-data.mjs` to prebuild step |
| `app/.gitignore` | Note about committed generated file |

## Files Deleted

| File | Reason |
|------|--------|
| `app/src/app/h1/page.tsx` | Moved to components/lab/h1.tsx |
| `app/src/app/h2/page.tsx` | Moved to components/lab/h2.tsx |
| `app/src/app/h3/page.tsx` | Moved to components/lab/h3.tsx (then deleted from lab) |
| `app/src/app/h4/page.tsx` | Moved to components/lab/h4.tsx |
| `app/src/app/h5/page.tsx` | Moved to components/lab/h5.tsx |
| `app/src/components/lab/h3.tsx` | Removed per user request |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Magic link expires too fast (1h) | Supabase OTP → 86400s + copy update |
| Expired link says "activatielink" + "via beheerder" | Corrected to "inloglink" + self-service instructions |
| Invite email too long, confusing | Stripped to 5 lines, clear structure |
| "U logt altijd in via e-maillink" (factually wrong) | Corrected to accurate session behavior (7-day rolling) |
| Inconsistent font sizes in invite email (13/14/16/22px) | Unified to 3-level hierarchy (22/16/13px) |
| Expiry info hidden below button | Moved above button where users read it before clicking |
| Prototype pages publicly accessible | Moved to /team/lab, admin-only |
| Cron-sequences failing | Bearer token not updated after CRON_SECRET rotation |
| Railway can't access repo root files | Commit generated roadmap-data.ts (build-time embed) |
| V2.0 features showing "Planned" | Bullet features now inherit version status |
| M1.0 status column misread | Emoji scan instead of always last cell |
| V3.0 features accidentally filtered | Removed startsWith exclusions |
| Backlog dedup failing (3 duplicates) | Keyword-based matching (first 3 significant words) |
| 12 backlog items invisible | Default to "Backlogged" when no Status line |

| Sort starts ascending (low to high) | `sortDescFirst: true` — descending first, natural for financial data |

### 11. UX-040: Default Sort Direction — High to Low (V2.0.2)
- Sort now starts descending on first click (highest values first)
- TanStack Table `sortDescFirst: true` on table options
- Added V2.0.2 entry to versiegeschiedenis page
- Written UX-040 requirement in search-requirements.md
- Commit: `6e14c0f` — deployed to both environments

## Files Modified (additional — Session 4)

| File | Changes |
|------|---------|
| `app/src/components/data-table/data-table.tsx` | Added `sortDescFirst: true` to table options |
| `app/src/app/versiegeschiedenis/page.tsx` | Added V2.0.2 changelog entry |
| `02-requirements/search-requirements.md` | Added UX-040 requirement entry |

---

### 12. UX-041: Full URL State Restoration (staging only, V2.1)
- Full view state encoded in URL: sort, page, columns, expanded rows, multiselect filters, grouping
- Shared/bookmarked links restore the exact same view
- Deployed to staging only — will ship with V2.1 alongside UX-039 Vergelijk
- Added to staging-only feature registry in CLAUDE.md
- 4 bugs found by senior review team and fixed:
  - R-1 CRITICAL: Module-switch effect wiped URL state on mount (isFirstMount guard)
  - R-2 MEDIUM: Expand not synced to URL immediately (direct router.replace in callback)
  - R-3 LOW: searchParams dependency caused extra renders (removed from hydration effect)
  - U-1 LOW: betalingen missing from standardKeys exclusion
- Additional fixes:
  - Expand from URL on default view: search for target to guarantee row in results
  - Grouping dropdown (`?group=regeling`) synced to URL
  - Filter panel auto-opens when URL has dynamic filters
- VERSIONING.md: URL state moved from V2.2 to V2.1
- Requirement: UX-041 in search-requirements.md
- Commits (staging): `cff5dea`, `ab6b8ea`, `019d12c`, `c037c27`, `214b156`, `255bfe2`, `baff942`

### 13. UX-040 Sort Direction Fix (both environments)
- `sortDescFirst: true` was set but had no effect — custom `SortableHeader` bypassed TanStack's cycling
- Bug: `isSorted === 'asc' ? 'desc' : 'asc'` — when `isSorted` is `false`, falls to `'asc'`
- Fix: `isSorted === 'desc' ? 'asc' : 'desc'` — unsorted→desc, desc→asc
- Deployed to both main and staging
- Commits: `05aebdf` (main), `1e67ccd` (staging)

## Files Modified (additional — Session 5)

| File | Changes |
|------|---------|
| `app/src/components/module-page/module-page.tsx` | UX-041: URL state read/write for sort, page, cols, expand, group. isFirstMount guard, expandedPrimaryRef, auto-open filters. (staging only) |
| `app/src/components/data-table/data-table.tsx` | UX-041: initialExpandedPrimary/initialExpandGrouping props, auto-expand from URL, onExpandedChange with grouping. Sort fix: desc-first direction logic. (sort fix on both, rest staging only) |
| `app/src/components/data-table/expanded-row.tsx` | UX-041: onGroupingChange callback for URL sync. (staging only) |
| `02-requirements/search-requirements.md` | Added UX-041 requirement entry |
| `docs/VERSIONING.md` | URL state moved V2.2→V2.1, renamed "Vergelijk & URL State" |
| `CLAUDE.md` | UX counter→UX-042, staging-only registry updated with UX-041 markers, grep patterns updated |
| `logs/SESSION-CONTEXT.md` | UX-041 task logged, UX counter updated |

## Issues Resolved (additional — Session 5)

| Issue | Solution |
|-------|----------|
| Sort first click goes ascending despite sortDescFirst | Custom SortableHeader bypassed TanStack cycling — fixed direction logic |
| Module-switch effect resets URL state on direct navigation | isFirstMount ref guard skips reset on mount |
| Expand triggers page reload | Changed from state to ref for URL tracking |
| Expand from URL fails on default view (random sort) | Search for expand target + skip min_years filter |
| Grouping dropdown not in URL | Added `?group=` param with onGroupingChange callback |
| Filters not visible when URL has filter params | Auto-open filter panel when URL has dynamic filters |
| Multiselect filters only store first value in URL | Use repeated params via URLSearchParams.append() |

### 14. UX-042: In-App Release Banner (staging only)
- Brainstormed design: dismissible banner below header showing new enhancements since last visit
- Data source: hardcoded `RELEASE_NOTES` array in `lib/release-notes.ts` (separate from versiegeschiedenis)
- Seen tracking: localStorage `rn-last-seen` key (date of newest seen release)
- Display: 1 item = "Nieuw: [title]", 2-3 = titles joined with `·`, 4+ = 2 titles + "en X meer"
- Styling: blue-50 background (distinct from amber subscription banner)
- Design doc: `docs/plans/2026-02-24-release-banner-design.md`
- CLAUDE.md rule: "When updating versiegeschiedenis, also add banner entry to release-notes.ts"
- Deployed to staging only (zero production builds — new process)

### 15. Deployment Protocol Rewrite (CLAUDE.md)
- Root cause analysis: 3 contradictory instructions in CLAUDE.md caused repeated double-push to main
- Assembled senior review team (DevOps, Process Analyst, Risk Assessor, Adversarial Strategist)
- Findings: "Commit on main" vs "staging-only code on main is a contradiction", `main:staging` both recommended and forbidden
- Replaced with 3-scenario decision tree: A) Both environments, B) Staging only, C) Batch release
- Added 5 mandatory self-verification questions before any push
- **Key rule: for staging-only features, `git push origin main` must NEVER appear**
- Deployed to both environments

### 16. UX-039 Vergelijk/Pin Restoration (staging)
- Discovered UX-039 was missing from staging — lost during revert-merge cascade (same pattern as UX-042)
- Original revert on main (`8739ed1`) propagated to staging via `git merge main`
- Manually re-applied all 19 code blocks from extraction analysis:
  - Imports: `useCallback`, `RowPinningState`, `Pin`, `PinOff`, Radix Tooltip
  - State: `rowPinning`, `pinnedCount`, `MAX_PINNED_ROWS`, clear-on-module-change
  - Functions: `getPinnedData`, selection-aware CSV/XLS export
  - UI: Pin/unpin buttons with Tooltip, "Wis selectie" toolbar button, ExportDropdown
  - Table body: pinned rows (blue highlight) + separator + `getCenterRows()`
  - Config: `enableRowPinning`, `keepPinnedRows`, `getRowId`
- Preserved UX-040 (sort) and UX-041 (URL state) during restore
- TypeScript clean build verified
- Deployed to staging only (committed directly on staging, zero production builds)

## Files Created (additional — Session 6)

| File | Description |
|------|-------------|
| `app/src/lib/release-notes.ts` | Release notes data array (3 entries: V2.0, V2.0.1, V2.0.2) |
| `app/src/components/release-banner/release-banner.tsx` | Dismissible banner component |
| `app/src/components/release-banner/index.ts` | Barrel export |
| `docs/plans/2026-02-24-release-banner-design.md` | Release banner design document |

## Files Modified (additional — Session 6)

| File | Changes |
|------|---------|
| `app/src/components/app-shell/app-shell.tsx` | Added `<ReleaseBanner />` after Header (staging only) |
| `app/src/components/data-table/data-table.tsx` | Restored full UX-039 Vergelijk/Pin: 325 insertions (staging only) |
| `CLAUDE.md` | Deployment protocol rewrite (decision tree, 5 verification Qs), release banner sync rule, staging-only registry updated |

## Issues Resolved (additional — Session 6)

| Issue | Solution |
|-------|----------|
| Double push to main for staging-only features | Rewrote deployment protocol: decision tree, never push main for staging-only |
| UX-039 lost from staging (revert-merge cascade) | Manually re-applied 19 code blocks, verified all markers present |
| UX-042 banner lost from staging (same cascade) | Reverted the revert on staging to restore |
| Contradictory CLAUDE.md deployment instructions | 3-scenario decision tree + 5 self-verification questions |

### 17. UX-042 Release Banner: Design Refinement (5 iterations)
- v2: Brand colors (#E1EAF2 bg, #0E3261 text, #D4286B accents), inline dismiss, ✦ sparkle — still messy
- v3: Expert research team (GitHub Primer + Stripe + Vercel patterns):
  - Removed sparkle entirely — "Nieuw" semibold label IS the accent
  - Uniform 13px text, weight-only hierarchy (semibold/normal)
  - Pipe `|` separator between label and description
  - Lucide X icon in ghost button
- Fix 1: `justify-between` → `gap-3` so dismiss follows text, not at container edge
- Fix 2: Dot `·` separator before "Bekijk alles →"
- Fix 3: Dismiss button → visible bordered pill (`border`, `p-1`, `hover:bg-white/60`)
- Fix 4: "Bekijk alles →" changed from pink to navy (same color+weight as "Nieuw")
- Copy: "Sorteer direct op de hoogste bedragen" (benefit-first, doel door doen)
- Commits (staging): `fcb11a0`, `eb8c00a`, `be924fb`, `cb42aa2`, `3d147de`, `b288ae4`

### 18. UX-042 Released to Production
- Cherry-picked 4 banner files from staging to main (no UX-039/UX-041 contamination)
- Pre-push grep verification: zero staging-only markers
- Commit (main): `c47ecee`
- Merged main back into staging to keep in sync
- Removed UX-042 from staging-only registry in CLAUDE.md
- Commit (main): `ee3945e`

## Files Modified (additional — Session 7)

| File | Changes |
|------|---------|
| `app/src/components/release-banner/release-banner.tsx` | 5 design iterations: brand colors, no icon, uniform text, bordered dismiss, navy link |
| `app/src/lib/release-notes.ts` | Copy: "Slimmer zoeken met meerdere woorden", "Sorteer direct op de hoogste bedragen" |
| `app/src/components/app-shell/app-shell.tsx` | ReleaseBanner now on production (cherry-picked from staging) |
| `CLAUDE.md` | Removed UX-042 from staging-only registry + grep patterns |

## Issues Resolved (additional — Session 7)

| Issue | Solution |
|-------|----------|
| Banner fonts inconsistent | Uniform 13px, weight-only hierarchy (semibold/normal) |
| ✦ sparkle looks amateurish | Removed — "Nieuw" semibold label is the accent |
| Dismiss × invisible and far away | Bordered pill button (`p-1 rounded border`) + `gap-3` follows text |
| "Bekijk alles" pink clashed with navy text | Changed to navy-dark, same weight as "Nieuw" |
| Missing separator before link | Added `·` dot before "Bekijk alles →" |

---

## Next Steps

- Send test invite to verify final email layout
- Verify email deliverability after DNS propagation (test Hotmail/Outlook/Gmail)
- Consider dedicated Resend IP for spam score improvement
- Onboarding email sequence implementation (5 emails)
- Homepage copy optimization (remaining value props)
- Roadmap: update VERSIONING.md feature statuses for accuracy
- Roadmap: regenerate `roadmap-data.ts` after any VERSIONING.md or backlog.md edits
- V2.1 batch release: UX-039 Vergelijk + UX-041 URL State (staging → main)

---

**Session Status:** In Progress
