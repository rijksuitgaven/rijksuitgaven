# Daily Log — 2026-02-12

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V1.0 Development
**Sprint:** Week 6 — Auth + Membership (COMPLETE), Pre-Launch Polish
**Sessions:** 1 (Session 5 continuation from 2026-02-11)

---

## Summary

Post-login landing page (UX-027) built through 6+ design iterations, formal Dutch (u/uw) enforced across entire frontend, login security hardened against email enumeration, member activity tracking via `activated_at`, profile page polish. 6 commits pushed to production.

---

## Work Completed

### 1. UX-027: Post-Login Landing Page (Module Hub)
- **Commits:** `29abeea`, `e2775ff`, `66e4b6b`, `2754bd9`
- Built Enhanced Module Hub with module cards showing title, stat line, description
- Went through 6+ design iterations based on user feedback:
  - Initial: Welcome bar + featured Integraal card + 6 module grid
  - Removed: Search bar, Integraal prominence, "biljoen" terminology
  - Added: Ontvangers/Kosten grouping, full province/gemeente lists, euro totals
  - User correction: Inkoop belongs in Ontvangers (leverancier = recipient), not Kosten
  - Final: 6 Ontvangers cards + 1 Kosten card, stat line under title (bold, navy)
- Queried database for missing euro totals (integraal €1.621 mld, provincie €14 mld, gemeente €13 mld)
- Card titles specified by user: "Zoeken in alle modules", "Financiële Instrumenten", etc.

### 2. Formal Dutch (u/uw) Rule
- **Commit:** `2754bd9`
- Changed all "je/jouw" to "u/uw" across entire frontend:
  - `login-form.tsx`: "Voer je" → "Voer uw", spam folder text
  - `login/page.tsx`: form labels
  - `auth/callback/page.tsx`: loading text
  - `mobile-banner.tsx`: "Je ziet" → "U ziet"
  - `team/leden/[id]/invite/route.ts`: "Hoi" → "Beste", "Je bent" → "U bent"
- Added permanent rule to CLAUDE.md: always use u/uw, never je/jouw

### 3. Login Security: Email Enumeration Prevention
- **Commit:** `2754bd9`
- Unregistered emails now show success message (OWASP industry standard)
- Catches Supabase "Signups not allowed" / status 422 errors → fake success
- Error box restyled from plain `<p>` to rounded `bg-red-50` box matching success style

### 4. Member Activity Tracking (activated_at)
- **Commit:** `6431b04`
- Migration `035-activated-at.sql`: adds `activated_at timestamptz` to subscriptions
- Backfills from `auth.users.last_sign_in_at` for existing users
- POST `/api/v1/me/activate` endpoint: sets activated_at on first login only
- Auth callback calls activate endpoint fire-and-forget after PKCE exchange
- Edit modal in `/team/leden` now shows "Eerste login" and "Laatst actief" dates

### 5. Profile Page: Logout Button Restyle
- **Commit:** `4b1e4e8`
- Changed from bordered ghost button to simple red text link
- `text-sm font-medium text-red-600 hover:text-red-800 transition-colors`

### 6. Startday Dev Server Priority
- Updated `.claude/commands/startday.md`: dev server start moved to first action
- Prevents waiting for Railway rebuilds during development

### 7. Backlog Updates
- Added "Integraal View: Cross-Module Data Completeness" (regelingen across modules) to backlog

---

## Files Created

| File | Description |
|------|-------------|
| `scripts/sql/035-activated-at.sql` | Migration: activated_at column on subscriptions |
| `app/src/app/api/v1/me/activate/route.ts` | First-login activation endpoint |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/app/page.tsx` | Complete rewrite: Module Hub landing page with Ontvangers/Kosten grouping |
| `app/src/components/auth/login-form.tsx` | je→uw, email enumeration prevention, error box restyle |
| `app/src/app/login/page.tsx` | je→uw |
| `app/src/app/auth/callback/page.tsx` | je→uw, fire-and-forget activate call |
| `app/src/components/mobile-banner/mobile-banner.tsx` | je→uw |
| `app/src/app/api/v1/team/leden/[id]/invite/route.ts` | je→uw in invite email text |
| `app/src/app/profiel/page.tsx` | Logout button restyled as text link |
| `app/src/app/api/v1/team/leden/route.ts` | Added activated_at to select query |
| `app/src/app/team/leden/page.tsx` | activated_at in interface, formatDateTime helper, dates in modal |
| `app/src/app/team/page.tsx` | activated_at in Member interface |
| `.claude/commands/startday.md` | Dev server moved to first action |
| `CLAUDE.md` | Added u/uw rule, UX counter updated |
| `02-requirements/search-requirements.md` | Added UX-027 entry |
| `02-requirements/backlog.md` | Added integraal cross-module data completeness item |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Landing page too focused on Integraal | Demoted to regular card in grid |
| Inkoop in wrong category (Kosten) | Moved to Ontvangers (leverancier = recipient) |
| "biljoen" terminology | Changed to "miljard" (€1.474 mld) |
| Stat line too small (text-sm 14px) | Bumped to text-base font-semibold under title |
| Pink stat color rejected | Changed to navy-dark bold |
| Email enumeration vulnerability | Fake success for unregistered emails (OWASP standard) |
| Informal Dutch (je/jouw) | Enforced u/uw across all user-facing text |
| No first-login tracking | activated_at column + /me/activate endpoint |
| Ugly logout button on profile | Restyled as simple red text link |
| Git path with brackets failed | Quoted path for zsh glob protection |

---

## Commits

| Hash | Message |
|------|---------|
| `29abeea` | Feat: UX-027 post-login landing page (Module Hub) |
| `e2775ff` | Landing page: Ontvangers/Kosten grouping, larger fonts, full descriptions |
| `66e4b6b` | Landing page: correct titles, euro totals, Ontvangers/Kosten grouping |
| `2754bd9` | Polish: formal Dutch (u/uw), login security, landing page card order |
| `6431b04` | Feat: activated_at tracking — first login date on member card |
| `4b1e4e8` | Profile: restyle logout button as simple text link |

## Migrations Executed

| Script | Environment |
|--------|-------------|
| `scripts/sql/035-activated-at.sql` | Supabase (production) |

### 8. V1.0 Scope Review & Planning (Session 6)
- Comprehensive V1.0 remaining work audit (sprint plan, backlog, versioning)
- **Scope changes:**
  - Branded email templates marked COMPLETED (already in `docs/email-templates/`)
  - Exact phrase search (`"rode kruis"`) moved from V1.1 → V1.0
  - Wildcard syntax (`prorail*`) moved from V1.1 → V1.0
- **Email campaign management decision:**
  - Evaluated 4 options: Resend Broadcasts, Loops, Buttondown, Brevo
  - Decision: **Resend Broadcasts** (already in stack, kills WordPress/Mailster dependency)
  - `nieuws.rijksuitgaven.nl` WordPress server to be decommissioned after launch
- **Contacts table decision (Option B):**
  - New `contacts` table in Supabase as single source of truth (prospect/subscriber/churned)
  - Admin UI at `/team/contacten` (new tab in team nav)
  - Resend Audience sync on create/update
  - Replaces need for separate CRM or Mailster subscriber list

---

## Next Steps

- `contacts` table + `/team/contacten` admin UI (6-10 hours)
- Resend Broadcasts setup (audience sync, campaign template, test send)
- Exact phrase search + wildcard syntax (4-8 hours)
- Import ~50 WordPress users to Supabase
- Migrate Mailster contacts into contacts table
- Rate limiting (Cloudflare, 30 min)
- Marketing pages (homepage, about, pricing, terms, contact)
- Final QA + beta test + launch

---

**Session Status:** Completed
