# Daily Log — 2026-02-13

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** V1.0 Development
**Sprint:** Week 7 — Pre-Launch Tasks (contacts, search syntax, user migration, marketing pages)
**Sessions:** 5

---

## Summary

Session 1: UX-028 Contacts Management (full-stack CRM) and last_active_at activity tracking. Session 2: Search enhancement planning (expert panel review, SR-005 scope documented) + search box performance optimization (6 improvements: 1-char trigger, leading-edge debounce, loading skeleton, aria-live, instant selection, reduced filter debounce). Both frontend and backend updated. Session 3: Homepage redesign — SaaS marketing team (7 experts) analyzed page and delivered Brief 1 (8 improvements implemented) and Brief 2 (out-of-the-box concepts, discussion pending). Major design overhaul: section reorder, trust bar, Brawler heading font, hero product screenshot, conversion CTA, scroll animations, outcome-first copy. Contact form with CRM integration (Resend email + Supabase contacts). shadcn/ui primitives installed. Session 4: Typography system overhaul — dual-width IBM Plex family (Sans for public, Condensed for data pages) replacing Brawler + login button restyled to match WordPress. Session 5: Brief 2 prototype visualizations — 5 standalone pages (/h1-/h5) visualizing the out-of-the-box homepage concepts for founder review.

---

## Work Completed

### UX-028 Contacts Management
- UX-028 requirement entry written in search-requirements.md
- SQL migration `036-contacts.sql` — contacts table with RLS, indexes, updated_at trigger
- API route `GET/POST /api/v1/team/contacten` — list + create with duplicate email check
- API route `PATCH/DELETE /api/v1/team/contacten/[id]` — update (semi-auto type transition) + delete
- Resend Audience sync helper (`resend-audience.ts`) — fire-and-forget create/update/delete
- TeamNav updated with "Contacten" tab
- `/team/contacten` admin page — stats bar, add form, sortable table, edit modal, delete confirmation
- Migration executed on Supabase production
- Resend Audience ID configured (`RESEND_AUDIENCE_ID` env var on Railway)
- Resend API key upgraded to full-access (was send-only)

### last_active_at Activity Tracking
- SQL migration `037-last-active-at.sql` — add column + backfill from auth.users
- Middleware updated: fire-and-forget update of `last_active_at` (throttled 5 min via `_la` cookie)
- Leden API simplified: reads `last_active_at` from subscriptions (removed `auth.admin.listUsers()` call)
- Leden page: "Laatst actief" now shows real activity instead of login-only date
- Migration executed on Supabase production

### Documentation (Session 1)
- DATABASE-DOCUMENTATION.md: added contacts table (0d), last_active_at column, migrations 036+037
- SESSION-CONTEXT.md: updated with session work
- backlog.md: Email Campaign Management status updated (steps 1-3 done)
- Daily log: comprehensive session documentation

### Session 2: Search Enhancement Design
- Expert panel review (Search Engineer, Backend Architect, UX Specialist, Security Engineer, Adversarial Strategist)
- Validated multi-word AND, exact phrase, prefix search architecture
- Identified edge cases: unmatched quotes, bare asterisks, mixed syntax
- Documented "Gevonden in" heuristic limitation (V1.0 acceptable, V1.1 improvement)
- SR-005 V1.0 implementation scope + edge case handling table added to search-requirements.md
- 3 V1.1/V2+ backlog items added: accurate multi-field match, fuzzy/typo tolerance, field-specific syntax

### Session 2: Search Box Performance (6 improvements)
- **1. Min chars 2→1:** Frontend trigger reduced from 2 to 1 character (both SearchBar + FilterPanel)
- **2. Leading-edge debounce:** First keystroke after idle fires immediately (0ms), subsequent debounce 150ms. Perceived latency ~500-700ms → ~50-100ms
- **3. Loading skeleton:** Pulsing placeholder rows shown while API loads (before results arrive)
- **4. Previous results preserved:** Verified old results stay visible while new request loads (no flash)
- **5. aria-live announcements:** Screen readers now hear "X resultaten gevonden" when dropdown updates
- **6. Instant selection:** Enter/click selection skips 150ms filter debounce — table updates immediately. Filter debounce reduced from 300ms to 150ms for typing.
- **Backend fix:** FastAPI autocomplete `min_length` changed from 2 to 1 on 3 endpoints (modules.py, search.py x2)
- Dropdown max-height capped at `min(24rem, 50vh)` to prevent content occlusion

---

## Files Created

| File | Description |
|------|-------------|
| `scripts/sql/036-contacts.sql` | Contacts table migration (RLS, indexes, trigger) |
| `scripts/sql/037-last-active-at.sql` | last_active_at column + backfill |
| `app/src/app/api/v1/team/contacten/route.ts` | GET (list) + POST (create) API |
| `app/src/app/api/v1/team/contacten/[id]/route.ts` | PATCH (update) + DELETE API |
| `app/src/app/api/_lib/resend-audience.ts` | Resend Audience sync helper |
| `app/src/app/team/contacten/page.tsx` | Contacts management admin page |

## Files Modified

| File | Changes |
|------|---------|
| `app/src/components/team-nav/team-nav.tsx` | Added "Contacten" tab |
| `app/src/lib/supabase/middleware.ts` | Added last_active_at tracking (throttled 5 min) |
| `app/src/app/api/v1/team/leden/route.ts` | Use last_active_at, removed auth.admin.listUsers() |
| `app/src/app/team/leden/page.tsx` | last_sign_in_at → last_active_at |
| `02-requirements/search-requirements.md` | Added UX-028 entry + SR-005 V1.0 search scope + edge cases |
| `02-requirements/backlog.md` | Updated Email Campaign status + 3 search backlog items (V1.1/V2+) |
| `scripts/sql/DATABASE-DOCUMENTATION.md` | Added contacts table, last_active_at, migrations |
| `logs/SESSION-CONTEXT.md` | Updated with session work |
| `app/src/components/filter-panel/filter-panel.tsx` | 1-char trigger, leading-edge debounce, skeleton, aria-live, skip-debounce on selection, 150ms filter debounce |
| `app/src/components/search-bar/search-bar.tsx` | 1-char trigger, leading-edge debounce, skeleton, aria-live, max-height cap |
| `backend/app/api/v1/modules.py` | Autocomplete min_length 2→1 |
| `backend/app/api/v1/search.py` | Autocomplete + recipients min_length 2→1 (2 endpoints) |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|
| Wrong trigger function name in migration | Each table needs its own function — created `update_contacts_updated_at()` |
| Resend API key restricted to send-only | Created new full-access key for Audience management |
| "Laatst actief" showing stale login date | Replaced `last_sign_in_at` (auth event only) with `last_active_at` (real page visits, throttled 5 min) |

---

## Commits

| Hash | Message |
|------|---------|
| `3dfd0e9` | Feat: UX-028 Contacts Management — full-stack CRM for email campaigns |
| `c715ef3` | Feat: last_active_at — track real user activity instead of login-only |
| `af17ee2` | Docs: session documentation — contacts table, last_active_at, migrations 036-037 |
| `a0ba401` | Perf: search box — leading-edge debounce, 1-char trigger, loading skeleton |
| `5f9ae4a` | Fix: backend autocomplete min_length 2→1 to match frontend 1-char trigger |
| `e1873d9` | Docs: session documentation — search box perf, search enhancement design |
| `255a682` | Feat: homepage redesign — Brief 1 (8 improvements), contact form, shadcn/ui setup |
| `da8b769` | Docs: homepage Brief 2 — out-of-the-box concepts from marketing team |

### Session 3: Homepage Redesign (Brief 1 — Next Level)

**Process:** Assembled 7-person SaaS marketing team (Sophie — Creative Strategist B2G, Marco — Performance Marketer, Lena — Brand Designer, Daan — Copywriter Dutch B2G, Priya — UX Specialist, Thomas — Web Designer, Eva — Information Architect). Team analyzed homepage against post-login quality bar and industry benchmarks.

**Brief 1 — 8 improvements implemented:**

1. **Section reorder:** Hero → TrustBar → Audience → Features → Subscriptions → B2G → Contact (was: Hero → B2G → Features → Promo → Audience → Subscriptions → Contact). B2G moved from #2 to #6 — specialist pitch shouldn't be second thing visitors see.
2. **Trust bar:** New component between hero and audience — 4 data metrics (€1.700+ mld, 4.900+ regelingen, 9 begrotingsjaren, 6 databronnen) establishing credibility. Uses `scroll-reveal-scale` animation.
3. **Brawler heading font:** Applied `fontFamily: 'var(--font-heading), serif'` to 14 headings across all sections. Bridges the font gap between generic homepage and branded post-login experience. `font-[800]` → `font-bold` (Brawler max weight is 700).
4. **Hero product screenshot:** Browser-framed Zoeken.png (max-w-[840px]) replaces generic image. Shows actual product above the fold.
5. **Promo box → conversion CTA:** Replaced dead-end "Er valt nog veel meer te ontdekken!" with "463.000+ ontvangers doorzoekbaar in 6 databronnen" + "Boek een demo" button.
6. **Contact form response time:** Added "Wij reageren binnen 1 werkdag." below submit button.
7. **Scroll animation variant:** New `.scroll-reveal-scale` CSS class (scale 0.96→1 instead of translateY) for trust bar.
8. **Outcome-first value prop copy:** All 3 hero value props rewritten to lead with user benefit, not feature description.

**Additional changes:**
- **Headline:** "Waar gaat €1.700 miljard naartoe?" (option A from 5 candidates)
- **Features heading:** "Het meest complete platform voor overheidsuitgaven" (option C from 3 candidates)
- **Features subheading:** Trimmed to "Alles doorzoekbaar en vergelijkbaar." (removed redundant data metrics)
- **Formal Dutch fix:** "Bij elke login zie je" → "Bij elke login ziet u" in homepage
- **Subscription card headings:** Applied Brawler font

**Contact form (demo request):**
- Public endpoint `POST /api/v1/contact` — no auth required
- Stores in contacts table (upsert: new → insert, existing → update with notes)
- Sends email notification to `contact@rijksuitgaven.nl` via Resend
- Input validation: email regex, field length limits, body size limit (2KB)

**Homepage component architecture:**
- `app/src/components/homepage/public-homepage.tsx` — full homepage (~960 lines)
- `app/src/hooks/use-scroll-reveal.ts` — IntersectionObserver hook (fires once)
- `app/src/components/app-shell/` — AppShell component (header/footer wrapper)
- `app/src/components/ui/` — shadcn/ui primitives (dialog, input, label, textarea, dropdown-menu)
- `app/public/screenshots/` — product screenshots for feature cards
- `app/public/icons/` — feature card icons (if any)

**Layout changes:**
- `layout.tsx` — updated font imports, conditional header/footer (non-app-shell pages)
- `page.tsx` — public homepage for unauthenticated, module hub for authenticated
- `footer.tsx` — updated for homepage (different styling context)
- `middleware.ts` — updated routing for public pages

**shadcn/ui packages installed:**
- `@radix-ui/react-dialog`, `@radix-ui/react-dropdown-menu`, `@radix-ui/react-label`
- `class-variance-authority`, `clsx`, `tailwind-merge` (utilities)

**Brief 2 — Out of the box (discussion pending):**
Team prepared concepts but user wants to discuss separately in a future session.

**3 backlog items added:**
1. Interactive Search Demo on Homepage (High priority, V1.0)
2. Tab-Based Feature Explorer (Medium, V1.1)
3. Audience-Personalized Landing Variants (Medium, V1.1)

---

## Files Created (Session 3)

| File | Description |
|------|-------------|
| `app/src/components/homepage/public-homepage.tsx` | Full public homepage (~960 lines, 7 sections) |
| `app/src/hooks/use-scroll-reveal.ts` | IntersectionObserver hook for scroll animations |
| `app/src/components/app-shell/` | AppShell wrapper component |
| `app/src/components/ui/dialog.tsx` | shadcn/ui dialog primitive |
| `app/src/components/ui/input.tsx` | shadcn/ui input primitive |
| `app/src/components/ui/label.tsx` | shadcn/ui label primitive |
| `app/src/components/ui/textarea.tsx` | shadcn/ui textarea primitive |
| `app/src/components/ui/dropdown-menu.tsx` | shadcn/ui dropdown-menu primitive |
| `app/src/app/api/v1/contact/route.ts` | Public demo request API (no auth) |
| `app/public/screenshots/` | Product screenshots for feature cards and hero |
| `app/public/icons/` | Feature section icons |
| `scripts/sql/038-contacts-phone.sql` | Phone column for contacts table |
| `scripts/extract-wp-css.js` | WordPress CSS extraction helper |

## Files Modified (Session 3)

| File | Changes |
|------|---------|
| `app/src/app/globals.css` | Added scroll-reveal, scroll-reveal-scale, stagger-children, audience animations, CSS tooltips |
| `app/src/app/layout.tsx` | Updated font imports (Brawler heading), conditional header/footer |
| `app/src/app/page.tsx` | Public homepage (unauthed) vs Module Hub (authed) |
| `app/src/components/footer/footer.tsx` | Homepage-compatible styling |
| `app/src/lib/supabase/middleware.ts` | Updated routing for public pages |
| `app/src/app/api/v1/team/contacten/route.ts` | Added phone field to contact creation |
| `app/package.json` | Added shadcn/ui dependencies |
| `02-requirements/backlog.md` | 3 new homepage backlog items |

---

## Issues Resolved (Session 3)

| Issue | Solution |
|-------|----------|
| Homepage felt "generic SaaS template" | Applied Brawler heading font (14 instances), bridging post-login brand gap |
| B2G section too prominent at position #2 | Moved to #6 — specialist pitch after general audience content |
| Promo box was dead-end moment | Replaced with data metric + CTA at peak visitor interest |
| Hero had no product visibility | Added browser-framed screenshot showing actual product |
| Value props were feature-first | Rewrote outcome-first (user benefit leads) |
| Parallel edit cascade failure | Initial 14-edit batch failed due to non-unique string match. Fixed by re-reading file and using more surrounding context for unique matching. |
| `font-[800]` with Brawler | Brawler only has weights 400 and 700 — converted to `font-bold` |

---

### Session 4: Typography System Overhaul

**Problem:** Brawler heading font didn't pair well with IBM Plex Sans Condensed — serif/sans mismatch felt inconsistent.

**Solution:** Dual-width IBM Plex family — same typeface, two widths:
- `--font-body`: IBM Plex Sans (400-700) — global default for public pages and module hub
- `--font-heading`: alias for `--font-body` (resolved via globals.css)
- `--font-condensed`: IBM Plex Sans Condensed (400-700) — data-dense logged-in pages

**Font evolution:** Brawler+Condensed → Libre Franklin (too wide) → Fraunces+Condensed (serif didn't fit) → IBM Plex Sans+Condensed (final)

**Scope of changes:**
- `layout.tsx`: Replaced Brawler import with IBM Plex Sans, updated CSS variables
- `globals.css`: `--font-heading` now resolves to `var(--font-body)` instead of Brawler
- Public pages (homepage, login, privacybeleid, verlopen): inherit `--font-body` (IBM Plex Sans)
- Module hub (authenticated `/`): inherits `--font-body`
- Data pages: `style={{ fontFamily: 'var(--font-condensed)' }}` on `<main>` wrapper
  - `module-page.tsx` wraps ErrorBoundary content (all 7 modules)
  - `team/*`, `profiel`, `detail-panel`: individual `<main>` overrides

**Login button fix:** Restyled to match WordPress — pink outline border with pink hover wash (was solid pink, didn't match existing branding).

### Session 5: Brief 2 Prototype Visualizations

**Purpose:** Visualize the 5 out-of-the-box homepage concepts from Brief 2 as standalone prototype pages for founder review and brainstorming.

**5 prototype pages created:**

| Route | Concept | Size | Highlights |
|-------|---------|------|------------|
| `/h1` | **De Geldstroom** — Animated data flow | 24KB | Sankey-style particles on canvas (requestAnimationFrame), SVG flow diagram, hover tooltips, click interactions. Navy bg, pink particles. |
| `/h2` | **Probeer het zelf** — Live search widget | 32KB | Typewriter placeholder cycling 5 suggestions, mock data for 5 entities (ProRail, Amsterdam, Politie, Defensie, Rijkswaterstaat), staggered result animations, trust indicators. |
| `/h3` | **Ontdekking van de Week** — Data stories | 20KB | 3-card editorial carousel, count-up number animation (requestAnimationFrame), SVG noise texture, auto-rotation (5s, pause on hover), dot indicators, LinkedIn share. |
| `/h4` | **Geldkaart** — Geographic spending map | 31KB | SVG Netherlands map (12 provinces as separate paths), color scale (navy→blue→pink), hover tooltips, click detail panel, ranking table below, IJsselmeer water body. |
| `/h5` | **Het Verschil** — Before/after narrative | 31KB | Scroll-driven (~400vh), sticky viewport, 3 phases (Voorheen/Transition/Nu), fake spreadsheets + PDFs in before state, animated counters at transition, mock product interface in after state. |

**Technical approach:**
- All `'use client'` Next.js page components
- Zero external dependencies (no D3, no map libraries, no animation libraries)
- Self-contained: all styles inline, all SVGs inline, mock data embedded
- Uses brand palette via CSS variables (navy-dark, pink, blue-light, gray-light)
- Font: `var(--font-body)` (IBM Plex Sans)
- Built in parallel using 5 subagents

**Infrastructure change:**
- `middleware.ts`: Added `h[1-5]` to matcher exclusion list (prototype routes are public, no auth redirect)

---

## Files Created (Session 4)

*No new files — modifications only (see commits)*

## Files Created (Session 5)

| File | Description |
|------|-------------|
| `app/src/app/h1/page.tsx` | De Geldstroom — animated Sankey data flow hero (24KB) |
| `app/src/app/h2/page.tsx` | Probeer het zelf — live search widget demo (32KB) |
| `app/src/app/h3/page.tsx` | Ontdekking van de Week — data stories carousel (20KB) |
| `app/src/app/h4/page.tsx` | Geldkaart — interactive SVG Netherlands map (31KB) |
| `app/src/app/h5/page.tsx` | Het Verschil — scroll-driven before/after narrative (31KB) |

## Files Modified (Session 4 & 5)

| File | Changes |
|------|---------|
| `app/src/app/layout.tsx` | IBM Plex Sans replaces Brawler, updated CSS variables |
| `app/src/app/globals.css` | `--font-heading` resolves to `var(--font-body)` |
| `app/src/middleware.ts` | Added `h[1-5]` to public route exclusions |

## Commits (Session 4 & 5)

| Hash | Message |
|------|---------|
| `9c14f76` | Fix: Login button matches WordPress — pink outline + pink hover wash |
| `c8b31c6` | Feat: dual-width IBM Plex typography — Sans for public, Condensed for data pages |
| *(pending)* | Feat: Brief 2 prototype visualizations — 5 concept pages at /h1-/h5 |

---

## Next Steps

- **Brief 2 brainstorm** — founder reviews /h1-/h5 prototypes, decides which concepts to implement
- Search enhancements implementation (exact phrase, wildcard, multi-word AND)
- User migration (~50 WordPress users)
- V1 Feature Close Review
- Rate limiting (Cloudflare)

---

**Session Status:** Completed
